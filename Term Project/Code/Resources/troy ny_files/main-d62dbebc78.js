function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}/**
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ClusterIcon(cluster,styles){cluster.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.cluster_=cluster,this.className_=cluster.getMarkerClusterer().getClusterClass(),this.styles_=styles,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(cluster.getMap())}function Cluster(mc){this.markerClusterer_=mc,this.map_=mc.getMap(),this.gridSize_=mc.getGridSize(),this.minClusterSize_=mc.getMinimumClusterSize(),this.averageCenter_=mc.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,mc.getStyles())}function MarkerClusterer(map,opt_markers,opt_options){this.extend(MarkerClusterer,google.maps.OverlayView),opt_markers=opt_markers||[],opt_options=opt_options||{},this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.gridSize_=opt_options.gridSize||60,this.minClusterSize_=opt_options.minimumClusterSize||2,this.maxZoom_=opt_options.maxZoom||null,this.styles_=opt_options.styles||[],this.title_=opt_options.title||"",this.zoomOnClick_=!0,void 0!==opt_options.zoomOnClick&&(this.zoomOnClick_=opt_options.zoomOnClick),this.averageCenter_=!1,void 0!==opt_options.averageCenter&&(this.averageCenter_=opt_options.averageCenter),this.ignoreHidden_=!1,void 0!==opt_options.ignoreHidden&&(this.ignoreHidden_=opt_options.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==opt_options.enableRetinaIcons&&(this.enableRetinaIcons_=opt_options.enableRetinaIcons),this.imagePath_=opt_options.imagePath||MarkerClusterer.IMAGE_PATH,this.imageExtension_=opt_options.imageExtension||MarkerClusterer.IMAGE_EXTENSION,this.imageSizes_=opt_options.imageSizes||MarkerClusterer.IMAGE_SIZES,this.calculator_=opt_options.calculator||MarkerClusterer.CALCULATOR,this.batchSize_=opt_options.batchSize||MarkerClusterer.BATCH_SIZE,this.batchSizeIE_=opt_options.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE,this.clusterClass_=opt_options.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(opt_markers,!0),this.setMap(map)}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}("undefined"!=typeof _&&null!=_?_:require("underscore")).mixin({omitUndefined:function(obj){var filteredObj,key,value;filteredObj={};for(key in obj)value=obj[key],"undefined"!=typeof value&&null!=value&&(filteredObj[key]=value);return filteredObj},indexBy:function(list,iterator){var listItem,returnedHash;returnedHash={};for(var cache$=list||[],i$=0,length$=cache$.length;length$>i$;++i$)listItem=cache$[i$],returnedHash[listItem[iterator]]=listItem;return returnedHash},hasSubstring:function(str,subString){return"string"==typeof str&&str.indexOf(subString)>=0}}),window.Modules=function(window){var Modules,MODULES,NAMESPACES;return window.Modules?window.Modules:(Modules={},MODULES=["Breadcrumb","Browse","Deals","Local","Map","Page","RefinementBar","Seo","Shared","Touch","Widgets"],NAMESPACES=["Application","Collections","Helpers","Models","Presenters","UI","Views"],_(MODULES).each(function(module){return Modules[module]={},_(NAMESPACES).each(function(ns){return Modules[module][ns]={}})}),Modules)}(window),/*!
 * jQuery UI Widget 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var elem,i=0;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler("remove")}catch(err){}_cleanData(elems)}}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){return keepData||(!selector||$.filter(selector,[this]).length)&&$("*",this).add([this]).each(function(){$(this).triggerHandler("remove")}),_remove.call($(this),selector,keepData)})}}$.widget=function(name,base,prototype){var fullName,namespace=name.split(".")[0];name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName]=function(elem){return!!$.data(elem,name)},$[namespace]=$[namespace]||{},$[namespace][name]=function(options,element){arguments.length&&this._createWidget(options,element)};var basePrototype=new base;basePrototype.options=$.extend(!0,{},basePrototype.options),$[namespace][name].prototype=$.extend(!0,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype),$.widget.bridge(name,$[namespace][name])},$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=Array.prototype.slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.extend.apply(null,[!0,options].concat(args)):options,isMethodCall&&"_"===options.charAt(0)?returnValue:(isMethodCall?this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;return methodValue!==instance&&methodValue!==undefined?(returnValue=methodValue,!1):void 0}):this.each(function(){var instance=$.data(this,name);instance?instance.option(options||{})._init():$.data(this,name,new object(options,this))}),returnValue)}},$.Widget=function(options,element){arguments.length&&this._createWidget(options,element)},$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(options,element){$.data(element,this.widgetName,this),this.element=$(element),this.options=$.extend(!0,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(key,value){var options=key;if(0===arguments.length)return $.extend({},this.options);if("string"==typeof key){if(value===undefined)return this.options[key];options={},options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var self=this;return $.each(options,function(key,value){self._setOption(key,value)}),this},_setOption:function(key,value){return this.options[key]=value,"disabled"===key&&this.widget()[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",value),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(type,event,data){var callback=this.options[type];if(event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),data=data||{},event.originalEvent)for(var prop,i=$.event.props.length;i;)prop=$.event.props[--i],event[prop]=event.originalEvent[prop];return this.element.trigger(event,data),!($.isFunction(callback)&&callback.call(this.element[0],event,data)===!1||event.isDefaultPrevented())}}}(jQuery),function($){$.extend($.Widget.prototype,{_bindings:function(){var prop,bindings=[];for(prop in this)if(prop.match($.Widget.revent)&&"function"==$.type(this[prop])){var target=RegExp.$1,event=RegExp.$2;bindings.push({method:this[prop],target:target,event:event})}return bindings}}),$.Widget.revent=/([\w\s\.#\[\]="']+)?(?:\s|^)(change|click|contextmenu|dblclick|keydown|keyup|keypress|mousedown|mousemove|mouseout|mouseover|mouseup|reset|windowresize|resize|windowscroll|scroll|select|submit|dblclick|focusin|focusout|load|unload|ready|hashchange|mouseenter|mouseleave)/,$.behavior=function(name,base,prototype){$.widget(name,base,prototype);var namespace=name.split(".")[0];name=name.split(".")[1];var object=$[namespace][name],behavior=$[namespace][name]=function(options,element){arguments.length&&(object.call(this,options,element),$.each(this._bindings(),$.proxy(function(i,binding){var handler=$.proxy(binding.method,this);binding.target?this.element.delegate(binding.target,binding.event,handler):this.element.bind(binding.event,handler)},this)))},proto=$[namespace][name].prototype=object.prototype;if(base.prototype)for(var method in proto)proto[method]=$.isFunction(proto[method])&&$.isFunction(base.prototype[method])?function(name,fn){return function(){var tmp=this._super;this._super=base.prototype[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(method,proto[method]):proto[method];$.widget.bridge(name,$[namespace][name]);var plugin=$.fn[name];return $.fn[name]=function(options){$.each(this.selector.split(/,\s?/),function(i,selector){var behavior=$[namespace][name].prototype,parts=selector.split(" "),context=parts.length>1?parts[0]:document;selector=(parts.length>1?parts.slice(1):parts).join(" "),$.each(behavior._bindings(),$.proxy(function(i,binding){var handler=function(event){if(!$(this).data(name)){var instance=$(this)[name].call($(this)).data(name);instance[event.type].call(instance,event,this)}};binding.target||$(context).delegate(selector,binding.event,handler)},this))});var returnVal=plugin.call(this,options);return returnVal},behavior}}(jQuery),Groupon.Behavior=function(){function Behavior(){}return Behavior.extended=function(base){var name,ns;return ns="Groupon",name=base.name||/function ([^\(]*)\(/.exec(base.toString())[1],name?$.fn[name]=function(options){return null==options&&(options={}),$.behavior(ns+"."+name,base.prototype),$.fn[name].call(this,options)}:void 0},Behavior}(),Groupon.Spinner=function(super$){function Spinner(){super$.apply(this,arguments)}return extends$(Spinner,super$),Spinner.__super__.constructor.extended.call(Spinner,Spinner),Spinner.prototype.options={baseTop:0},Spinner.prototype._init=function(){return this.$el=this.element,this._insertSpinner()},Spinner.prototype.start=function(){var topMargin;return topMargin=$(document).scrollTop()>200?this.options.baseTop+$(document).scrollTop()-250:null!=this.options.topMargin?this.options.topMargin:this.options.baseTop+100,this.spinnerBack.css("top",topMargin),this.overlay.show(),this.$el},Spinner.prototype.stop=function(){return this.overlay.hide(),this.$el},Spinner.prototype._insertSpinner=function(){return this.$el.children("#load-overlay").length?void 0:(this.overlay=$("<div/>",{id:"load-overlay"}),this.spinnerBack=$("<div/>",{id:"spinner-back"}),this.spinner=$("<div/>",{id:"spinner"}),this.spinner.appendTo(this.spinnerBack),this.spinnerBack.appendTo(this.overlay),this.$el.append(this.overlay))},Spinner.prototype._removeSpinner=function(){return null!=this.spinner&&this.spinner.remove(),null!=this.spinnerBack&&this.spinnerBack.remove(),null!=this.overlay?this.overlay.remove():void 0},Spinner}(Groupon.Behavior),function($){return $.fn.startLoading=function(options){return $(this).Spinner(options).Spinner("start")},$.fn.stopLoading=function(){return $(this).Spinner("stop")}}(jQuery),Modules.Page.Views.Spinner=function(super$){function Spinner(){super$.apply(this,arguments)}var LOADING_OPTIONS;return extends$(Spinner,super$),Spinner.prototype.initialize=function(param$){return null==param$&&(param$={}),this.topMargin=param$.topMargin,this.options=_.extend({},LOADING_OPTIONS),this.isRunning=!1},Spinner.prototype.render=function(){return this.isRunning?void 0:(this.isRunning=!0,this.options.topMargin=this.topMargin,this.$el.startLoading(this.options))},Spinner.prototype.close=function(){return this.isRunning?(this.isRunning=!1,this.$el.stopLoading()):void 0},Spinner.prototype.startRunning=function(){return this.isRunning=!0},Spinner.prototype.stopRunning=function(){return this.isRunning=!1},LOADING_OPTIONS={fullscreenOverlay:!1,label:"Loading..."},Spinner}(Backbone.View),Modules.Page.Helpers.SpinnerGroup={initialize:function(){return this.spinners={},this.firstRunningInstance=null,this.runningSpinnerCount=0},start:function(name,options){var spinner;return spinner=null!=this.spinners[name]?this.spinners[name]:this.spinners[name]=new Modules.Page.Views.Spinner(options),spinner.isRunning?void 0:(this.runningSpinnerCount++,this.firstRunningInstance?(spinner.startRunning(),void 0):(this.firstRunningInstance=spinner,spinner.render()))},stop:function(name){var cache$,spinner;if(null!=(cache$=spinner=this.spinners[name])?cache$.isRunning:void 0)return this.runningSpinnerCount--,this.runningSpinnerCount>0?(spinner.stopRunning(),void 0):this.firstRunningInstance?(this.firstRunningInstance.startRunning(),this.firstRunningInstance.close(),this.firstRunningInstance=null):void 0}};/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
var Hogan={};!function(Hogan,useArrayBuffer){function coerceToString(val){return String(null===val||void 0===val?"":val)}function hoganEscape(str){return str=coerceToString(str),hChars.test(str)?str.replace(rAmp,"&amp;").replace(rLt,"&lt;").replace(rGt,"&gt;").replace(rApos,"&#39;").replace(rQuot,"&quot;"):str}Hogan.Template=function(renderFunc,text,compiler,options){this.r=renderFunc||this.r,this.c=compiler,this.options=options,this.text=text||"",this.buf=useArrayBuffer?[]:""},Hogan.Template.prototype={r:function(){return""},v:hoganEscape,t:coerceToString,render:function(context,partials,indent){return this.ri([context],partials||{},indent)},ri:function(context,partials,indent){return this.r(context,partials,indent)},rp:function(name,context,partials,indent){var partial=partials[name];return partial?(this.c&&"string"==typeof partial&&(partial=this.c.compile(partial,this.options)),partial.ri(context,partials,indent)):""},rs:function(context,partials,section){var tail=context[context.length-1];if(!isArray(tail))return section(context,partials,this),void 0;for(var i=0;i<tail.length;i++)context.push(tail[i]),section(context,partials,this),context.pop()},s:function(val,ctx,partials,inverted,start,end,tags){var pass;return isArray(val)&&0===val.length?!1:("function"==typeof val&&(val=this.ls(val,ctx,partials,inverted,start,end,tags)),pass=""===val||!!val,!inverted&&pass&&ctx&&ctx.push("object"==typeof val?val:ctx[ctx.length-1]),pass)},d:function(key,ctx,partials,returnFound){var names=key.split("."),val=this.f(names[0],ctx,partials,returnFound),cx=null;if("."===key&&isArray(ctx[ctx.length-2]))return ctx[ctx.length-1];for(var i=1;i<names.length;i++)val&&"object"==typeof val&&names[i]in val?(cx=val,val=val[names[i]]):val="";return returnFound&&!val?!1:(returnFound||"function"!=typeof val||(ctx.push(cx),val=this.lv(val,ctx,partials),ctx.pop()),val)},f:function(key,ctx,partials,returnFound){for(var val=!1,v=null,found=!1,i=ctx.length-1;i>=0;i--)if(v=ctx[i],v&&"object"==typeof v&&key in v){val=v[key],found=!0;break}return found?(returnFound||"function"!=typeof val||(val=this.lv(val,ctx,partials)),val):returnFound?!1:""},ho:function(val,cx,partials,text,tags){var compiler=this.c,options=this.options;options.delimiters=tags;var text=val.call(cx,text);return text=null==text?String(text):text.toString(),this.b(compiler.compile(text,options).render(cx,partials)),!1},b:useArrayBuffer?function(s){this.buf.push(s)}:function(s){this.buf+=s},fl:useArrayBuffer?function(){var r=this.buf.join("");return this.buf=[],r}:function(){var r=this.buf;return this.buf="",r},ls:function(val,ctx,partials,inverted,start,end,tags){var cx=ctx[ctx.length-1],t=null;if(!inverted&&this.c&&val.length>0)return this.ho(val,cx,partials,this.text.substring(start,end),tags);if(t=val.call(cx),"function"==typeof t){if(inverted)return!0;if(this.c)return this.ho(t,cx,partials,this.text.substring(start,end),tags)}return t},lv:function(val,ctx,partials){var cx=ctx[ctx.length-1],result=val.call(cx);return"function"==typeof result&&(result=coerceToString(result.call(cx)),this.c&&~result.indexOf("{{"))?this.c.compile(result,this.options).render(cx,partials):coerceToString(result)}};var rAmp=/&/g,rLt=/</g,rGt=/>/g,rApos=/\'/g,rQuot=/\"/g,hChars=/[&<>\"\']/,isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan),function(Hogan){function cleanTripleStache(token){"}"===token.n.substr(token.n.length-1)&&(token.n=token.n.substring(0,token.n.length-1))}function trim(s){return s.trim?s.trim():s.replace(/^\s*|\s*$/g,"")}function tagChange(tag,text,index){if(text.charAt(index)!=tag.charAt(0))return!1;for(var i=1,l=tag.length;l>i;i++)if(text.charAt(index+i)!=tag.charAt(i))return!1;return!0}function buildTree(tokens,kind,stack,customTags){for(var instructions=[],opener=null,token=null;tokens.length>0;)if(token=tokens.shift(),"#"==token.tag||"^"==token.tag||isOpener(token,customTags))stack.push(token),token.nodes=buildTree(tokens,token.tag,stack,customTags),instructions.push(token);else{if("/"==token.tag){if(0===stack.length)throw new Error("Closing tag without opener: /"+token.n);if(opener=stack.pop(),token.n!=opener.n&&!isCloser(token.n,opener.n,customTags))throw new Error("Nesting error: "+opener.n+" vs. "+token.n);return opener.end=token.i,instructions}instructions.push(token)}if(stack.length>0)throw new Error("missing closing tag: "+stack.pop().n);return instructions}function isOpener(token,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].o==token.n)return token.tag="#",!0}function isCloser(close,open,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].c==close&&tags[i].o==open)return!0}function esc(s){return s.replace(rSlash,"\\\\").replace(rQuot,'\\"').replace(rNewline,"\\n").replace(rCr,"\\r")}function chooseMethod(s){return~s.indexOf(".")?"d":"f"}function walk(tree){for(var code="",i=0,l=tree.length;l>i;i++){var tag=tree[i].tag;"#"==tag?code+=section(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n),tree[i].i,tree[i].end,tree[i].otag+" "+tree[i].ctag):"^"==tag?code+=invertedSection(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n)):"<"==tag||">"==tag?code+=partial(tree[i]):"{"==tag||"&"==tag?code+=tripleStache(tree[i].n,chooseMethod(tree[i].n)):"\n"==tag?code+=text('"\\n"'+(tree.length-1==i?"":" + i")):"_v"==tag?code+=variable(tree[i].n,chooseMethod(tree[i].n)):void 0===tag&&(code+=text('"'+esc(tree[i])+'"'))}return code}function section(nodes,id,method,start,end,tags){return"if(_.s(_."+method+'("'+esc(id)+'",c,p,1),'+"c,p,0,"+start+","+end+',"'+tags+'")){'+"_.rs(c,p,"+"function(c,p,_){"+walk(nodes)+"});c.pop();}"}function invertedSection(nodes,id,method){return"if(!_.s(_."+method+'("'+esc(id)+'",c,p,1),c,p,1,0,0,"")){'+walk(nodes)+"};"}function partial(tok){return'_.b(_.rp("'+esc(tok.n)+'",c,p,"'+(tok.indent||"")+'"));'}function tripleStache(id,method){return"_.b(_.t(_."+method+'("'+esc(id)+'",c,p,0)));'}function variable(id,method){return"_.b(_.v(_."+method+'("'+esc(id)+'",c,p,0)));'}function text(id){return"_.b("+id+");"}var rIsWhitespace=/\S/,rQuot=/\"/g,rNewline=/\n/g,rCr=/\r/g,rSlash=/\\/g,tagTypes={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};Hogan.scan=function(text,delimiters){function addBuf(){buf.length>0&&(tokens.push(new String(buf)),buf="")}function lineIsWhitespace(){for(var isAllWhitespace=!0,j=lineStart;j<tokens.length;j++)if(isAllWhitespace=tokens[j].tag&&tagTypes[tokens[j].tag]<tagTypes._v||!tokens[j].tag&&null===tokens[j].match(rIsWhitespace),!isAllWhitespace)return!1;return isAllWhitespace}function filterLine(haveSeenTag,noNewLine){if(addBuf(),haveSeenTag&&lineIsWhitespace())for(var next,j=lineStart;j<tokens.length;j++)tokens[j].tag||((next=tokens[j+1])&&">"==next.tag&&(next.indent=tokens[j].toString()),tokens.splice(j,1));else noNewLine||tokens.push({tag:"\n"});seenTag=!1,lineStart=tokens.length}function changeDelimiters(text,index){var close="="+ctag,closeIndex=text.indexOf(close,index),delimiters=trim(text.substring(text.indexOf("=",index)+1,closeIndex)).split(" ");return otag=delimiters[0],ctag=delimiters[1],closeIndex+close.length-1}var len=text.length,IN_TEXT=0,IN_TAG_TYPE=1,IN_TAG=2,state=IN_TEXT,tagType=null,tag=null,buf="",tokens=[],seenTag=!1,i=0,lineStart=0,otag="{{",ctag="}}";for(delimiters&&(delimiters=delimiters.split(" "),otag=delimiters[0],ctag=delimiters[1]),i=0;len>i;i++)state==IN_TEXT?tagChange(otag,text,i)?(--i,addBuf(),state=IN_TAG_TYPE):"\n"==text.charAt(i)?filterLine(seenTag):buf+=text.charAt(i):state==IN_TAG_TYPE?(i+=otag.length-1,tag=tagTypes[text.charAt(i+1)],tagType=tag?text.charAt(i+1):"_v","="==tagType?(i=changeDelimiters(text,i),state=IN_TEXT):(tag&&i++,state=IN_TAG),seenTag=i):tagChange(ctag,text,i)?(tokens.push({tag:tagType,n:trim(buf),otag:otag,ctag:ctag,i:"/"==tagType?seenTag-ctag.length:i+otag.length}),buf="",i+=ctag.length-1,state=IN_TEXT,"{"==tagType&&("}}"==ctag?i++:cleanTripleStache(tokens[tokens.length-1]))):buf+=text.charAt(i);return filterLine(seenTag,!0),tokens},Hogan.generate=function(tree,text,options){var code='var _=this;_.b(i=i||"");'+walk(tree)+"return _.fl();";return options.asString?"function(c,p,i){"+code+";}":new Hogan.Template(new Function("c","p","i",code),text,Hogan,options)},Hogan.parse=function(tokens,text,options){return options=options||{},buildTree(tokens,"",[],options.sectionTags||[])},Hogan.cache={},Hogan.compile=function(text,options){options=options||{};var key=text+"||"+!!options.asString,t=this.cache[key];return t?t:(t=this.generate(this.parse(this.scan(text,options.delimiters),text,options),text,options),this.cache[key]=t)}}("undefined"!=typeof exports?exports:Hogan),function(g,H,T){g.Groupon||(g.Groupon={}),g.Groupon.MustacheTemplates={breadcrumb:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("breadcrumb",c,p,1),c,p,0,15,535,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.s(_.f("isEnabled",c,p,1),c,p,0,31,520,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('		<div class="module breadcrumb">'),_.b("\n"+i),_.b('			<nav class="breadcrumb-nav">'),_.b("\n"+i),_.b("	      <ul>"),_.b("\n"+i),_.s(_.f("crumbs",c,p,1),c,p,0,126,478,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("						<li>"),_.b("\n"+i),_.s(_.f("showSeparator",c,p,1),c,p,0,163,219,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('								<span class="separator">&rsaquo;</span>'),_.b("\n")}),c.pop()),_.s(_.f("showHref",c,p,1),c,p,0,258,353,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('								<a class="crumb" href="'),_.b(_.v(_.f("href",c,p,0))),_.b('" title="'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b('">'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</a>"),_.b("\n")}),c.pop()),_.s(_.f("showHref",c,p,1),c,p,1,0,0,"")||(_.b('								<span class="crumb">'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</span>"),_.b("\n")),_.b("						</li>"),_.b("\n")}),c.pop()),_.b("				</ul>"),_.b("\n"+i),_.b("			</nav>"),_.b("\n"+i),_.b("		</div>"),_.b("\n")}),c.pop())}),c.pop()),_.fl()},'{{#breadcrumb}}\n	{{#isEnabled}}\n		<div class="module breadcrumb">\n			<nav class="breadcrumb-nav">\n	      <ul>\n					{{#crumbs}}\n						<li>\n							{{#showSeparator}}\n								<span class="separator">&rsaquo;</span>\n							{{/showSeparator}}\n							{{#showHref}}\n								<a class="crumb" href="{{href}}" title="{{friendlyName}}">{{friendlyName}}</a>\n							{{/showHref}}\n							{{^showHref}}\n								<span class="crumb">{{friendlyName}}</span>\n							{{/showHref}}\n						</li>\n					{{/crumbs}}\n				</ul>\n			</nav>\n		</div>\n	{{/isEnabled}}\n{{/breadcrumb}}\n',H,{}),browse_error_message:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div class="error">'),_.b("\n"+i),_.b("  <h1>"),_.b(_.v(_.f("error_message_header",c,p,0))),_.b("</h1>"),_.b("\n"+i),_.b("\n"+i),_.b('  <div class="error-content">'),_.b("\n"+i),_.b("    <p>"),_.b(_.t(_.f("error_message_content_p1",c,p,0))),_.b("</p>"),_.b("\n"+i),_.b("    <p>"),_.b(_.t(_.f("error_message_content_p2",c,p,0))),_.b("</p>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},'<div class="error">\n  <h1>{{error_message_header}}</h1>\n\n  <div class="error-content">\n    <p>{{{error_message_content_p1}}}</p>\n    <p>{{{error_message_content_p2}}}</p>\n  </div>\n</div>\n',H,{}),deals_paginated_deals_list:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b(_.t(_.f("featuredHtml",c,p,0))),_.b("\n"+i),_.b('<div data-bhw="HeroDeal" class="block-grid browse-deals featured-list-deal '),_.b(_.v(_.f("columnLayoutClass",c,p,0))),_.b('">'),_.b("\n"+i),_.b("  "),_.b(_.t(_.f("featuredListViewHtml",c,p,0))),_.b("\n"+i),_.b("</div>"),_.b("\n"+i),_.b('<div id="'),_.b(_.v(_.f("dealsListId",c,p,0))),_.b('" data-bhw="BrowseDeals" class="block-grid browse-deals '),_.b(_.v(_.f("columnLayoutClass",c,p,0))),_.b('">'),_.b("\n"+i),_.b("  "),_.b(_.t(_.f("dealsHtml",c,p,0))),_.b("\n"+i),_.b("</div>"),_.b("\n"+i),_.b('<div class="pagination_footer"></div>'),_.b("\n"),_.fl()},'{{{featuredHtml}}}\n<div data-bhw="HeroDeal" class="block-grid browse-deals featured-list-deal {{columnLayoutClass}}">\n  {{{featuredListViewHtml}}}\n</div>\n<div id="{{dealsListId}}" data-bhw="BrowseDeals" class="block-grid browse-deals {{columnLayoutClass}}">\n  {{{dealsHtml}}}\n</div>\n<div class="pagination_footer"></div>\n',H,{}),deals_pagination_footer:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("paginationFooter",c,p,1),c,p,0,21,1086,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.s(_.f("displayPagination",c,p,1),c,p,0,46,1063,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('    <div class="pagination" data-bhw="BrowsePaginationLinks">'),_.b("\n"+i),_.b('      <ul class="pagination_links">'),_.b("\n"+i),_.b("        <li>"),_.b("\n"+i),_.s(_.f("previousPageUrl",c,p,1),c,p,0,188,304,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('            <a href="'),_.b(_.v(_.f("previousPageUrl",c,p,0))),_.b('" class="previous" data-bhc="page:previous">'),_.b(_.v(_.f("previousPage",c,p,0))),_.b("</a>"),_.b("\n")}),c.pop()),_.s(_.f("previousPageUrl",c,p,1),c,p,1,0,0,"")||(_.b('            <span class="previous">'),_.b(_.v(_.f("previousPage",c,p,0))),_.b("</span>"),_.b("\n")),_.b("        </li>"),_.b("\n"+i),_.b("\n"+i),_.s(_.f("paginationSlots",c,p,1),c,p,0,489,678,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("          <li "),_.s(_.f("box",c,p,1),c,p,0,512,523,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('class="box"')}),c.pop()),_.b(">"),_.b("\n"+i),_.b("            "),_.s(_.f("url",c,p,1),c,p,0,553,608,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('" data-bhc="page:'),_.b(_.v(_.f("text",c,p,0))),_.b('">'),_.b(_.v(_.f("text",c,p,0))),_.b("</a>")}),c.pop()),_.b("\n"+i),_.b("            "),_.s(_.f("url",c,p,1),c,p,1,0,0,"")||_.b(_.v(_.f("text",c,p,0))),_.b("\n"+i),_.b("          </li>"),_.b("\n")}),c.pop()),_.b("\n"+i),_.b("        <li>"),_.b("\n"+i),_.s(_.f("nextPageUrl",c,p,1),c,p,0,739,839,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('            <a href="'),_.b(_.v(_.f("nextPageUrl",c,p,0))),_.b('" class="next" data-bhc="page:next">'),_.b(_.v(_.f("nextPage",c,p,0))),_.b("</a>"),_.b("\n")}),c.pop()),_.s(_.f("nextPageUrl",c,p,1),c,p,1,0,0,"")||(_.b('            <span class="next">'),_.b(_.v(_.f("nextPage",c,p,0))),_.b("</span>"),_.b("\n")),_.b("        </li>"),_.b("\n"+i),_.b("      </ul>"),_.b("\n"+i),_.b("      <p class='results'>"),_.b("\n"+i),_.b("        "),_.b(_.t(_.f("resultsHtml",c,p,0))),_.b("\n"+i),_.b("      </p>"),_.b("\n"+i),_.b("    </div>"),_.b("\n")}),c.pop())}),c.pop()),_.fl()},'{{#paginationFooter}}\n  {{#displayPagination}}\n    <div class="pagination" data-bhw="BrowsePaginationLinks">\n      <ul class="pagination_links">\n        <li>\n          {{#previousPageUrl}}\n            <a href="{{previousPageUrl}}" class="previous" data-bhc="page:previous">{{previousPage}}</a>\n          {{/previousPageUrl}}\n          {{^previousPageUrl}}\n            <span class="previous">{{previousPage}}</span>\n          {{/previousPageUrl}}\n        </li>\n\n        {{#paginationSlots}}\n          <li {{#box}}class="box"{{/box}}>\n            {{#url}}<a href="{{url}}" data-bhc="page:{{text}}">{{text}}</a>{{/url}}\n            {{^url}}{{text}}{{/url}}\n          </li>\n        {{/paginationSlots}}\n\n        <li>\n          {{#nextPageUrl}}\n            <a href="{{nextPageUrl}}" class="next" data-bhc="page:next">{{nextPage}}</a>\n          {{/nextPageUrl}}\n          {{^nextPageUrl}}\n            <span class="next">{{nextPage}}</span>\n          {{/nextPageUrl}}\n        </li>\n      </ul>\n      <p class=\'results\'>\n        {{{resultsHtml}}}\n      </p>\n    </div>\n  {{/displayPagination}}\n{{/paginationFooter}}\n',H,{}),browse_nearby_heading:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("nearbyHeading",c,p,1),c,p,0,20,152,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<div class="row collapse">'),_.b("\n"+i),_.b('  <div class="twelve columns nearby-deals-heading hide">'),_.b("\n"+i),_.b("    <h2>"),_.b(_.v(_.f("nearbyHeading",c,p,0))),_.b("</h2>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("</div>"),_.b("\n")}),c.pop()),_.fl()},'{{# nearbyHeading }}\n<div class="row collapse">\n  <div class="twelve columns nearby-deals-heading hide">\n    <h2>{{nearbyHeading}}</h2>\n  </div>\n</div>\n{{/ nearbyHeading }}\n',H,{}),browse_page_header:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("pageHeader",c,p,1),c,p,0,17,743,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("<div id=\"js-page-header\" class='page_header'>"),_.b("\n"+i),_.b("  <div data-bhw='BrowseHeader'>"),_.b("\n"+i),_.b("    <span id='bloodhound-deal-count' class='tracking-only'>"),_.b("\n"+i),_.b("      <span class='tracking-only' data-bhc='deal-count:"),_.b(_.v(_.f("dealsCount",c,p,0))),_.b("'>&nbsp;</span>"),_.b("\n"+i),_.b("    </span>"),_.b("\n"+i),_.b("    "),_.s(_.f("address",c,p,1),c,p,0,271,346,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("<span class='tracking-only' data-bhc='location:"),_.b(_.v(_.f("address",c,p,0))),_.b("'>&nbsp;</span>")}),c.pop()),_.b("\n"+i),_.b("    "),_.s(_.f("lat",c,p,1),c,p,0,375,441,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("<span class='tracking-only' data-bhc='lat:"),_.b(_.v(_.f("lat",c,p,0))),_.b("'>&nbsp;</span>")}),c.pop()),_.b("\n"+i),_.b("    "),_.s(_.f("lng",c,p,1),c,p,0,466,532,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("<span class='tracking-only' data-bhc='lng:"),_.b(_.v(_.f("lng",c,p,0))),_.b("'>&nbsp;</span>")}),c.pop()),_.b("\n"+i),_.b('    <h1 class="browse-title-heading">'),_.b("\n"+i),_.b(_.rp("browse_title_heading",c,p,"      ")),_.b("    </h1>"),_.b("\n"+i),_.b(_.rp("browse_sort_toggle",c,p,"    ")),_.b(_.rp("browse_deals_layout_toggle",c,p,"    ")),_.b("  </div>"),_.b("\n"+i),_.b('  <div class="dotted-line"></div>'),_.b("\n"+i),_.b("</div>"),_.b("\n")}),c.pop()),_.fl()},"{{# pageHeader }}\n<div id=\"js-page-header\" class='page_header'>\n  <div data-bhw='BrowseHeader'>\n    <span id='bloodhound-deal-count' class='tracking-only'>\n      <span class='tracking-only' data-bhc='deal-count:{{dealsCount}}'>&nbsp;</span>\n    </span>\n    {{# address }}<span class='tracking-only' data-bhc='location:{{ address }}'>&nbsp;</span>{{/ address }}\n    {{# lat }}<span class='tracking-only' data-bhc='lat:{{ lat }}'>&nbsp;</span>{{/ lat }}\n    {{# lng }}<span class='tracking-only' data-bhc='lng:{{ lng }}'>&nbsp;</span>{{/ lng }}\n    <h1 class=\"browse-title-heading\">\n      {{> browse_title_heading }}\n    </h1>\n    {{> browse_sort_toggle }}\n    {{> browse_deals_layout_toggle }}\n  </div>\n  <div class=\"dotted-line\"></div>\n</div>\n{{/ pageHeader }}\n",H,{}),browse_title_heading:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("titleHeading",c,p,1),c,p,0,19,550,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.s(_.f("searchQuery",c,p,1),c,p,0,38,95,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("<span data-bhc='query:"),_.b(_.v(_.f("query",c,p,0))),_.b("'>"),_.b(_.t(_.f("message",c,p,0))),_.b("</span>")}),c.pop()),_.b("\n"+i),_.s(_.f("interestName",c,p,1),c,p,0,133,203,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<span data-bhc="interest:'),_.b(_.v(_.f("interestName",c,p,0))),_.b('">'),_.b(_.v(_.f("interestName",c,p,0))),_.b("</span>")}),c.pop()),_.b("\n"+i),_.s(_.f("link",c,p,1),c,p,0,232,290,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<a data-bhc="category:'),_.b(_.v(_.f("id",c,p,0))),_.b('" href="'),_.b(_.v(_.f("href",c,p,0))),_.b('">'),_.b(_.v(_.f("text",c,p,0))),_.b("</a>")}),c.pop()),_.b("\n"+i),_.s(_.f("subcategory",c,p,1),c,p,0,318,435,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<span class="subcategory-bread">/ <a href=\''),_.b(_.t(_.f("url",c,p,0))),_.b("' data-bhc='subcategory:"),_.b(_.v(_.f("id",c,p,0))),_.b("'>"),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</a></span>")}),c.pop()),_.b("\n"+i),_.s(_.f("searchQuery",c,p,1),c,p,1,0,0,"")||_.s(_.f("interestName",c,p,1),c,p,1,0,0,"")||_.s(_.f("link",c,p,1),c,p,1,0,0,"")||_.b(_.t(_.f("title",c,p,0))),_.b("\n")}),c.pop()),_.fl()},'{{# titleHeading }}\n{{# searchQuery }}<span data-bhc=\'query:{{ query }}\'>{{{ message }}}</span>{{/ searchQuery }}\n{{# interestName }}<span data-bhc="interest:{{ interestName }}">{{ interestName }}</span>{{/ interestName }}\n{{#link}}<a data-bhc="category:{{id}}" href="{{href}}">{{text}}</a>{{/link}}\n{{# subcategory }}<span class="subcategory-bread">/ <a href=\'{{{ url }}}\' data-bhc=\'subcategory:{{ id }}\'>{{ friendlyName }}</a></span>{{/ subcategory }}\n{{^searchQuery}}{{^interestName}}{{^link}}{{{title}}}{{/link}}{{/interestName}}{{/searchQuery}}\n{{/titleHeading}}\n',H,{}),map_deal_flyout:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<figure class="mapcard icon-arrow-right-large" data-bhc="deal:'),_.b(_.v(_.f("id",c,p,0))),_.b('" data-bhd="'),_.b(_.v(_.f("bloodhoundData",c,p,0))),_.b('" data-bh-viewport="respect">'),_.b("\n"+i),_.b('  <a href="'),_.b(_.t(_.f("dealShowUrl",c,p,0))),_.b('">'),_.b("\n"+i),_.b('    <div class="deal-img">'),_.b("\n"+i),_.b('      <img src="'),_.b(_.v(_.d("image.src",c,p,0))),_.b('" '),_.s(_.f("soldOut",c,p,1),c,p,0,235,255,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('class="sold-out-dim"')}),c.pop()),_.b(">"),_.b("\n"+i),_.s(_.f("soldOut",c,p,1),c,p,0,287,567,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('        <div class="sold-out small">'),_.b("\n"+i),_.b('          <span class="stamp">'),_.b("\n"+i),_.b('            <span class="dot dot-before"></span>'),_.b("\n"+i),_.b("            "),_.s(_.f("translate",c,p,1),c,p,0,431,465,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.map.presenters.sold_out")}),c.pop()),_.b("\n"+i),_.b('            <span class="dot dot-after"></span>'),_.b("\n"+i),_.b("          </span>"),_.b("\n"+i),_.b("        </div>"),_.b("\n")}),c.pop()),_.b("    </div>"),_.b("\n"+i),_.b("    <figcaption>"),_.b("\n"+i),_.b('      <span class="deal-title">'),_.b(_.t(_.f("title",c,p,0))),_.b("</span>"),_.b("\n"+i),_.b('      <span class="merchant-name">'),_.b(_.t(_.f("merchantName",c,p,0))),_.b("</span>"),_.b("\n"+i),_.b('      <span class="deal-price">'),_.b("\n"+i),_.b("        <s>"),_.b(_.v(_.d("price.originalAmount",c,p,0))),_.b("</s> "),_.b(_.v(_.d("price.discountedAmount",c,p,0))),_.b("\n"+i),_.b("      </span>"),_.b("\n"+i),_.b("    </figcaption>"),_.b("\n"+i),_.b("  </a>"),_.b("\n"+i),_.b("</figure>"),_.b("\n"),_.fl()},'<figure class="mapcard icon-arrow-right-large" data-bhc="deal:{{ id }}" data-bhd="{{ bloodhoundData }}" data-bh-viewport="respect">\n  <a href="{{{ dealShowUrl }}}">\n    <div class="deal-img">\n      <img src="{{image.src}}" {{#soldOut}}class="sold-out-dim"{{/soldOut}}>\n      {{#soldOut}}\n        <div class="sold-out small">\n          <span class="stamp">\n            <span class="dot dot-before"></span>\n            {{#translate}}js.modules.map.presenters.sold_out{{/translate}}\n            <span class="dot dot-after"></span>\n          </span>\n        </div>\n      {{/soldOut}}\n    </div>\n    <figcaption>\n      <span class="deal-title">{{{ title }}}</span>\n      <span class="merchant-name">{{{ merchantName }}}</span>\n      <span class="deal-price">\n        <s>{{ price.originalAmount }}</s> {{ price.discountedAmount }}\n      </span>\n    </figcaption>\n  </a>\n</figure>\n',H,{}),map_deal_flyout_list:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div class="deal-flyout-list">'),_.b("\n"+i),_.s(_.f("dealFlyouts",c,p,1),c,p,0,49,75,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b(_.rp("map_deal_flyout",c,p,"  "))}),c.pop()),_.b("</div>"),_.b("\n"),_.fl()},'<div class="deal-flyout-list">\n{{# dealFlyouts }}\n  {{> map_deal_flyout }}\n{{/ dealFlyouts }}\n</div>\n',H,{}),refinement_bar_all:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<input type="checkbox" '),_.s(_.f("selected",c,p,1),c,p,0,36,43,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("checked")}),c.pop()),_.b("> "),_.s(_.f("translate",c,p,1),c,p,0,72,101,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.refinement_bar.all")}),c.pop()),_.b("\n"),_.fl()},'<input type="checkbox" {{#selected}}checked{{/selected}}> {{#translate}}js.modules.refinement_bar.all{{/translate}}\n',H,{}),refinement_bar_category:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<input type="checkbox" data-bhc="'),_.b(_.v(_.f("dataBhc",c,p,0))),_.b('" '),_.s(_.f("checked",c,p,1),c,p,0,58,65,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("checked")}),c.pop()),_.b("></input>"),_.b("\n"+i),_.b('<span class="name truncated"><a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('">'),_.b(_.v(_.f("friendlyNameShort",c,p,0))),_.b("</a></span>"),_.b("\n"+i),_.b('<span class="count '),_.s(_.f("showCount",c,p,1),c,p,1,0,0,"")||_.b("hide"),_.b('">'),_.s(_.f("showCount",c,p,1),c,p,0,234,247,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b(_.v(_.f("countText",c,p,0)))}),c.pop()),_.b("</span>"),_.b("\n"+i),_.s(_.f("childrenShowing",c,p,1),c,p,0,289,377,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<div class="expander-icon '),_.b(_.v(_.f("expanderClass",c,p,0))),_.b("\" data-bhc='categoryToggle:"),_.b(_.v(_.f("id",c,p,0))),_.b("'></div>"),_.b("\n")}),c.pop()),_.fl()},'<input type="checkbox" data-bhc="{{dataBhc}}" {{#checked}}checked{{/checked}}></input>\n<span class="name truncated"><a href="{{url}}">{{friendlyNameShort}}</a></span>\n<span class="count {{^showCount}}hide{{/showCount}}">{{#showCount}}{{countText}}{{/showCount}}</span>\n{{#childrenShowing}}\n<div class="expander-icon {{expanderClass}}" data-bhc=\'categoryToggle:{{ id }}\'></div>\n{{/childrenShowing}}\n',H,{}),refinement_bar_category_link:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<span class="name truncated '),_.s(_.f("isHighlighted",c,p,1),c,p,0,46,57,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("highlighted")}),c.pop()),_.b('">'),_.b("\n"+i),_.b('	<a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('" data-bhc="'),_.b(_.v(_.f("dataBhc",c,p,0))),_.s(_.f("isHighlighted",c,p,1),c,p,0,136,139,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("_on")}),c.pop()),_.b('">'),_.b(_.v(_.f("friendlyNameShort",c,p,0))),_.b("</a>"),_.b("\n"+i),_.b("</span>"),_.b("\n"+i),_.b('<span class="deal-counts">('),_.b(_.v(_.f("count",c,p,0))),_.b(")</span>"),_.b("\n"),_.fl()},'<span class="name truncated {{#isHighlighted}}highlighted{{/isHighlighted}}">\n	<a href="{{url}}" data-bhc="{{dataBhc}}{{#isHighlighted}}_on{{/isHighlighted}}">{{friendlyNameShort}}</a>\n</span>\n<span class="deal-counts">({{count}})</span>\n',H,{}),refinement_bar_flat_refinement:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<span class="flat-refinement-link">'),_.b("\n"+i),_.b('  <input type="checkbox" '),_.s(_.f("selected",c,p,1),c,p,0,74,81,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("checked")}),c.pop()),_.b(">"),_.b("\n"+i),_.b('  <a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('">'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</a>"),_.b("\n"+i),_.b('  <span class="deal-counts">('),_.b(_.v(_.f("count",c,p,0))),_.b(")</span>"),_.b("\n"+i),_.b("</span>"),_.b("\n"),_.fl()},'<span class="flat-refinement-link">\n  <input type="checkbox" {{#selected}}checked{{/selected}}>\n  <a href="{{url}}">{{friendlyName}}</a>\n  <span class="deal-counts">({{count}})</span>\n</span>\n',H,{}),refinement_bar_showmore_modal:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div class="modal refinementModal">'),_.b("\n"+i),_.b('  <div class="modal-body">'),_.b("\n"+i),_.b('  <div class="icon-x ex close-modal"></div>'),_.b("\n"+i),_.b('  <div class="tabs-container">'),_.b("\n"+i),_.b('    <ul class="tabs">'),_.b("\n"+i),_.b('      <li class="locations-tab"><a>'),_.s(_.f("translate",c,p,1),c,p,0,209,249,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.refinement_bar.location_title")}),c.pop()),_.b("</a></li>"),_.b("\n"+i),_.b('      <li class="interests-tab"><a>'),_.s(_.f("translate",c,p,1),c,p,0,322,363,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.refinement_bar.interests_title")}),c.pop()),_.b("</a></li>"),_.b("\n"+i),_.b("    </ul>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("\n"+i),_.b('  <div id="locations-modal" class="checkbox-holder location-checkboxes" data-bhw="modalRefinementsLocations">'),_.b("\n"+i),_.b("    <h4>"),_.s(_.f("translate",c,p,1),c,p,0,539,592,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.refinement_bar.showmore_modal.cities_title")}),c.pop()),_.b("</h4>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("\n"+i),_.b('  <div id="interests-modal" class="checkbox-holder interest-checkboxes" data-bhw="modalRefinementsInterests">'),_.b("\n"+i),_.b('    <ul class="checkbox-container">'),_.b("\n"+i),_.b("    </ul>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("\n"+i),_.b('  <div class="modal-footer">'),_.b("\n"+i),_.b('    <button class="apply btn-small btn-cta" data-bhc=\'ShowMoreModal:apply\' id="locations">'),_.s(_.f("translate",c,p,1),c,p,0,921,974,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.refinement_bar.showmore_modal.apply_button")}),c.pop()),_.b("</button>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},'<div class="modal refinementModal">\n  <div class="modal-body">\n  <div class="icon-x ex close-modal"></div>\n  <div class="tabs-container">\n    <ul class="tabs">\n      <li class="locations-tab"><a>{{#translate}}js.modules.refinement_bar.location_title{{/translate}}</a></li>\n      <li class="interests-tab"><a>{{#translate}}js.modules.refinement_bar.interests_title{{/translate}}</a></li>\n    </ul>\n  </div>\n\n  <div id="locations-modal" class="checkbox-holder location-checkboxes" data-bhw="modalRefinementsLocations">\n    <h4>{{#translate}}js.modules.refinement_bar.showmore_modal.cities_title{{/translate}}</h4>\n  </div>\n\n  <div id="interests-modal" class="checkbox-holder interest-checkboxes" data-bhw="modalRefinementsInterests">\n    <ul class="checkbox-container">\n    </ul>\n  </div>\n\n  <div class="modal-footer">\n    <button class="apply btn-small btn-cta" data-bhc=\'ShowMoreModal:apply\' id="locations">{{#translate}}js.modules.refinement_bar.showmore_modal.apply_button{{/translate}}</button>\n  </div>\n  </div>\n</div>\n',H,{}),refinement_bar_search_bubble:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<li class="dismiss">'),_.b("\n"+i),_.b('  <a class="bubble-search-term" data-bhc="search:'),_.b(_.v(_.f("searchTerm",c,p,0))),_.b('">"'),_.b(_.v(_.f("searchTerm",c,p,0))),_.b('"</a>'),_.b("\n"+i),_.b("</li>"),_.b("\n"),_.fl()},'<li class="dismiss">\n  <a class="bubble-search-term" data-bhc="search:{{searchTerm}}">"{{searchTerm}}"</a>\n</li>\n',H,{}),refinement_bar_subcategory:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<input type="checkbox" class="leftNavCategory" value="'),_.b(_.v(_.f("id",c,p,0))),_.b('"'),_.s(_.f("selected",c,p,1),c,p,0,74,82,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b(" checked")}),c.pop()),_.b(">"),_.b("\n"+i),_.b('<span><a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('">'),_.b(_.v(_.f("friendlyNameShort",c,p,0))),_.b("</a></span>"),_.b("\n"+i),_.b('<span class="deal-counts">('),_.b(_.v(_.f("count",c,p,0))),_.b(")</span>"),_.b("\n"),_.fl()},'<input type="checkbox" class="leftNavCategory" value="{{id}}"{{#selected}} checked{{/selected}}>\n<span><a href="{{url}}">{{friendlyNameShort}}</a></span>\n<span class="deal-counts">({{count}})</span>\n',H,{}),refinement_bar_refinement_links:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.s(_.f("refinementLinks",c,p,1),c,p,0,20,849,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<div class="refinement flat-refinements top-category-links'),_.s(_.f("hidden",c,p,1),c,p,0,90,95,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b(" hide")}),c.pop()),_.b('" data-bhw="categoryListOfLinks" data-id="'),_.b(_.v(_.f("id",c,p,0))),_.b('">'),_.b("\n"+i),_.b("  <h4>"),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</h4>"),_.b("\n"+i),_.b("  <ul id='"),_.b(_.v(_.f("id",c,p,0))),_.b("-list'>"),_.b("\n"+i),_.s(_.f("children",c,p,1),c,p,0,226,820,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('      <li id="'),_.b(_.v(_.f("id",c,p,0))),_.b('" class="sub-category-links child-refinement'),_.s(_.f("hidden",c,p,1),c,p,0,304,309,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b(" hide")}),c.pop()),_.b("\" data-bhc='subcategory:"),_.b(_.v(_.f("id",c,p,0))),_.b("_"),_.b(_.v(_.f("count",c,p,0))),_.b("' data-id=\""),_.b(_.v(_.f("id",c,p,0))),_.b('" data-friendlyName="'),_.b(_.v(_.f("friendlyNameShort",c,p,0))),_.b('" data-count="'),_.b(_.v(_.f("count",c,p,0))),_.b('" data-url-base="'),_.b(_.v(_.f("urlBase",c,p,0))),_.b('" '),_.s(_.f("topcategory",c,p,1),c,p,0,492,528,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('data-topcategory="'),_.b(_.v(_.f("topcategory",c,p,0))),_.b('"')
}),c.pop()),_.b(" "),_.s(_.f("badgeInfo",c,p,1),c,p,0,559,590,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('data-badge-info="'),_.b(_.v(_.f("badgeInfo",c,p,0))),_.b('"')}),c.pop()),_.b(">"),_.b("\n"+i),_.b('        <a href="'),_.b(_.v(_.f("href",c,p,0))),_.b('">'),_.b("\n"+i),_.b("          "),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("\n"+i),_.b('          <span class="deal-counts">('),_.b(_.v(_.f("count",c,p,0))),_.b(")</span>"),_.b("\n"+i),_.b("          "),_.s(_.f("badges",c,p,1),c,p,0,737,779,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('<span class="badge-'),_.b(_.v(_.f("id",c,p,0))),_.b('">'),_.b(_.v(_.f("text",c,p,0))),_.b("</span>")}),c.pop()),_.b("\n"+i),_.b("        </a>"),_.b("\n"+i),_.b("      </li>"),_.b("\n")}),c.pop()),_.b("  </ul>"),_.b("\n"+i),_.b("</div>"),_.b("\n")}),c.pop()),_.fl()},'{{#refinementLinks}}\n<div class="refinement flat-refinements top-category-links{{#hidden}} hide{{/hidden}}" data-bhw="categoryListOfLinks" data-id="{{id}}">\n  <h4>{{friendlyName}}</h4>\n  <ul id=\'{{id}}-list\'>\n    {{#children}}\n      <li id="{{ id }}" class="sub-category-links child-refinement{{#hidden}} hide{{/hidden}}" data-bhc=\'subcategory:{{ id }}_{{count}}\' data-id="{{id}}" data-friendlyName="{{friendlyNameShort}}" data-count="{{count}}" data-url-base="{{ urlBase }}" {{#topcategory}}data-topcategory="{{ topcategory }}"{{/topcategory}} {{#badgeInfo}}data-badge-info="{{badgeInfo}}"{{/badgeInfo}}>\n        <a href="{{href}}">\n          {{friendlyName}}\n          <span class="deal-counts">({{count}})</span>\n          {{#badges}}<span class="badge-{{id}}">{{text}}</span>{{/badges}}\n        </a>\n      </li>\n    {{/children}}\n  </ul>\n</div>\n{{/refinementLinks}}\n',H,{}),refinement_bar_refinement_interests:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b("<h4>"),_.s(_.f("translate",c,p,1),c,p,0,18,56,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("modules.refinement_bar.interests_title")}),c.pop()),_.b("</h4>"),_.b("\n"+i),_.b('<ul class="recent-interests" data-bhw="recentRefinementsInterests">'),_.b("\n"+i),_.s(_.f("refinementInterests",c,p,1),c,p,0,170,416,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('    <li class="refinement interest" data-id="'),_.b(_.v(_.f("id",c,p,0))),_.b('" data-count="'),_.b(_.v(_.f("count",c,p,0))),_.b('" data-friendlyname="'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("\" data-base-bhc='interest' "),_.s(_.f("selected",c,p,1),c,p,0,322,345,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('data-preselected="true"')}),c.pop()),_.b(">"),_.b("\n"+i),_.b(_.rp("refinement_bar_flat_refinement",c,p,"      ")),_.b("    </li>"),_.b("\n")}),c.pop()),_.b("</ul>"),_.b("\n"+i),_.b("<a class=\"see-more show-more-interests\" data-bhc='interests:showMore'>See More</a>"),_.b("\n"),_.fl()},'<h4>{{#translate}}modules.refinement_bar.interests_title{{/translate}}</h4>\n<ul class="recent-interests" data-bhw="recentRefinementsInterests">\n  {{#refinementInterests}}\n    <li class="refinement interest" data-id="{{id}}" data-count="{{count}}" data-friendlyname="{{friendlyName}}" data-base-bhc=\'interest\' {{#selected}}data-preselected="true"{{/selected}}>\n      {{> refinement_bar_flat_refinement }}\n    </li>\n  {{/refinementInterests}}\n</ul>\n<a class="see-more show-more-interests" data-bhc=\'interests:showMore\'>See More</a>\n',H,{}),refinement_bar_refinement_locations:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b("<h4>"),_.s(_.f("translate",c,p,1),c,p,0,18,55,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("modules.refinement_bar.location_title")}),c.pop()),_.b("</h4>"),_.b("\n"+i),_.b('<ul data-bhw="recentRefinementsLocations" class="recent-locations"></ul>'),_.b("\n"+i),_.b("<a class=\"see-more show-more-locations\" data-bhc='location:showMore'>"),_.s(_.f("translate",c,p,1),c,p,0,231,262,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("modules.refinement_bar.see_more")}),c.pop()),_.b("</a>"),_.b("\n"+i),_.b('<ul class="all-locations" style="display:none">'),_.b("\n"+i),_.s(_.f("refinementLocations",c,p,1),c,p,0,355,1032,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('  <li class="refinement city" data-id="'),_.b(_.v(_.f("id",c,p,0))),_.b('" data-count="'),_.b(_.v(_.f("count",c,p,0))),_.b('" data-friendlyname="'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b('" data-distancefromuser="'),_.b(_.v(_.f("distanceFromUser",c,p,0))),_.b("\" data-base-bhc='city' "),_.s(_.f("selected",c,p,1),c,p,0,542,565,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('data-preselected="true"')}),c.pop()),_.b(">"),_.b("\n"+i),_.b(_.rp("refinement_bar_flat_refinement",c,p,"    ")),_.b("    <ul>"),_.b("\n"+i),_.s(_.f("children",c,p,1),c,p,0,650,998,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('        <li class="neighborhood child-refinement" data-id="'),_.b(_.v(_.f("id",c,p,0))),_.b('" data-count="'),_.b(_.v(_.f("count",c,p,0))),_.b('" data-friendlyname="'),_.b(_.v(_.f("friendlyName",c,p,0))),_.b('" data-distancefromuser="'),_.b(_.v(_.f("distanceFromUser",c,p,0))),_.b("\" data-base-bhc='neighborhood' "),_.s(_.f("selected",c,p,1),c,p,0,865,888,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('data-preselected="true"')}),c.pop()),_.b(">"),_.b("\n"+i),_.b("          <span>"),_.b(_.v(_.f("friendlyName",c,p,0))),_.b("</span>"),_.b("\n"+i),_.b("          <span>("),_.b(_.v(_.f("count",c,p,0))),_.b(")</span>"),_.b("\n"+i),_.b("        </li>"),_.b("\n")}),c.pop()),_.b("    </ul>"),_.b("\n"+i),_.b("  </li>"),_.b("\n")}),c.pop()),_.b("</ul>"),_.b("\n"),_.fl()},'<h4>{{#translate}}modules.refinement_bar.location_title{{/translate}}</h4>\n<ul data-bhw="recentRefinementsLocations" class="recent-locations"></ul>\n<a class="see-more show-more-locations" data-bhc=\'location:showMore\'>{{#translate}}modules.refinement_bar.see_more{{/translate}}</a>\n<ul class="all-locations" style="display:none">\n  {{#refinementLocations}}\n  <li class="refinement city" data-id="{{id}}" data-count="{{count}}" data-friendlyname="{{friendlyName}}" data-distancefromuser="{{distanceFromUser}}" data-base-bhc=\'city\' {{#selected}}data-preselected="true"{{/selected}}>\n    {{> refinement_bar_flat_refinement }}\n    <ul>\n      {{#children}}\n        <li class="neighborhood child-refinement" data-id="{{id}}" data-count="{{count}}" data-friendlyname="{{friendlyName}}" data-distancefromuser="{{distanceFromUser}}" data-base-bhc=\'neighborhood\' {{#selected}}data-preselected="true"{{/selected}}>\n          <span>{{friendlyName}}</span>\n          <span>({{count}})</span>\n        </li>\n      {{/children}}\n    </ul>\n  </li>\n  {{/refinementLocations}}\n</ul>\n',H,{}),touch_deal_tile:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<li data-id="'),_.b(_.v(_.f("id",c,p,0))),_.b('">'),_.b("\n"+i),_.b('  <a href="'),_.b(_.v(_.f("dealShowUrl",c,p,0))),_.b('">'),_.b("\n"+i),_.b('    <img src="'),_.b(_.v(_.d("image.src",c,p,0))),_.b('">'),_.b("\n"+i),_.b('    <div class="t-details">'),_.b("\n"+i),_.b("      <h2>"),_.b(_.v(_.f("title",c,p,0))),_.b("</h2>"),_.b("\n"+i),_.b('      <div class="t-merchant">'),_.b(_.v(_.d("merchant.name",c,p,0))),_.b("</div>"),_.b("\n"+i),_.b('      <div class="t-price-etc">'),_.b("\n"+i),_.b('        <div class="t-price"><span>'),_.b(_.v(_.d("price.originalAmount",c,p,0))),_.b("</span>"),_.b(_.v(_.d("price.discountedAmount",c,p,0))),_.b("</div>"),_.b("\n"+i),_.b('        <div class="t-etc">'),_.b(_.v(_.f("location",c,p,0))),_.b("</div>"),_.b("\n"+i),_.b("      </div>"),_.b("\n"+i),_.b("    </div>"),_.b("\n"+i),_.b("  </a>"),_.b("\n"+i),_.b("</li>"),_.b("\n"),_.fl()},'<li data-id="{{id}}">\n  <a href="{{dealShowUrl}}">\n    <img src="{{image.src}}">\n    <div class="t-details">\n      <h2>{{title}}</h2>\n      <div class="t-merchant">{{merchant.name}}</div>\n      <div class="t-price-etc">\n        <div class="t-price"><span>{{price.originalAmount}}</span>{{price.discountedAmount}}</div>\n        <div class="t-etc">{{location}}</div>\n      </div>\n    </div>\n  </a>\n</li>\n',H,{}),touch_no_deals:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div class="error no-deals">'),_.b("\n"+i),_.b("  <h1>"),_.s(_.f("translate",c,p,1),c,p,0,49,108,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.browse.presenters.page_header.all_no_deals_title")}),c.pop()),_.b("</h1>"),_.b("\n"+i),_.b("\n"+i),_.b('  <div class="error-content">'),_.b("\n"+i),_.b("    <p>"),_.s(_.f("translate",c,p,1),c,p,0,180,241,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("js.modules.browse.presenters.page_header.all_no_deals_message")}),c.pop()),_.b("</p>"),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},'<div class="error no-deals">\n  <h1>{{#translate}}js.modules.browse.presenters.page_header.all_no_deals_title{{/translate}}</h1>\n\n  <div class="error-content">\n    <p>{{#translate}}js.modules.browse.presenters.page_header.all_no_deals_message{{/translate}}</p>\n  </div>\n</div>\n',H,{}),widgets_related_deals:new T(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div class="row">'),_.b("\n"+i),_.b('  <div id="pull-related-deals" class="twelve columns"></div>'),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},'<div class="row">\n  <div id="pull-related-deals" class="twelve columns"></div>\n</div>\n',H,{})}}(this,Hogan,Hogan.Template),Modules.Browse.Presenters.Error=function(){function Error(){}return Error.prototype.toHash=function(){var aClose,aOpen,breakline,href;return href=window.location.href,aOpen="<a href='"+href+"'>",aClose="</a>",breakline="<br>",{error_message_header:I18n.translate("js.modules.browse.presenters.error_message.message_header"),error_message_content_p1:I18n.translate("js.modules.browse.presenters.error_message.message_content_p1",{aOpen:aOpen,aClose:aClose}),error_message_content_p2:I18n.translate("js.modules.browse.presenters.error_message.message_content_p2",{breakline:breakline})}},Error}(),Modules.Browse.Views.ErrorHtml=function(){var hash,presenter,template;return presenter=new Modules.Browse.Presenters.Error,hash=presenter.toHash(),template=Groupon.MustacheTemplates.browse_error_message,template.render(hash)},null!=Modules.Seo.Helpers.Experiments?Modules.Seo.Helpers.Experiments:Modules.Seo.Helpers.Experiments={},Modules.Seo.Helpers.Experiments.merchantMatchEnabled=Groupon.enabledFeatures.gsm.merchantMatchEnabled,Modules.Seo.Helpers.Experiments.merchantCarouselEnabled=Groupon.enabledFeatures.gsm.merchantCarouselEnabled,Modules.Seo.Helpers.Experiments.editorialWidgetEnabled=Groupon.enabledFeatures.gsm.editorialWidgetEnabled,Modules.Seo.Helpers.Experiments.crosslinksEnabled=Groupon.enabledFeatures.gsm.crosslinksEnabled,Modules.Seo.Helpers.Experiments.merchantPlacesEnabled=Groupon.enabledFeatures.gsm.merchantPlacesEnabled,/*!
 * jCarousel - Riding carousels with jQuery
 *   http://sorgalla.com/jcarousel/
 *
 * Copyright (c) 2006 Jan Sorgalla (http://sorgalla.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Built on top of the jQuery library
 *   http://jquery.com
 *
 * Inspired by the "Carousel Component" by Bill Scott
 *   http://billwscott.com/carousel/
 */
function($){var defaults={vertical:!1,rtl:!1,start:1,offset:1,size:null,scroll:3,visible:null,animation:"normal",easing:"swing",auto:0,wrap:null,initCallback:null,setupCallback:null,reloadCallback:null,itemLoadCallback:null,itemFirstInCallback:null,itemFirstOutCallback:null,itemLastInCallback:null,itemLastOutCallback:null,itemVisibleInCallback:null,itemVisibleOutCallback:null,animationStepCallback:null,buttonNextHTML:"<div></div>",buttonPrevHTML:"<div></div>",buttonNextEvent:"click",buttonPrevEvent:"click",buttonNextCallback:null,buttonPrevCallback:null,itemFallbackDimension:null},windowLoaded=!1;$(window).bind("load.jcarousel",function(){windowLoaded=!0}),$.jcarousel=function(e,o){this.options=$.extend({},defaults,o||{}),this.locked=!1,this.autoStopped=!1,this.container=null,this.clip=null,this.list=null,this.buttonNext=null,this.buttonPrev=null,this.buttonNextState=null,this.buttonPrevState=null,o&&void 0!==o.rtl||(this.options.rtl="rtl"==($(e).attr("dir")||$("html").attr("dir")||"").toLowerCase()),this.wh=this.options.vertical?"height":"width",this.lt=this.options.vertical?"top":this.options.rtl?"right":"left";for(var skin="",split=e.className.split(" "),i=0;i<split.length;i++)if(-1!=split[i].indexOf("jcarousel-skin")){$(e).removeClass(split[i]),skin=split[i];break}"UL"==e.nodeName.toUpperCase()||"OL"==e.nodeName.toUpperCase()?(this.list=$(e),this.clip=this.list.parents(".jcarousel-clip"),this.container=this.list.parents(".jcarousel-container")):(this.container=$(e),this.list=this.container.find("ul,ol").eq(0),this.clip=this.container.find(".jcarousel-clip")),0===this.clip.size()&&(this.clip=this.list.wrap("<div></div>").parent()),0===this.container.size()&&(this.container=this.clip.wrap("<div></div>").parent()),""!==skin&&-1==this.container.parent()[0].className.indexOf("jcarousel-skin")&&this.container.wrap('<div class=" '+skin+'"></div>'),this.buttonPrev=$(".jcarousel-prev",this.container),0===this.buttonPrev.size()&&null!==this.options.buttonPrevHTML&&(this.buttonPrev=$(this.options.buttonPrevHTML).appendTo(this.container)),this.buttonPrev.addClass(this.className("jcarousel-prev")),this.buttonNext=$(".jcarousel-next",this.container),0===this.buttonNext.size()&&null!==this.options.buttonNextHTML&&(this.buttonNext=$(this.options.buttonNextHTML).appendTo(this.container)),this.buttonNext.addClass(this.className("jcarousel-next")),this.clip.addClass(this.className("jcarousel-clip")).css({position:"relative"}),this.list.addClass(this.className("jcarousel-list")).css({overflow:"hidden",position:"relative",top:0,margin:0,padding:0}).css(this.options.rtl?"right":"left",0),this.container.addClass(this.className("jcarousel-container")).css({position:"relative"}),!this.options.vertical&&this.options.rtl&&this.container.addClass("jcarousel-direction-rtl").attr("dir","rtl");var di=null!==this.options.visible?Math.ceil(this.clipping()/this.options.visible):null,li=this.list.children("li"),self=this;if(li.size()>0){var wh=0,j=this.options.offset;li.each(function(){self.format(this,j++),wh+=self.dimension(this,di)}),this.list.css(this.wh,wh+100+"px"),o&&void 0!==o.size||(this.options.size=li.size())}this.container.css("display","block"),this.buttonNext.css("display","block"),this.buttonPrev.css("display","block"),this.funcNext=function(){return self.next(),!1},this.funcPrev=function(){return self.prev(),!1},this.funcResize=function(){self.resizeTimer&&clearTimeout(self.resizeTimer),self.resizeTimer=setTimeout(function(){self.reload()},100)},null!==this.options.initCallback&&this.options.initCallback(this,"init"),!windowLoaded&&$jc.isSafari()?(this.buttons(!1,!1),$(window).bind("load.jcarousel",function(){self.setup()})):this.setup()};var $jc=$.jcarousel;$jc.fn=$jc.prototype={jcarousel:"0.2.9"},$jc.fn.extend=$jc.extend=$.extend,$jc.fn.extend({setup:function(){if(this.first=null,this.last=null,this.prevFirst=null,this.prevLast=null,this.animating=!1,this.timer=null,this.resizeTimer=null,this.tail=null,this.inTail=!1,!this.locked){this.list.css(this.lt,this.pos(this.options.offset)+"px");var p=this.pos(this.options.start,!0);this.prevFirst=this.prevLast=null,this.animate(p,!1),$(window).unbind("resize.jcarousel",this.funcResize).bind("resize.jcarousel",this.funcResize),null!==this.options.setupCallback&&this.options.setupCallback(this)}},reset:function(){this.list.empty(),this.list.css(this.lt,"0px"),this.list.css(this.wh,"10px"),null!==this.options.initCallback&&this.options.initCallback(this,"reset"),this.setup()},reload:function(){if(null!==this.tail&&this.inTail&&this.list.css(this.lt,$jc.intval(this.list.css(this.lt))+this.tail),this.tail=null,this.inTail=!1,null!==this.options.reloadCallback&&this.options.reloadCallback(this),null!==this.options.visible){var self=this,di=Math.ceil(this.clipping()/this.options.visible),wh=0,lt=0;this.list.children("li").each(function(i){wh+=self.dimension(this,di),i+1<self.first&&(lt=wh)}),this.list.css(this.wh,wh+"px"),this.list.css(this.lt,-lt+"px")}this.scroll(this.first,!1)},lock:function(){this.locked=!0,this.buttons()},unlock:function(){this.locked=!1,this.buttons()},size:function(s){return void 0!==s&&(this.options.size=s,this.locked||this.buttons()),this.options.size},has:function(i,i2){void 0!==i2&&i2||(i2=i),null!==this.options.size&&i2>this.options.size&&(i2=this.options.size);for(var j=i;i2>=j;j++){var e=this.get(j);if(!e.length||e.hasClass("jcarousel-item-placeholder"))return!1}return!0},get:function(i){return $(">.jcarousel-item-"+i,this.list)},add:function(i,s){var e=this.get(i),old=0,n=$(s);if(0===e.length){var c,j=$jc.intval(i);for(e=this.create(i);;)if(c=this.get(--j),0>=j||c.length){0>=j?this.list.prepend(e):c.after(e);break}}else old=this.dimension(e);"LI"==n.get(0).nodeName.toUpperCase()?(e.replaceWith(n),e=n):e.empty().append(s),this.format(e.removeClass(this.className("jcarousel-item-placeholder")),i);var di=null!==this.options.visible?Math.ceil(this.clipping()/this.options.visible):null,wh=this.dimension(e,di)-old;return i>0&&i<this.first&&this.list.css(this.lt,$jc.intval(this.list.css(this.lt))-wh+"px"),this.list.css(this.wh,$jc.intval(this.list.css(this.wh))+wh+"px"),e},remove:function(i){var e=this.get(i);if(e.length&&!(i>=this.first&&i<=this.last)){var d=this.dimension(e);i<this.first&&this.list.css(this.lt,$jc.intval(this.list.css(this.lt))+d+"px"),e.remove(),this.list.css(this.wh,$jc.intval(this.list.css(this.wh))-d+"px")}},next:function(){null===this.tail||this.inTail?this.scroll("both"!=this.options.wrap&&"last"!=this.options.wrap||null===this.options.size||this.last!=this.options.size?this.first+this.options.scroll:1):this.scrollTail(!1)},prev:function(){null!==this.tail&&this.inTail?this.scrollTail(!0):this.scroll("both"!=this.options.wrap&&"first"!=this.options.wrap||null===this.options.size||1!=this.first?this.first-this.options.scroll:this.options.size)},scrollTail:function(b){if(!this.locked&&!this.animating&&this.tail){this.pauseAuto();var pos=$jc.intval(this.list.css(this.lt));pos=b?pos+this.tail:pos-this.tail,this.inTail=!b,this.prevFirst=this.first,this.prevLast=this.last,this.animate(pos)}},scroll:function(i,a){this.locked||this.animating||(this.pauseAuto(),this.animate(this.pos(i),a))},pos:function(i,fv){var pos=$jc.intval(this.list.css(this.lt));if(this.locked||this.animating)return pos;"circular"!=this.options.wrap&&(i=1>i?1:this.options.size&&i>this.options.size?this.options.size:i);for(var g,back=this.first>i,f="circular"!=this.options.wrap&&this.first<=1?1:this.first,c=back?this.get(f):this.get(this.last),j=back?f:f-1,e=null,l=0,p=!1,d=0;back?--j>=i:++j<i;)e=this.get(j),p=!e.length,0===e.length&&(e=this.create(j).addClass(this.className("jcarousel-item-placeholder")),c[back?"before":"after"](e),null!==this.first&&"circular"==this.options.wrap&&null!==this.options.size&&(0>=j||j>this.options.size)&&(g=this.get(this.index(j)),g.length&&(e=this.add(j,g.clone(!0))))),c=e,d=this.dimension(e),p&&(l+=d),null!==this.first&&("circular"==this.options.wrap||j>=1&&(null===this.options.size||j<=this.options.size))&&(pos=back?pos+d:pos-d);var clipping=this.clipping(),cache=[],visible=0,v=0;for(c=this.get(i-1),j=i;++visible;){if(e=this.get(j),p=!e.length,0===e.length&&(e=this.create(j).addClass(this.className("jcarousel-item-placeholder")),0===c.length?this.list.prepend(e):c[back?"before":"after"](e),null!==this.first&&"circular"==this.options.wrap&&null!==this.options.size&&(0>=j||j>this.options.size)&&(g=this.get(this.index(j)),g.length&&(e=this.add(j,g.clone(!0))))),c=e,d=this.dimension(e),0===d)throw new Error("jCarousel: No width/height set for items. This will cause an infinite loop. Aborting...");if("circular"!=this.options.wrap&&null!==this.options.size&&j>this.options.size?cache.push(e):p&&(l+=d),v+=d,v>=clipping)break;j++}for(var x=0;x<cache.length;x++)cache[x].remove();l>0&&(this.list.css(this.wh,this.dimension(this.list)+l+"px"),back&&(pos-=l,this.list.css(this.lt,$jc.intval(this.list.css(this.lt))-l+"px")));var last=i+visible-1;if("circular"!=this.options.wrap&&this.options.size&&last>this.options.size&&(last=this.options.size),j>last)for(visible=0,j=last,v=0;++visible&&(e=this.get(j--),e.length)&&(v+=this.dimension(e),!(v>=clipping)););var first=last-visible+1;if("circular"!=this.options.wrap&&1>first&&(first=1),this.inTail&&back&&(pos+=this.tail,this.inTail=!1),this.tail=null,"circular"!=this.options.wrap&&last==this.options.size&&last-visible+1>=1){var m=$jc.intval(this.get(last).css(this.options.vertical?"marginBottom":"marginRight"));v-m>clipping&&(this.tail=v-clipping-m)}for(fv&&i===this.options.size&&this.tail&&(pos-=this.tail,this.inTail=!0);i-->first;)pos+=this.dimension(this.get(i));return this.prevFirst=this.first,this.prevLast=this.last,this.first=first,this.last=last,pos},animate:function(p,a){if(!this.locked&&!this.animating){this.animating=!0;var self=this,scrolled=function(){if(self.animating=!1,0===p&&self.list.css(self.lt,0),!self.autoStopped&&("circular"==self.options.wrap||"both"==self.options.wrap||"last"==self.options.wrap||null===self.options.size||self.last<self.options.size||self.last==self.options.size&&null!==self.tail&&!self.inTail)&&self.startAuto(),self.buttons(),self.notify("onAfterAnimation"),"circular"==self.options.wrap&&null!==self.options.size)for(var i=self.prevFirst;i<=self.prevLast;i++)null===i||i>=self.first&&i<=self.last||!(1>i||i>self.options.size)||self.remove(i)};if(this.notify("onBeforeAnimation"),this.options.animation&&a!==!1){var o=this.options.vertical?{top:p}:this.options.rtl?{right:p}:{left:p},settings={duration:this.options.animation,easing:this.options.easing,complete:scrolled};$.isFunction(this.options.animationStepCallback)&&(settings.step=this.options.animationStepCallback),this.list.animate(o,settings)}else this.list.css(this.lt,p+"px"),scrolled()}},startAuto:function(s){if(void 0!==s&&(this.options.auto=s),0===this.options.auto)return this.stopAuto();if(null===this.timer){this.autoStopped=!1;var self=this;this.timer=window.setTimeout(function(){self.next()},1e3*this.options.auto)}},stopAuto:function(){this.pauseAuto(),this.autoStopped=!0},pauseAuto:function(){null!==this.timer&&(window.clearTimeout(this.timer),this.timer=null)},buttons:function(n,p){null==n&&(n=!this.locked&&0!==this.options.size&&(this.options.wrap&&"first"!=this.options.wrap||null===this.options.size||this.last<this.options.size),this.locked||this.options.wrap&&"first"!=this.options.wrap||null===this.options.size||!(this.last>=this.options.size)||(n=null!==this.tail&&!this.inTail)),null==p&&(p=!this.locked&&0!==this.options.size&&(this.options.wrap&&"last"!=this.options.wrap||this.first>1),this.locked||this.options.wrap&&"last"!=this.options.wrap||null===this.options.size||1!=this.first||(p=null!==this.tail&&this.inTail));var self=this;this.buttonNext.size()>0?(this.buttonNext.unbind(this.options.buttonNextEvent+".jcarousel",this.funcNext),n&&this.buttonNext.bind(this.options.buttonNextEvent+".jcarousel",this.funcNext),this.buttonNext[n?"removeClass":"addClass"](this.className("jcarousel-next-disabled")).attr("disabled",n?!1:!0),null!==this.options.buttonNextCallback&&this.buttonNext.data("jcarouselstate")!=n&&this.buttonNext.each(function(){self.options.buttonNextCallback(self,this,n)}).data("jcarouselstate",n)):null!==this.options.buttonNextCallback&&this.buttonNextState!=n&&this.options.buttonNextCallback(self,null,n),this.buttonPrev.size()>0?(this.buttonPrev.unbind(this.options.buttonPrevEvent+".jcarousel",this.funcPrev),p&&this.buttonPrev.bind(this.options.buttonPrevEvent+".jcarousel",this.funcPrev),this.buttonPrev[p?"removeClass":"addClass"](this.className("jcarousel-prev-disabled")).attr("disabled",p?!1:!0),null!==this.options.buttonPrevCallback&&this.buttonPrev.data("jcarouselstate")!=p&&this.buttonPrev.each(function(){self.options.buttonPrevCallback(self,this,p)}).data("jcarouselstate",p)):null!==this.options.buttonPrevCallback&&this.buttonPrevState!=p&&this.options.buttonPrevCallback(self,null,p),this.buttonNextState=n,this.buttonPrevState=p},notify:function(evt){var state=null===this.prevFirst?"init":this.prevFirst<this.first?"next":"prev";this.callback("itemLoadCallback",evt,state),this.prevFirst!==this.first&&(this.callback("itemFirstInCallback",evt,state,this.first),this.callback("itemFirstOutCallback",evt,state,this.prevFirst)),this.prevLast!==this.last&&(this.callback("itemLastInCallback",evt,state,this.last),this.callback("itemLastOutCallback",evt,state,this.prevLast)),this.callback("itemVisibleInCallback",evt,state,this.first,this.last,this.prevFirst,this.prevLast),this.callback("itemVisibleOutCallback",evt,state,this.prevFirst,this.prevLast,this.first,this.last)},callback:function(cb,evt,state,i1,i2,i3,i4){if(null!=this.options[cb]&&("object"==typeof this.options[cb]||"onAfterAnimation"==evt)){var callback="object"==typeof this.options[cb]?this.options[cb][evt]:this.options[cb];if($.isFunction(callback)){var self=this;if(void 0===i1)callback(self,state,evt);else if(void 0===i2)this.get(i1).each(function(){callback(self,this,i1,state,evt)});else for(var call=function(i){self.get(i).each(function(){callback(self,this,i,state,evt)})},i=i1;i2>=i;i++)null===i||i>=i3&&i4>=i||call(i)}}},create:function(i){return this.format("<li></li>",i)},format:function(e,i){e=$(e);for(var split=e.get(0).className.split(" "),j=0;j<split.length;j++)-1!=split[j].indexOf("jcarousel-")&&e.removeClass(split[j]);return e.addClass(this.className("jcarousel-item")).addClass(this.className("jcarousel-item-"+i)).css({"float":this.options.rtl?"right":"left","list-style":"none"}).attr("jcarouselindex",i),e},className:function(c){return c+" "+c+(this.options.vertical?"-vertical":"-horizontal")},dimension:function(e,d){var el=$(e);if(null==d)return this.options.vertical?el.innerHeight()+$jc.intval(el.css("margin-top"))+$jc.intval(el.css("margin-bottom"))+$jc.intval(el.css("border-top-width"))+$jc.intval(el.css("border-bottom-width"))||$jc.intval(this.options.itemFallbackDimension):el.innerWidth()+$jc.intval(el.css("margin-left"))+$jc.intval(el.css("margin-right"))+$jc.intval(el.css("border-left-width"))+$jc.intval(el.css("border-right-width"))||$jc.intval(this.options.itemFallbackDimension);var w=this.options.vertical?d-$jc.intval(el.css("marginTop"))-$jc.intval(el.css("marginBottom")):d-$jc.intval(el.css("marginLeft"))-$jc.intval(el.css("marginRight"));return $(el).css(this.wh,w+"px"),this.dimension(el)},clipping:function(){return this.options.vertical?this.clip[0].offsetHeight-$jc.intval(this.clip.css("borderTopWidth"))-$jc.intval(this.clip.css("borderBottomWidth")):this.clip[0].offsetWidth-$jc.intval(this.clip.css("borderLeftWidth"))-$jc.intval(this.clip.css("borderRightWidth"))},index:function(i,s){return null==s&&(s=this.options.size),Math.round(((i-1)/s-Math.floor((i-1)/s))*s)+1}}),$jc.extend({defaults:function(d){return $.extend(defaults,d||{})},intval:function(v){return v=parseInt(v,10),isNaN(v)?0:v},windowLoaded:function(){windowLoaded=!0},isSafari:function(){var ua=navigator.userAgent.toLowerCase(),match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||[],browser=match[1]||"";return"webkit"===browser}}),$.fn.jcarousel=function(o){if("string"==typeof o){var instance=$(this).data("jcarousel"),args=Array.prototype.slice.call(arguments,1);return instance[o].apply(instance,args)}return this.each(function(){var instance=$(this).data("jcarousel");instance?(o&&$.extend(instance.options,o),instance.reload()):$(this).data("jcarousel",new $jc(this,o))})}}(jQuery),void function(){var GSM_MERCHANTS_CONTAINER_SELECTOR,GSM_SEARCH_SPACE_SELECTOR,MerchantsCarousel;GSM_SEARCH_SPACE_SELECTOR="#gsm-search-space",GSM_MERCHANTS_CONTAINER_SELECTOR=".gsm-merchants-container",Modules.Seo.UI.MerchantsCarousel=Modules.Seo.Helpers.Experiments.merchantCarouselEnabled?MerchantsCarousel={render:function(search){var merchantSearchResultsHtml;return merchantSearchResultsHtml=search.page.merchantSearchResultsHtml,null!=merchantSearchResultsHtml&&$(GSM_SEARCH_SPACE_SELECTOR).html(merchantSearchResultsHtml),$(GSM_MERCHANTS_CONTAINER_SELECTOR).show(),MerchantsCarousel.start($(GSM_SEARCH_SPACE_SELECTOR))},start:function($el){return $el.find(".jcarousel-list").jcarousel({visible:3,itemFallbackDimension:320}),GIG.Utils.truncateElements($el,{watch:!1})}}:{}}.call(this),void function(){var onShowMoreClick;null!=window.Modules?window.Modules:window.Modules={},null!=Modules.Seo?Modules.Seo:Modules.Seo={},null!=Modules.Seo.UI?Modules.Seo.UI:Modules.Seo.UI={},Modules.Seo.UI.renderMerchantPlacesWidget=function(htmlString){var target;if(null!=htmlString)return target=$(".seo-platform-merchant-places-html-replacement-target").first(),target.after(htmlString),target.remove(),Modules.Seo.UI.registerClickHandlersForMerchantPlacesWidget()},Modules.Seo.UI.registerClickHandlersForMerchantPlacesWidget=function(){return $(".seo-platform-merchant-places .show-more-trigger").click(function(evt){return onShowMoreClick(evt)})},onShowMoreClick=function(){var hiddenCount,listPageSize,totalCount;return listPageSize=$(".seo-platform-merchant-places").data("listPageSize"),$(".seo-platform-merchant-places .hidden-for-paging").slice(0,listPageSize).removeClass("hidden-for-paging").show(),hiddenCount=$(".seo-platform-merchant-places .hidden-for-paging").length,0===hiddenCount&&$(".seo-platform-merchant-places .show-more-trigger").hide(),totalCount=$(".seo-platform-merchant-places .merchant-place").length,$(".seo-platform-merchant-places .current-list-count").text(totalCount-hiddenCount),$(".seo-platform-merchant-places .show-more-button .count").text(Math.min(hiddenCount,listPageSize))},$(function(){return Modules.Seo.UI.registerClickHandlersForMerchantPlacesWidget()})}.call(this),Modules.Deals.Views.PageHeader=function(){function PageHeader(param$){var cache$;cache$=param$,this.search=cache$.search,this.$dealsMessage=cache$.$dealsMessage,this.$dealsContent=cache$.$dealsContent,this.breadcrumb=cache$.breadcrumb,this.heroMerchantHtml=this.search.page.heroMerchantHtml,this.$el=$(TITLE_SELECTOR)}var TITLE_SELECTOR;return TITLE_SELECTOR=".browse-title-heading a",PageHeader.prototype.render=function(){var cache$,href,text;return(null!=this.breadcrumb?this.breadcrumb.isEnabled:void 0)&&(cache$=this.breadcrumb.pageTitleLink,text=cache$.text,href=cache$.href,this.$el.attr("href",href),this.$el.text(text)),null!=this.heroMerchantHtml&&Modules.Seo.Helpers.Experiments.merchantMatchEnabled?(this.$dealsContent.find(".nearby-deals-heading").removeClass("hide"),this.$dealsMessage.show()):Groupon.onNoDealsPage?this.$dealsMessage.show():void 0},PageHeader}(),void function(){var commonLibrary,extend;extend=("undefined"!=typeof _&&null!=_?_:require("underscore")).extend,commonLibrary={exportHelper:function(mountingPoint,mountingPath,mountingName,mountedFunction){var currentMountPoint,mountingPathComponent;currentMountPoint=mountingPoint;for(var i$=0,length$=mountingPath.length;length$>i$;++i$)mountingPathComponent=mountingPath[i$],null!=currentMountPoint[mountingPathComponent]?currentMountPoint[mountingPathComponent]:currentMountPoint[mountingPathComponent]={},currentMountPoint=currentMountPoint[mountingPathComponent];return currentMountPoint[mountingName]=mountedFunction}},null!=("undefined"!=typeof module&&null!=module?module.exports:void 0)?module.exports=extend({},commonLibrary,{getChildren:function(collection){return collection.children},getAttribute:function(model,attribute){return model[attribute]},setAttribute:function(model,attribute,value){return model[attribute]=value},getCollectionModels:function(collection){return collection},commonTranslate:function(I18n){return extend({},I18n,{commonTranslate:function(key,options){return I18n.t(key,options)}})}}):"undefined"!=typeof Modules&&null!=Modules&&(Modules.Shared.Helpers.exportHelpers=extend({},commonLibrary,{getChildren:function(collection){return null!=collection.children?collection.children.toJSON():void 0},getAttribute:function(model,attribute){return model.get(attribute)},setAttribute:function(model,attribute,value){return model.set(attribute,value)},getCollectionModels:function(collection){return collection.models},commonTranslate:function(I18n){return extend({},I18n,{commonTranslate:function(key,options){return I18n.t("js."+key,options)}})}}))}.call(this),void function(){var Crumb,exportHelper;exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,Crumb=function(){function Crumb(param$){var cache$;cache$=param$,this.title=cache$.title,this.friendlyName=cache$.friendlyName,this.id=cache$.id,this.href=cache$.href,this.showSeparator=cache$.showSeparator,this.showHref=cache$.showHref,null!=this.showHref?this.showHref:this.showHref=!0,null!=this.showSeparator?this.showSeparator:this.showSeparator=!0}return Crumb.prototype.getTitle=function(){return null!=this.title?this.title:this.friendlyName},Crumb}(),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Breadcrumb.Models:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Breadcrumb.Models:void 0:module.exports,[],"Crumb",Crumb)}.call(this),void function(){var cache$,contains,exportHelper,getAncestors,getCommonAncestor,getOrderedCommonNodes,getSelectedNodes,min,uniq;exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,cache$="undefined"!=typeof _&&null!=_?_:require("underscore"),contains=cache$.contains,min=cache$.min,uniq=cache$.uniq,getOrderedCommonNodes=function(nodes,selectedIds,idKey,childrenKey){var commonAncestor,selectedNodes;return null==idKey&&(idKey="id"),null==childrenKey&&(childrenKey="children"),selectedNodes=getSelectedNodes(nodes,childrenKey,function(node){return contains(selectedIds,node[idKey])}),selectedNodes.length?(commonAncestor=getCommonAncestor(selectedNodes),getAncestors(commonAncestor)):void 0},getSelectedNodes=function(nodes,childrenKey,isSelectedFunction,parent){var node,selectedChildNodes,selectedNodes;selectedNodes=[];for(var i$=0,length$=nodes.length;length$>i$;++i$)node=nodes[i$],null!=node.parent?node.parent:node.parent=parent,isSelectedFunction(node)&&selectedNodes.push(node),node[childrenKey]&&(selectedChildNodes=getSelectedNodes(node[childrenKey],childrenKey,isSelectedFunction,node)),(null!=selectedChildNodes?selectedChildNodes.length:void 0)&&(selectedNodes=selectedNodes.concat(selectedChildNodes));return selectedNodes},getCommonAncestor=function(nodes,parentKey){var ancestors,ancestorsAtCurrentLevel,commonAncestor,i,lengths,matrixOfAncestors,node,shortestLength;if(null==parentKey&&(parentKey="parent"),null!=nodes?nodes.length:void 0){if(1===nodes.length)return nodes[0];if(2===nodes.length&&nodes[0][parentKey]===nodes[1])return nodes[0];if(2===nodes.length&&nodes[1][parentKey]===nodes[0])return nodes[1];matrixOfAncestors=[],lengths=[];for(var i$=0,length$=nodes.length;length$>i$;++i$)node=nodes[i$],ancestors=getAncestors(node),matrixOfAncestors.push(ancestors),lengths.push(ancestors.length);shortestLength=min(lengths),commonAncestor=void 0;for(var cache$1=function(){var accum$;accum$=[];for(var i$1=0;shortestLength-1>=0?shortestLength-1>=i$1:i$1>=shortestLength-1;shortestLength-1>=0?++i$1:--i$1)accum$.push(i$1);return accum$}.apply(this,arguments),i$1=0,length$1=cache$1.length;length$1>i$1;++i$1)i=cache$1[i$1],ancestorsAtCurrentLevel=function(accum$){for(var ancestor,i$2=0,length$2=matrixOfAncestors.length;length$2>i$2;++i$2)ancestor=matrixOfAncestors[i$2],accum$.push(ancestor[i]);return accum$}.call(this,[]),1===uniq(ancestorsAtCurrentLevel).length&&(commonAncestor=ancestorsAtCurrentLevel[0]);return commonAncestor}},getAncestors=function(node,parentKey){var ancestor,ancestors;if(null==parentKey&&(parentKey="parent"),node){for(ancestors=[node],ancestor=node;ancestor[parentKey];)ancestor=ancestor[parentKey],ancestors.push(ancestor);return ancestors.reverse()}},exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers:void 0:module.exports,[],"treeTraversal",{getOrderedCommonNodes:getOrderedCommonNodes,getSelectedNodes:getSelectedNodes})}.call(this),void function(){var cache$,cache$1,contains,Crumb,extend,find,getDefaultCategoryCrumb,getFacetValues,getOrderedCommonNodes,getPageTitleLink,getParsedParams,getSelectedNodes,isArray,last;cache$=_,isArray=cache$.isArray,contains=cache$.contains,extend=cache$.extend,find=cache$.find,last=cache$.last,cache$1=Modules.Shared.Helpers.treeTraversal,getOrderedCommonNodes=cache$1.getOrderedCommonNodes,getSelectedNodes=cache$1.getSelectedNodes,Crumb=Modules.Breadcrumb.Models.Crumb,Modules.Breadcrumb.Presenters.Breadcrumb=function(){function Breadcrumb(param$){var cache$2,page,params;cache$2=param$,page=cache$2.page,params=cache$2.params,page.facets&&(this.division=Groupon.division,this.isLocalPage=params.isLocalPage,this.facets=page.facets,this.categories=getFacetValues(this.facets,CATEGORY_FACET_KEY),this.locations=getFacetValues(this.facets,LOCATION_FACET_KEY),this.isEnabled=!0,this.baseURL=this.isLocalPage?Groupon.urls.local:Groupon.urls.browse,this.parsedParams=getParsedParams(params,this.categories))}var CATEGORY_FACET_KEY,LOCATION_FACET_KEY;return CATEGORY_FACET_KEY={raw:"topcategory|category|category2|category3",structured:"categories"},LOCATION_FACET_KEY={raw:"city|neighborhood",structured:"refinementLocations"},Breadcrumb.prototype.isEnabled=!1,Breadcrumb.prototype.crumbs=[],Breadcrumb.prototype.toHash=function(){var breadcrumb,crumbsHash;return breadcrumb={isEnabled:this.isEnabled},breadcrumb.isEnabled&&(crumbsHash=this._getCrumbsHash(),extend(breadcrumb,crumbsHash,{pageTitleLink:getPageTitleLink(crumbsHash.lowestCategory,crumbsHash.lowestLocation)})),{breadcrumb:breadcrumb}},Breadcrumb.prototype._getCrumbsHash=function(){var categories,locations;return categories=this._getCategoryCrumbs(),locations=this._getLocationCrumbs(),{crumbs:locations.concat(categories),lowestCategory:last(categories),lowestLocation:last(locations)}},Breadcrumb.prototype._getLocalCrumb=function(){return new Crumb({title:this.division.name,friendlyName:I18n.translate("js.modules.breadcrumb.presenters.local_friendly_name"),href:""+this.baseURL+"/"+this.division.id+"?context=local",showSeparator:!1})},Breadcrumb.prototype._getLocationCrumbs=function(){var cache$2,location,locationCrumbs,locations;locationCrumbs=[this._getLocalCrumb()],cache$2=getOrderedCommonNodes(this.locations,this.parsedParams.locations),locations=null!=cache$2?cache$2:[];for(var i$=0,length$=locations.length;length$>i$;++i$)location=locations[i$],locationCrumbs.push(new Crumb({id:location.id,friendlyName:location.friendlyName,href:this._getLocationHref(location)}));return locationCrumbs},Breadcrumb.prototype._getLocationHref=function(location){return this.isLocalPage?location.parent?""+this.baseURL+"/"+this.division.id+"/"+location.id:""+this.baseURL+"/"+this.division.id:""+this.baseURL+"/"+this.division.id+"?location="+location.id},Breadcrumb.prototype._getCategoryCrumbs=function(){var cache$2,cache$3,category,categoryCrumbs,lowestCategory,matchingCategory,orderedCategories;if(!this.parsedParams.category)return[getDefaultCategoryCrumb()];if(categoryCrumbs=[],this.parsedParams.subCategories.length?(cache$3=getOrderedCommonNodes(this.categories,this.parsedParams.subCategories),cache$2=null!=cache$3?cache$3:[],this.topCategory=cache$2[0],orderedCategories=2<=cache$2.length?[].slice.call(cache$2,1):[]):(matchingCategory=find(this.categories[0].children,function(this$){return function(cat){return cat.id===this$.parsedParams.category}}(this)),orderedCategories=null!=matchingCategory?[matchingCategory]:[]),!orderedCategories.length)return[getDefaultCategoryCrumb()];lowestCategory=this.parsedParams.selectedl4s.length?this.parsedParams.selectedl4s:this.parsedParams.selectedl3s.length?this.parsedParams.selectedl3s:this.parsedParams.selectedl2s.length?this.parsedParams.selectedl2s:void 0;for(var i$=0,length$=orderedCategories.length;length$>i$;++i$)category=orderedCategories[i$],categoryCrumbs.push(new Crumb({id:category.id,friendlyName:category.friendlyName,href:this._getCategoryHref(category),showHref:contains(lowestCategory,category.id)?!1:void 0}));return categoryCrumbs},Breadcrumb.prototype._getCategoryHref=function(category){var l2Categories,l3Categories,l4Categories;return this.isLocalPage?""+this.baseURL+"/"+this.division.id+"/"+category.id:(l2Categories=[],l3Categories=[],l4Categories=[],contains(this.parsedParams.selectedl4s,category.id)?(l4Categories.push(category.id),l3Categories.push(category.parent.id),l2Categories.push(category.parent.parent.id)):contains(this.parsedParams.selectedl3s,category.id)?(l3Categories.push(category.id),l2Categories.push(category.parent.id)):contains(this.parsedParams.selectedl2s,category.id)&&l2Categories.push(category.id),prettyUrls.V1.construct({baseURL:this.baseURL,division:this.division.id,l2Categories:l2Categories,l3Categories:l3Categories,l4Categories:l4Categories,interests:[],locations:[]}))},Breadcrumb}(),getPageTitleLink=function(categoryCrumb,locationCrumb){var pageTitleText;return pageTitleText=I18n.t("js.modules.breadcrumb.presenters.page_title_format",{categoryText:categoryCrumb.getTitle(),locationText:locationCrumb.getTitle()}),{text:pageTitleText,href:categoryCrumb.href,id:categoryCrumb.id}},getDefaultCategoryCrumb=function(){var defaultCategory;return defaultCategory=Groupon.Categories.defaultCategory,new Crumb({id:defaultCategory.id,friendlyName:defaultCategory.friendlyName,showHref:!1})},getParsedParams=function(params,categories){var cache$2,category,category2,category3,division,l4Categories,l4Category,location,locations,selectedl2s,selectedl3s,selectedl4,selectedl4s,subCategories;cache$2=params,category=cache$2.category,category2=cache$2.category2,category3=cache$2.category3,division=cache$2.division,location=cache$2.location,selectedl2s=[category],selectedl3s=category2?category2.split(","):[],selectedl4s=category3?category3.split(","):[],locations=location?location.split(","):[],subCategories=[].concat(selectedl3s,selectedl4s);for(var i$=0,length$=selectedl4s.length;length$>i$;++i$){selectedl4=selectedl4s[i$],l4Categories=getSelectedNodes(categories,"children",function(cat){return contains(selectedl4s,cat.id)});for(var i$1=0,length$1=l4Categories.length;length$1>i$1;++i$1)l4Category=l4Categories[i$1],contains(selectedl3s,l4Category.parent.id)||selectedl3s.push(l4Category.parent.id)}return{category:category,division:division,locations:locations,selectedl2s:selectedl2s,selectedl3s:selectedl3s,selectedl4s:selectedl4s,subCategories:subCategories}},getFacetValues=function(facets,facetKey){var facet;return isArray(facets)?(facet=find(facets,function(facet){return facet.id===facetKey.raw
}),null!=facet?facet.values:void 0):facets[facetKey.structured]}}.call(this),Modules.Breadcrumb.Views.Breadcrumb=function(super$){function Breadcrumb(param$){var $module,breadcrumb;this.presenter=param$,breadcrumb=this.presenter.breadcrumb,breadcrumb.isEnabled&&$(BREADCRUMB_SELECTOR).length&&($module=$(BREADCRUMB_SELECTOR),this.$el=$module.wrap('<div class="module-container"></div>').parent())}var BREADCRUMB_SELECTOR;return extends$(Breadcrumb,super$),BREADCRUMB_SELECTOR=".module.breadcrumb",Breadcrumb.prototype.template=Groupon.MustacheTemplates.breadcrumb,Breadcrumb.prototype.render=function(){return this.$el.html(this.toHtml())},Breadcrumb.prototype.toHtml=function(){return this.template.render(this.presenter)},Breadcrumb.prototype.getSelector=function(){var selector;return selector=$(BREADCRUMB_SELECTOR),selector.length?selector:void 0},Breadcrumb}(Backbone.View),void function(){var addCategoryParam,getFacetGroupFiltersParam,initializeParams,shouldDistanceSort,unfilteredParams;Modules.Deals.Helpers.SearchParams={getBaseParams:function(options){var params,parsedParams;return null==options&&(options={}),params=initializeParams(options),params.division=Cookie.get("division"),addCategoryParam(params)&&(params.category=Groupon.browseApp.getSelectedCategory()),params.facet_group_filters=getFacetGroupFiltersParam(options),(null!=Groupon.RefinementBar?Groupon.RefinementBar.isLeftBarVisible:void 0)&&(params.isRefinementBarDisplayed=!0),params.isLocalPage=Groupon.isLocalPage,params.isLocalCategoryPage=Groupon.isLocalCategoryPage,null!=Groupon.isNationalPage&&(params.isNationalPage=Groupon.isNationalPage),null!=Groupon.isNationalTicketsPage&&(params.isNationalTicketsPage=Groupon.isNationalTicketsPage),Groupon.isLocalPage&&(parsedParams=Modules.RefinementBar.Application.getParsedParams(),_.extend(params,parsedParams,{context:"local"})),options.omitSearch&&delete params.query,!shouldDistanceSort(Groupon.division,params)||null!=params.lat&&null!=params.lng||_.extend(params,{lat:Groupon.division.lat,lng:Groupon.division.lng}),params}},initializeParams=function(options){var parsedParams;return null!=options.params?_.clone(options.params):(parsedParams=Groupon.Utils.unparam(),options.unfiltered?unfilteredParams(parsedParams):parsedParams)},unfilteredParams=function(params){return _.pick(params,"address","lat","lng","page","sort")},addCategoryParam=function(params){return!(null!=params.category)&&Groupon.browseApp.isCategoryPage()},getFacetGroupFiltersParam=function(options){return null!=options.facet_group_filters?options.facet_group_filters:_.isEmpty(Modules.RefinementBar.Application.filterString)?"topcategory|category|category2|category3;deal_type;city|neighborhood":Modules.RefinementBar.Application.filterString},shouldDistanceSort=function(division,params){return null==division&&(division={}),division.lat&&division.lng&&"distance"===params.sort}}.call(this),void function(){var Page,performSearch;Page=function(){function Page(pageNumber,data){var paginationData;paginationData=data.metadata.pagination,_.extend(this,{totalDealCount:paginationData.availableCount,bloodhoundHtml:paginationData.bloodhoundHtml,dealsHtml:data.dealsHtml,editorialWidgetHtml:data.editorialWidgetHtml,crosslinksHtml:data.crosslinksHtml,featuredHtml:data.featuredHtml,featuredListViewHtml:data.featuredListViewHtml,heroMerchantHtml:data.heroMerchantHtml,merchantSearchResultsHtml:data.merchantSearchResultsHtml,merchantPlacesHtml:data.merchantPlacesHtml,nextPageSize:paginationData.nextPageSize,number:pageNumber,totalPages:paginationData.totalPages,facets:data.metadata.facets,firstDeal:data.metadata.firstDeal,startingIndex:paginationData.startingIndex,endingIndex:paginationData.endingIndex,onMerchandisedPage:!!data.metadata.onMerchandisedPage})}return Page}(),performSearch=function(params){var search;return null==params&&(params={}),null!=this.xhr&&this.xhr.abort(),this.xhr=$.ajax({url:"/browse/deals/partial",data:params}),search=_.clone(Backbone.Events),this.xhr.done(_(search.trigger).bind(search,"success")),this.xhr.fail(function(xhr,textStatus){return"abort"!==textStatus?search.trigger("error"):void 0}),this.xhr.always(function(){return search.trigger.apply(search,["complete"].concat([].slice.call(arguments))),search.off()}),{on:_(search.once).bind(search)}},Modules.Deals.Application=function(){function Application(options){var $dealsMessage,dealsSearch,instance$;instance$=this,this._triggerSuccessHandler=function(){return Application.prototype._triggerSuccessHandler.apply(instance$,arguments)},this._triggerErrorHandler=function(){return Application.prototype._triggerErrorHandler.apply(instance$,arguments)},null==options&&(options={}),this._events=_.extend({},Backbone.Events),this.params=Modules.Deals.Helpers.SearchParams.getBaseParams(options),Groupon.gsmFirstVisit&&(Groupon.gsmFirstVisit=!1,this.params.gsmFirstVisit=!0),Groupon.onEmptyMerchandisedPage&&(Groupon.onEmptyMerchandisedPage=!1,this.params.omitMerchandisedPage=!0),this._searchedServerSide=!1,this._pageNumber=isNaN(Number(this.params.page))?1:Number(this.params.page),options.pageData?(this.page=new Page(this._pageNumber,options.pageData),this._searchedServerSide=!0):(null!=options.pageNumber&&(_.extend(this.params,{page:options.pageNumber}),this._pageNumber=options.pageNumber),$dealsMessage=Modules.Browse.Views.Content.prototype.getDealsMessageSelector(),$dealsMessage.find(".hero-merchant").length>0&&(this.params.heroless=!0,this.heroMerchantHtml=$dealsMessage.html()),dealsSearch=performSearch(this.params),dealsSearch.on("error",this._triggerErrorHandler),dealsSearch.on("success",this._triggerSuccessHandler))}return Application.prototype.on=function(event,callback){return this._events.on(event,callback)},Application.prototype.unfilteredParams=function(){return unfilteredParams(this.params)},Application.prototype._triggerErrorHandler=function(){return this._events.trigger("error"),this._events.stopListening()},Application.prototype._triggerSuccessHandler=function(param$,textStatus){var deals;return null==param$&&(param$={}),deals=param$.deals,"success"!==textStatus?this._triggerErrorHandler():(this.page=new Page(this._pageNumber,deals),Groupon.pagination=null!=deals.metadata?deals.metadata.pagination:void 0,null!=this.heroMerchantHtml&&(this.page.heroMerchantHtml=this.heroMerchantHtml),this._events.trigger("success",deals),this._events.stopListening())},Application.prototype.isEmptySearch=function(){return 0===(null!=this.page?this.page.totalDealCount:void 0)},Application.prototype.isSearchedServerSide=function(){return this._searchedServerSide},Application}()}.call(this),void function(){var CURRENT_PAGE_NUMBER_WITH_BOX,DEFAULT_MAX_PAGINATION_SLOTS_PER_PAGE,exportHelper,getDotsAndLastPage,getFirstPageAndDots,getPageHash,getPagesByRange,omitUndefined,TERMINATOR_AND_DOTS,toArray;exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,omitUndefined=("undefined"!=typeof _&&null!=_?_:require("underscore")).omitUndefined,DEFAULT_MAX_PAGINATION_SLOTS_PER_PAGE=10,TERMINATOR_AND_DOTS=2,CURRENT_PAGE_NUMBER_WITH_BOX=1,toArray=function(param$){var cache$,currentPageNumber,endDotsThreshold,endNumber,getPageUrl,maxPaginationSlotsPerPage,numbersRadius,startDotsThreshold,startNumber,totalPages;return cache$=param$,currentPageNumber=cache$.currentPageNumber,totalPages=cache$.totalPages,getPageUrl=cache$.getPageUrl,maxPaginationSlotsPerPage=cache$.maxPaginationSlotsPerPage,null!=maxPaginationSlotsPerPage||(maxPaginationSlotsPerPage=DEFAULT_MAX_PAGINATION_SLOTS_PER_PAGE),currentPageNumber=parseInt(currentPageNumber),endDotsThreshold=maxPaginationSlotsPerPage-TERMINATOR_AND_DOTS,startDotsThreshold=totalPages-maxPaginationSlotsPerPage+TERMINATOR_AND_DOTS+1,maxPaginationSlotsPerPage>=totalPages?getPagesByRange(1,totalPages,currentPageNumber,getPageUrl):endDotsThreshold>currentPageNumber?[].slice.call(getPagesByRange(1,endDotsThreshold,currentPageNumber,getPageUrl)).concat([].slice.call(getDotsAndLastPage(currentPageNumber,totalPages,getPageUrl))):currentPageNumber>startDotsThreshold?[].slice.call(getFirstPageAndDots(currentPageNumber,getPageUrl)).concat([].slice.call(getPagesByRange(startDotsThreshold,totalPages,currentPageNumber,getPageUrl))):(numbersRadius=(maxPaginationSlotsPerPage-2*TERMINATOR_AND_DOTS-CURRENT_PAGE_NUMBER_WITH_BOX)/2,startNumber=currentPageNumber-Math.floor(numbersRadius),endNumber=currentPageNumber+Math.ceil(numbersRadius),[].slice.call(getFirstPageAndDots(currentPageNumber,getPageUrl)).concat([].slice.call(getPagesByRange(startNumber,endNumber,currentPageNumber,getPageUrl)),[].slice.call(getDotsAndLastPage(currentPageNumber,totalPages,getPageUrl))))},getFirstPageAndDots=function(currentPageNumber,getPageUrl){return[getPageHash(1,currentPageNumber,getPageUrl),{text:"...",box:!1}]},getDotsAndLastPage=function(currentPageNumber,totalPages,getPageUrl){return[{text:"...",box:!1},getPageHash(totalPages,currentPageNumber,getPageUrl)]},getPagesByRange=function(from,to,currentPageNumber,getPageUrl){return function(accum$){for(var pageNumber,cache$=function(){var accum$1;accum$1=[];for(var i$=from;to>=from?to>=i$:i$>=to;to>=from?++i$:--i$)accum$1.push(i$);return accum$1}.apply(this,arguments),i$=0,length$=cache$.length;length$>i$;++i$)pageNumber=cache$[i$],accum$.push(getPageHash(pageNumber,currentPageNumber,getPageUrl));return accum$}.call(this,[])},getPageHash=function(pageNumber,currentPageNumber,getPageUrl){var isCurrentPage;return isCurrentPage=pageNumber===currentPageNumber,omitUndefined({box:isCurrentPage,text:pageNumber,url:isCurrentPage?void 0:getPageUrl(pageNumber)})},"undefined"!=typeof Modules&&null!=Modules&&(Modules.Browse.Helpers.PaginationSlots={}),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.PaginationSlots:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.PaginationSlots:void 0:module.exports,[],"toArray",toArray)}.call(this),void function(){var cache$,cache$1,commonTranslate,exportHelper,getNextPageTranslation,getNextPageUrl,getPreviousPageTranslation,getPreviousPageUrl,getUrlForPageNumber,isEmpty,isSinglePageDeals,omit,PaginationSlots,partial,qs,resultsHtml,toHash;cache$="undefined"!=typeof _&&null!=_?_:require("underscore"),isEmpty=cache$.isEmpty,omit=cache$.omit,partial=cache$.partial,cache$1=null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper"),commonTranslate=cache$1.commonTranslate,exportHelper=cache$1.exportHelper,PaginationSlots=null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.PaginationSlots:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.PaginationSlots:void 0:requireRoot("modules/browse/common/helpers/pagination_slots"),"undefined"!=typeof require&&null!=require&&(qs=require("qs")),toHash=function(attributes,config,modules){var cache$2,currentPageNumber,endingIndex,getPageUrl,I18n,limitResults,nextPageSize,query,requestURL,startingIndex,totalDealCount,totalPages;return null==config&&(config={}),cache$2=attributes,requestURL=cache$2.requestURL,query=cache$2.query,currentPageNumber=cache$2.currentPageNumber,totalPages=cache$2.totalPages,nextPageSize=cache$2.nextPageSize,totalDealCount=cache$2.totalDealCount,startingIndex=cache$2.startingIndex,endingIndex=cache$2.endingIndex,limitResults=cache$2.limitResults,null!=requestURL?(I18n=commonTranslate(modules.I18n),getPageUrl=partial(getUrlForPageNumber,requestURL,query),{resultsHtml:resultsHtml(startingIndex,endingIndex,totalDealCount,limitResults,I18n),displayPagination:!isSinglePageDeals(currentPageNumber,nextPageSize),previousPage:getPreviousPageTranslation(I18n),nextPage:getNextPageTranslation(I18n),previousPageUrl:getPreviousPageUrl(requestURL,query,currentPageNumber),nextPageUrl:getNextPageUrl(requestURL,query,currentPageNumber,nextPageSize),paginationSlots:PaginationSlots.toArray({currentPageNumber:currentPageNumber,totalPages:totalPages,getPageUrl:getPageUrl})}):void 0},getPreviousPageTranslation=function(I18n){return I18n.commonTranslate("modules.browse.presenters.pagination.previous")},getNextPageTranslation=function(I18n){return I18n.commonTranslate("modules.browse.presenters.pagination.next")},getPreviousPageUrl=function(requestURL,queryParams,currentPageNumber){return 1!==currentPageNumber?getUrlForPageNumber(requestURL,queryParams,parseInt(currentPageNumber)-1):void 0},getNextPageUrl=function(requestURL,queryParams,currentPageNumber,nextPageSize){return nextPageSize>0?getUrlForPageNumber(requestURL,queryParams,parseInt(currentPageNumber)+1):void 0},resultsHtml=function(startingIndex,endingIndex,totalDealCount,limitResults,I18n){var translateOptions;return translateOptions={strongOpen:"<strong>",strongClose:"</strong>",totalDealCount:totalDealCount,startingIndex:startingIndex,endingIndex:endingIndex},limitResults?"<span>"+I18n.commonTranslate("modules.browse.presenters.pagination.limited_results",translateOptions)+"</span>":"<span>"+I18n.commonTranslate("modules.browse.presenters.pagination.results",translateOptions)+"</span>"},getUrlForPageNumber=function(requestURL,queryParams,pageNumber){var baseUri,paginationParams,stringify;return null==queryParams&&(queryParams={}),paginationParams=queryParams,paginationParams.page&&delete paginationParams.page,1!==pageNumber&&(paginationParams.page=pageNumber),baseUri=requestURL,baseUri.indexOf("?")>-1&&(baseUri=baseUri.substring(0,baseUri.indexOf("?"))),isEmpty(paginationParams)?baseUri:(stringify=null!=(null!=qs?qs.stringify:void 0)?null!=qs?qs.stringify:void 0:$.param,""+baseUri+"?"+stringify(paginationParams))},isSinglePageDeals=function(pageNumber,nextPageSize){return null==pageNumber||null==nextPageSize?!0:1!==pageNumber?!1:0>=nextPageSize?!0:!1},"undefined"!=typeof Modules&&null!=Modules&&(Modules.Browse.Presenters.PaginationFooter={}),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Presenters.PaginationFooter:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Presenters.PaginationFooter:void 0:module.exports,[],"toHash",toHash)}.call(this),Modules.Shared.Helpers.Experiments={showRecentlyViewed:function(){return Groupon.enabledFeatures.showRecentlyViewed},showRelatedDeals:function(){return Groupon.enabledFeatures.showRelatedDeals}},Modules.Deals.Views.PaginationFooter=function(super$){function PaginationFooter(){var instance$;instance$=this,this.paginationClickHandler=function(){return PaginationFooter.prototype.paginationClickHandler.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(PaginationFooter,super$),PaginationFooter.prototype.template=Groupon.MustacheTemplates.deals_pagination_footer,PaginationFooter.prototype.events={"click .pagination a":"paginationClickHandler"},PaginationFooter.prototype.initialize=function(){return this.presenter=null},PaginationFooter.prototype.updatePresenter=function(dealSearch){var cache$,endingIndex,nextPageSize,number,page,paginationFooter,startingIndex,totalDealCount,totalPages;return page=dealSearch.page,cache$=page,number=cache$.number,totalPages=cache$.totalPages,nextPageSize=cache$.nextPageSize,totalDealCount=cache$.totalDealCount,startingIndex=cache$.startingIndex,endingIndex=cache$.endingIndex,paginationFooter=_.extend({},Modules.Browse.Presenters.PaginationFooter.toHash({requestURL:window.location.pathname,query:Groupon.Utils.unparam(),currentPageNumber:number,totalPages:totalPages,nextPageSize:nextPageSize,totalDealCount:totalDealCount,startingIndex:startingIndex,endingIndex:endingIndex,limitResults:Groupon.enabledFeatures.limitPaginationResults},void 0,{I18n:I18n})),this.presenter={paginationFooter:paginationFooter},this},PaginationFooter.prototype.render=function(){return this.$el.html(this.toHtml())},PaginationFooter.prototype.toHtml=function(){return this.template.render(this.presenter)},PaginationFooter.prototype.paginationClickHandler=function(event){return event.preventDefault(),this.trigger("click:paginationLink",event)},PaginationFooter}(Backbone.View),void function(){var fetchAndRenderDeals,sendPaginationEvent,updateURLAndFetch;Modules.Deals.Helpers.PaginationEvents={updatePageByHref:function(url,shouldScroll){return null==shouldScroll&&(shouldScroll=!0),updateURLAndFetch(url,shouldScroll)},updateToPreviousPage:function(shouldScroll){var qs,queryString,url;return null==shouldScroll&&(shouldScroll=!0),qs=Groupon.Utils.unparam(),qs.page>1?(qs.page--,qs.page<=1&&delete qs.page,queryString=_.isEmpty(qs)?"":"?"+$.param(qs),url=""+window.location.pathname+queryString,updateURLAndFetch(url,shouldScroll)):void 0},updateToNextPage:function(shouldScroll){var qs,url;return null==shouldScroll&&(shouldScroll=!0),qs=Groupon.Utils.unparam(),null!=qs.page?qs.page++:qs.page=2,qs.page>Groupon.pagination.totalPages?void 0:(url=""+window.location.pathname+"?"+$.param(qs),updateURLAndFetch(url,shouldScroll))},popStateHandler:function(currentSearchPage){var cache$,popStatePage;return cache$=Groupon.Utils.unparam().page,popStatePage=null!=cache$?cache$:1,currentSearchPage!==popStatePage?fetchAndRenderDeals():void 0}},updateURLAndFetch=function(url,shouldScroll){return Modules.Shared.Helpers.updateAppURL(url,{pushState:!0}),shouldScroll&&$(document).scrollTop(0),fetchAndRenderDeals()},fetchAndRenderDeals=function(){var paginatedBuilder;return paginatedBuilder=new Modules.Deals.Helpers.PaginatedDealsListViewBuilder({omitSearch:Modules.RefinementBar.Application.omitSearch}),new Modules.Browse.Views.Content({paginatedDealsListViewBuilder:paginatedBuilder}),paginatedBuilder.on("fetchSuccess",function(search){return sendPaginationEvent(search)})},sendPaginationEvent=function(dealSearch){return Modules.Deals.paginationEvents.trigger("newPage",dealSearch.page)}}.call(this),Modules.Deals.Views.PaginatedDealsList=function(){function PaginatedDealsList(param$,param$1){var currentSearchPage;this.$el=param$,this.dealSearch=param$1,this.$content=this.$el.find(".content"),this.prevSearch=null,this.footer=new Modules.Deals.Views.PaginationFooter,this.footer.on("click:paginationLink",this.paginationClickHandler),currentSearchPage=null!=this.dealSearch.params.page?this.dealSearch.params.page:1,window.onpopstate=_.partial(Modules.Deals.Helpers.PaginationEvents.popStateHandler,currentSearchPage)}return PaginatedDealsList.prototype.template=Groupon.MustacheTemplates.deals_paginated_deals_list,PaginatedDealsList.prototype.dealsListId="browse-deals",PaginatedDealsList.prototype.render=function(){return this.dealSearch.isEmptySearch()?void 0:(this.$content.html(this.toHtml()),this.postRender(),Groupon.PageTracking.pageReady())},PaginatedDealsList.prototype.postRender=function(overwriteExisting){var element,options;return null==overwriteExisting&&(overwriteExisting=!0),this.footer.updatePresenter(this.dealSearch).setElement(this.$el.find(".pagination_footer")),overwriteExisting&&this.footer.render(),GIG.Utils.truncateElements(element=this.$content,options={watch:!1})},PaginatedDealsList.prototype.toHtml=function(){return this.template.render(this.present())},PaginatedDealsList.prototype.present=function(){var hash;return hash=_.extend({},this.dealSearch.page,{dealsListId:this.dealsListId,columnLayoutClass:Groupon.columnLayoutClass}),null!=this.dealSearch.page.heroMerchantHtml&&delete hash.featuredHtml,hash},PaginatedDealsList.prototype.paginationClickHandler=function(event){return Modules.Deals.Helpers.PaginationEvents.updatePageByHref(event.target.href)},PaginatedDealsList}(),Modules.Deals.Helpers.PaginatedDealsListViewBuilder=function(){function PaginatedDealsListViewBuilder(param$){var instance$;instance$=this,this.triggerFetchSuccess=function(){return PaginatedDealsListViewBuilder.prototype.triggerFetchSuccess.apply(instance$,arguments)},this.triggerFetchError=function(){return PaginatedDealsListViewBuilder.prototype.triggerFetchError.apply(instance$,arguments)},null==param$&&(param$={}),this.omitSearch=param$.omitSearch,this.events=_.clone(Backbone.Events),this.search=new Modules.Deals.Application(this._searchOptions()),this.search.on("error",this.triggerFetchError),this.search.on("success",this.triggerFetchSuccess)}return PaginatedDealsListViewBuilder.prototype._searchOptions=function(){return Groupon.onNoDealsPage?{unfiltered:!0}:_.omitUndefined({omitSearch:this.omitSearch})},PaginatedDealsListViewBuilder.prototype.triggerFetchError=function(){return this.events.trigger("fetchError"),this.events.stopListening()},PaginatedDealsListViewBuilder.prototype.triggerFetchSuccess=function(){return $(function(this$){return function(){return this$.events.trigger("fetchSuccess",this$.search),this$.events.stopListening()}}(this))},PaginatedDealsListViewBuilder.prototype.on=function(){return this.events.on.apply(this.events,[].slice.call(arguments).concat())},PaginatedDealsListViewBuilder}(),void function(){var updateBreadcrumb,updateCrossLinksWidget,updateDealsList,updateEditorialWidget,updateMerchandisedPage,updateMerchantCarouselWidget,updateMerchantPlacesWidget,updatePageHeader;Modules.Browse.Views.Content=function(){function Content(param$){var cache$,instance$,isContentRendered,paginatedDealsListViewBuilder;instance$=this,this._fetchSuccess=function(){return Content.prototype._fetchSuccess.apply(instance$,arguments)},this._fetchError=function(){return Content.prototype._fetchError.apply(instance$,arguments)},null==param$&&(param$={}),cache$=param$,paginatedDealsListViewBuilder=cache$.paginatedDealsListViewBuilder,isContentRendered=cache$.isContentRendered,this._renderedContent=isContentRendered,this._renderedSpinner=!1,$(function(this$){return function(){return isContentRendered?this$._renderedOnServer():this$._startSpinner()}}(this)),null!=paginatedDealsListViewBuilder&&paginatedDealsListViewBuilder.on("fetchError",this._fetchError).on("fetchSuccess",this._fetchSuccess)}return Content.prototype.SELECTORS={DEAL_CONTENT_CONTAINER:"#deal_content",DEAL_SPACE_MSG_CONTENT:"#deal_space_message_content",DEAL_CONTENT:"#content #deal_content .content",DEAL_SPACE:"#deal-space",HERO_MERCHANT:".hero-merchant",EDITORIAL_WIDGET:"#gsm-editorial-widget",CROSS_LINKS_WIDGET:"#gsm-crosslinks"},Content.prototype.getDealsMessageSelector=function(){return $(this.SELECTORS.DEAL_SPACE_MSG_CONTENT)},Content.prototype.getDealsContentSelector=function(){return $(this.SELECTORS.DEAL_CONTENT_CONTAINER)},Content.prototype._renderedOnServer=function(){return $(function(this$){return function(){var $dealsMessage,completedDealSearch,isServerRendered,pageData;return pageData={metadata:{pagination:Groupon.pagination}},$dealsMessage=Modules.Browse.Views.Content.prototype.getDealsMessageSelector(),$dealsMessage.find(this$.SELECTORS.HERO_MERCHANT).length>0&&(pageData.heroMerchantHtml=$dealsMessage.html()),completedDealSearch=new Modules.Deals.Application({pageData:pageData}),isServerRendered=!0,this$._updateContent(completedDealSearch,isServerRendered)}}(this))},Content.prototype._updateContent=function(search,isServerRendered){var $dealsContent,$dealsMessage,breadcrumb,dealsList;return null==isServerRendered&&(isServerRendered=!1),$dealsMessage=Modules.Browse.Views.Content.prototype.getDealsMessageSelector(),$dealsContent=Modules.Browse.Views.Content.prototype.getDealsContentSelector(),dealsList=new Modules.Deals.Views.PaginatedDealsList($dealsContent,search),breadcrumb=updateBreadcrumb(search),updatePageHeader(search,$dealsMessage,$dealsContent,breadcrumb,isServerRendered),updateDealsList(search,this.SELECTORS,dealsList,isServerRendered),updateMerchantCarouselWidget(search),updateEditorialWidget(search,this.SELECTORS,isServerRendered),updateCrossLinksWidget(search,this.SELECTORS,isServerRendered),updateMerchantPlacesWidget(search,isServerRendered),updateMerchandisedPage(search,$dealsContent,isServerRendered),Groupon.Utils.lazyLoadImages()},Content.prototype._fetchError=function(){return $(function(this$){return function(){return $(this$.SELECTORS.DEAL_CONTENT).html(Modules.Browse.Views.ErrorHtml()),Groupon.PageTracking.pageReady()}}(this)),this._stopSpinner()},Content.prototype._fetchSuccess=function(search){return $(function(this$){return function(){return this$._updateContent(search)}}(this)),this._stopSpinner()},Content.prototype._startSpinner=function(){return this._renderedContent?void 0:(Modules.Page.Helpers.SpinnerGroup.start("deal-content",{el:this.SELECTORS.DEAL_SPACE}),this._renderedSpinner=!0)},Content.prototype._stopSpinner=function(){return this._renderedContent=!0,this._renderedSpinner?Modules.Page.Helpers.SpinnerGroup.stop("deal-content"):void 0},Content}(),updateBreadcrumb=function(search){var $breadcrumbSelector,breadcrumb,breadcrumbPresenter;return $breadcrumbSelector=Modules.Breadcrumb.Views.Breadcrumb.prototype.getSelector(),$breadcrumbSelector&&(breadcrumbPresenter=new Modules.Breadcrumb.Presenters.Breadcrumb(search).toHash(),breadcrumb=breadcrumbPresenter.breadcrumb,breadcrumb.isEnabled&&new Modules.Breadcrumb.Views.Breadcrumb(breadcrumbPresenter).render()),breadcrumb},updatePageHeader=function(search,$dealsMessage,$dealsContent,breadcrumb){return new Modules.Deals.Views.PageHeader({search:search,$dealsMessage:$dealsMessage,$dealsContent:$dealsContent,breadcrumb:breadcrumb}).render()},updateDealsList=function(search,selectors,dealsList,isServerRendered){return isServerRendered?dealsList.postRender(!1):search.page.onMerchandisedPage?$(selectors.DEAL_CONTENT).html(search.page.dealsHtml):dealsList.render()},updateMerchantCarouselWidget=function(search){return Modules.Seo.Helpers.Experiments.merchantCarouselEnabled?Modules.Seo.UI.MerchantsCarousel.render(search):void 0},updateEditorialWidget=function(search,selectors,isServerRendered){var $editorialWidget;return Modules.Seo.Helpers.Experiments.editorialWidgetEnabled?(isServerRendered||($editorialWidget=$(selectors.EDITORIAL_WIDGET),$editorialWidget.empty(),search.page.editorialWidgetHtml&&$editorialWidget.html(search.page.editorialWidgetHtml)),Groupon.ui.GSMEditorialWidget.initWidget()):void 0},updateCrossLinksWidget=function(search,selectors,isServerRendered){var $crossLinkWidget;return Modules.Seo.Helpers.Experiments.crosslinksEnabled&&!isServerRendered&&($crossLinkWidget=$(selectors.CROSS_LINKS_WIDGET),$crossLinkWidget.empty(),search.page.crosslinksHtml)?$crossLinkWidget.html(search.page.crosslinksHtml):void 0},updateMerchantPlacesWidget=function(search,isServerRendered){return Modules.Seo.Helpers.Experiments.merchantPlacesEnabled&&!isServerRendered?Modules.Seo.UI.renderMerchantPlacesWidget(search.page.merchantPlacesHtml):void 0},updateMerchandisedPage=function(search,$dealsContent,isServerRendered){var contentClass;if(!isServerRendered)return contentClass="merchandised-content",search.page.onMerchandisedPage?$dealsContent.addClass(contentClass):$dealsContent.removeClass(contentClass)}}.call(this),Modules.Browse.Presenters.Heading=function(){function Heading(param$){var cache$;cache$=param$,this.selectedCategory=cache$.selectedCategory,this.params=cache$.params,this.basePath=cache$.basePath,this.refinementInterests=cache$.refinementInterests}var categoryLink,getCategoryName,getFriendlyName,getSelectedInterests,showCategoryLink;return Heading.prototype.toHash=function(){var ctx,message,query,selectedInterests;return ctx={},selectedInterests=getSelectedInterests(this.refinementInterests),showCategoryLink(this.selectedCategory,this.params,selectedInterests)?ctx.link=categoryLink(this.params,this.basePath,this.selectedCategory):null!=this.params.query?(query=this.params.query,message=I18n.translate("js.modules.browse.presenters.page_header.query_message",{query:query}),ctx.searchQuery={query:query,message:message}):1===selectedInterests.length?ctx.interestName=selectedInterests[0].get("friendlyName"):ctx.link=categoryLink(this.params,this.basePath,this.selectedCategory),{titleHeading:ctx}},categoryLink=function(queryParams,basePath,selectedCategory){var serializedParams;return queryParams=_.omit(queryParams,"category2","category3","interest"),serializedParams=$.param(queryParams),""!==serializedParams&&(serializedParams="?"+serializedParams),{href:basePath+serializedParams,text:getCategoryName(selectedCategory,queryParams),id:selectedCategory.id}},getCategoryName=function(selectedCategory,queryParams){return"all-deals"===selectedCategory.id&&"local"===queryParams.context?I18n.translate("js.modules.browse.presenters.local_deals_friendly_name"):getFriendlyName(selectedCategory)},getSelectedInterests=function(refinementInterests){return refinementInterests.where({selected:!0})},showCategoryLink=function(selectedCategory,params,selectedInterests){return"all-deals"!==(null!=selectedCategory?selectedCategory.id:void 0)||!(null!=params.query)&&1!==selectedInterests.length},getFriendlyName=function(category){return category.friendlyNameShort||category.friendlyName},Heading}(),Modules.Browse.Views.ResultsHeading=function(super$){function ResultsHeading(){super$.apply(this,arguments)}return extends$(ResultsHeading,super$),ResultsHeading.prototype.template=Groupon.MustacheTemplates.browse_title_heading,ResultsHeading.prototype.initialize=function(){return this.topCategory=Groupon.Categories.selectedCategory,this.listenTo(Modules.RefinementBar.Application.dealsEvents,"interestSelectionChanged",this.render)},ResultsHeading.prototype.render=function(refinementInterests){var headingPresenter,queryParams;return queryParams=Groupon.Utils.unparam(),headingPresenter=new Modules.Browse.Presenters.Heading({selectedCategory:this.topCategory,params:queryParams,basePath:window.location.pathname,refinementInterests:refinementInterests}),this.$el.html(this.template.render(headingPresenter.toHash()))},ResultsHeading}(Backbone.View),Modules.Browse.Views.DealsLayoutToggle=function(super$){function DealsLayoutToggle(){var instance$;instance$=this,this.attachEventHandlers=function(){return DealsLayoutToggle.prototype.attachEventHandlers.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(DealsLayoutToggle,super$),DealsLayoutToggle.prototype.initialize=function(){return this.attachEventHandlers()},DealsLayoutToggle.prototype.switchLayout=function(param$){var cache$,dealTileClass,newCookieValue,setClass;return cache$=param$,dealTileClass=cache$.dealTileClass,setClass=cache$.setClass,newCookieValue=cache$.newCookieValue,this.$el.find("."+dealTileClass).removeClass(dealTileClass).addClass(setClass),Cookie.set("browseLayout",newCookieValue,0),GIG.Utils.truncateElements($.find("#deal-space"),{watch:!1})},DealsLayoutToggle.prototype._makeIconActive=function(icon_class){return this.$el.find(".deals-layout-selector .grid-icon").removeClass("active"),this.$el.find(".deals-layout-selector .list-icon").removeClass("active"),this.$el.find(".deals-layout-selector "+icon_class).addClass("active")},DealsLayoutToggle.prototype.attachEventHandlers=function(){var $dealsLayoutSelector;return $dealsLayoutSelector=this.$el.find(".deals-layout-selector"),$dealsLayoutSelector.find(".list-icon").click(function(this$){return function(){return this$._makeIconActive(".list-icon"),this$.switchLayout({dealTileClass:"deal-tile-grid-view",setClass:"deal-tile-list-view",newCookieValue:"listView"})}}(this)),$dealsLayoutSelector.find(".grid-icon").click(function(this$){return function(){return this$._makeIconActive(".grid-icon"),this$.switchLayout({dealTileClass:"deal-tile-list-view",setClass:"deal-tile-grid-view",newCookieValue:"gridView"})}}(this)),$dealsLayoutSelector.find(".layout-toggle-icon").one("click",function(){return Groupon.Utils.lazyLoadImages()})},DealsLayoutToggle}(Backbone.View),void function(){var attachEventHandlers,updateAppURL;Modules.Browse.Views.DealsSortToggle=function(){function DealsSortToggle(param$){var $el,cache$,onChange;cache$=param$,$el=cache$.$el,onChange=cache$.onChange,attachEventHandlers($el,onChange)
}return DealsSortToggle}(),attachEventHandlers=function($el,onChange){return $el.change(function(){var sortType;return sortType=$el.val(),updateAppURL(sortType),onChange()})},updateAppURL=function(sortType){var qs,queryString;return qs=Groupon.Utils.unparam(),delete qs.page,"relevance"===sortType?delete qs.sort:qs.sort=sortType,queryString=_.isEmpty(qs)?"":"?"+$.param(qs),Modules.Shared.Helpers.updateAppURL(""+window.location.pathname+queryString)}}.call(this),Modules.RefinementBar.Helpers.DataConstructor=function(){function DataConstructor(){}return DataConstructor.dataBhc=function(model,data_name){var dealCountString,selectedState;return selectedState=model.get("selected")?"on":"off",dealCountString=model.get("count")?"_"+model.get("count"):"",""+data_name+"-"+selectedState+":"+model.get("id")+dealCountString},DataConstructor}(),Modules.RefinementBar.Views.FlatRefinement=function(super$){function FlatRefinement(){var instance$;instance$=this,this.toggleRefinement=function(){return FlatRefinement.prototype.toggleRefinement.apply(instance$,arguments)},this.attributes=function(){return FlatRefinement.prototype.attributes.apply(instance$,arguments)},this.className=function(){return FlatRefinement.prototype.className.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(FlatRefinement,super$),FlatRefinement.prototype.tagName="li",FlatRefinement.prototype.template=Groupon.MustacheTemplates.refinement_bar_flat_refinement,FlatRefinement.prototype.className=function(){return"refinement "+this.options.liClass},FlatRefinement.prototype.events={click:"onClick"},FlatRefinement.prototype.attributes=function(){return{"data-id":this.model.get("id"),"data-distancefromuser":this.model.get("distanceFromUser"),"data-bhc":Modules.RefinementBar.Helpers.DataConstructor.dataBhc(this.model,this.model.get("baseBhc"))}},FlatRefinement.prototype.initialize=function(param$){return this.liClass=param$.liClass,this.listenTo(this.model,"change:selected",this.render)},FlatRefinement.prototype.onClick=function(event){return setTimeout(this.toggleRefinement,0),event.preventDefault()},FlatRefinement.prototype.toggleRefinement=function(){return this.model.toggle()},FlatRefinement.prototype.render=function(){return this.$el.html(this.template.render({friendlyName:this.model.getSidebarName(),count:this.model.get("count"),selected:this.model.get("selected"),url:this.model.get("url")})),this.$el.toggleClass("active",this.model.get("selected")),this},FlatRefinement}(Backbone.View),Modules.RefinementBar.Collections.RecentRefinements=function(super$){function RecentRefinements(){super$.apply(this,arguments)}var flattenAndFilter,moveToTop,sortModels;return extends$(RecentRefinements,super$),RecentRefinements.prototype.model=Modules.RefinementBar.Models.Refinement,RecentRefinements.prototype.initialize=function(models,param$){var cache$;return cache$=param$,this.refinements=cache$.refinements,this.sortDeselected=cache$.sortDeselected,this.recentRefinementsCount=Groupon.RefinementBar.recentRefinementsCount,this.listenTo(Modules.RefinementBar.Application.dealsEvents,"dealsReplaced",this.filterAndSort),this.listenTo(this.refinements,"selectionChanged",this._selectionChanged),this.flattened=flattenAndFilter(this.refinements),this.filterAndSort({silent:!0})},RecentRefinements.prototype.filterAndSort=function(resetOptions){var sorted,withDeals;return withDeals=_.filter(this.flattened,function(model){return model.get("count")>0}),this.refinementsWithDealsCount=withDeals.length,sorted=sortModels(withDeals,this.recentRefinementsCount,this.sortDeselected),this.reset(sorted.slice(0,this.recentRefinementsCount),resetOptions)},sortModels=function(array,recentRefinementsCount,sortDeselected){var groupedModels,nonRecentRefinementArray,recentRefinementArray,sortedArray;return sortedArray=sortDeselected(array),recentRefinementArray=_.first(sortedArray,null!=recentRefinementsCount?recentRefinementsCount:[]),nonRecentRefinementArray=_.rest(sortedArray,null!=recentRefinementsCount?recentRefinementsCount:[]),groupedModels=_.groupBy(nonRecentRefinementArray,function(elem){return elem.get("selected")}),null!=groupedModels["false"]?groupedModels["false"]:groupedModels["false"]=[],null!=groupedModels["true"]?groupedModels["true"]:groupedModels["true"]=[],_.union(groupedModels["true"],recentRefinementArray,groupedModels["false"])},RecentRefinements.prototype._selectionChanged=function(model,value){return value&&!this._isModelFromRecentRefinement(model)&&moveToTop(this.flattened,model),this.filterAndSort()},RecentRefinements.prototype._isModelFromRecentRefinement=function(model){return null!=this.get(model.get("id"))},moveToTop=function(array,element){return array.splice($.inArray(element,array),1),array.unshift(element)},flattenAndFilter=function(refinements){var flattened;return flattened=[],refinements.each(function(model){var children;return children=model.get("children"),(null!=children?children.length:void 0)>=Groupon.RefinementBar.NeighborhoodsDisplayThreshold&&children.each(function(child){return flattened.push(child)}),flattened.push(model)}),flattened},RecentRefinements}(Backbone.Collection),Modules.RefinementBar.Views.RecentRefinements=function(super$){function RecentRefinements(){super$.apply(this,arguments)}var renderAll,renderRefinements,updateSeeMoreLink;return extends$(RecentRefinements,super$),RecentRefinements.prototype.initialize=function(param$){return this.refinements=param$.refinements,this.visibleRefinementCollection=new Modules.RefinementBar.Collections.RecentRefinements(null,{refinements:this.refinements,sortDeselected:this.sortDeselected}),this.listenTo(this.visibleRefinementCollection,"reset",this.render),this.$seeMoreLink=$(this.seeMoreLinkClass)},RecentRefinements.prototype.render=function(){return renderAll(this.refinements,this.liClass,this.$el),renderRefinements(this.visibleRefinementCollection,this.liClass,this.$el),updateSeeMoreLink(this.visibleRefinementCollection,this.$seeMoreLink),this},renderAll=function(refinements,liClass,$el){var allView;return allView=new Modules.RefinementBar.Views.All({modelCounter:new Modules.RefinementBar.Presenters.ModelCounter([refinements]),refinementCollection:refinements,liClass:liClass}),$el.html(allView.render().el)},renderRefinements=function(visibleRefinementCollection,liClass,$el){return visibleRefinementCollection.each(function(refinement){var flatRefinementView;return flatRefinementView=new Modules.RefinementBar.Views.FlatRefinement({model:refinement,liClass:liClass}),$el.append(flatRefinementView.render().el)})},updateSeeMoreLink=function(visibleRefinementCollection,$seeMoreLink){var displaySeeMoreLink;return displaySeeMoreLink=visibleRefinementCollection.refinementsWithDealsCount>Groupon.RefinementBar.recentRefinementsCount,$seeMoreLink.toggle(displaySeeMoreLink)},RecentRefinements}(Backbone.View),void function(){function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}var categoryAndChildrenNotSelected,categoryNotSelected;Modules.RefinementBar.Collections.Refinements=function(super$){function Refinements(){super$.apply(this,arguments)}return extends$(Refinements,super$),Refinements.prototype.initialize=function(models,param$){return this.options=param$,null==(null!=this.options?this.options.multiSelect:void 0)&&(this.options={multiSelect:!0}),this.on("add",this.onAddRefinement),this.on("change:selected",this.selectionChanged)},Refinements.prototype.onAddRefinement=function(refinement){var children;return null!=(children=refinement.get("children"))?this.listenTo(children,"selectionChanged",this.selectionChanged):void 0},Refinements.prototype.selectionChanged=function(refinementSelected,newValue){return Groupon.enabledFeatures.showLHNCheckboxes||this.options.multiSelect||this.deselectOthers(refinementSelected),this.trigger("selectionChanged",refinementSelected,newValue)},Refinements.prototype.countSelected=function(){var count;return count=this.where({selected:!0}).length,this.each(function(model){var children;return null!=(children=model.get("children"))?count+=children.countSelected():void 0}),count},Refinements.prototype.deepClearAll=function(){return this.each(function(model){var cache$;return model.set("selected",!1),null!=(cache$=model.get("children"))?cache$.deepClearAll():void 0})},Refinements.prototype.deselectOthers=function(refinementSelected){var children,childSelected,model,selected;if(refinementSelected.changed.selected){selected=!1;for(var i$=0,length$=this.models.length;length$>i$;++i$)model=this.models[i$],children=model.get("children"),(null!=children?children.length:void 0)>0&&(childSelected=children.deselectOthers(refinementSelected),selected||(selected=childSelected)),categoryAndChildrenNotSelected(model,refinementSelected,childSelected)&&model.set("blindOpen",!1),categoryNotSelected(model,refinementSelected)?model.set("selected",!1):model.get("selected")&&(selected=!0);return selected}},Refinements}(Backbone.Collection),categoryAndChildrenNotSelected=function(model,refinementSelected,childSelected){return model.get("blindOpen")&&model.id!==refinementSelected.id&&!childSelected},categoryNotSelected=function(model,refinementSelected){return model.get("selected")&&model.id!==refinementSelected.id}}.call(this),Modules.RefinementBar.Helpers.ModelAccessor=function(){function ModelAccessor(param$){this.models=param$}return ModelAccessor.prototype.getCategoryPairs=function(){return _.values(this.models.modelElPairs.categories)},ModelAccessor.prototype.getTopLevelCategoryLinks=function(){return _.values(this.models.modelElPairs.topLevelCategoryLinks)},ModelAccessor.prototype.getSubcategoryLinkPairs=function(){return this.models.modelElPairs.subCategoryLinks},ModelAccessor.prototype.getCollections=function(type){return null!=type?this.models.collections[type]:this.models.collections},ModelAccessor.prototype.getCollectionsList=function(){return _.values(this.models.collections)},ModelAccessor.prototype.getProxyCollections=function(type){return null!=type?this.models.proxyCollections[type]:this.models.proxyCollections},ModelAccessor}(),Modules.RefinementBar.Collections.Proxies=function(super$){function Proxies(models,opts){var members;this.collection=opts.collection,members=this.collection.map(function(model){return new Modules.RefinementBar.Models.Proxy({model:model})}),Backbone.Collection.prototype.constructor.call(this,members,opts)}return extends$(Proxies,super$),Proxies.prototype.resetState=function(){return this.each(function(model){return model.resetState()})},Proxies.prototype.applyState=function(){return this.each(function(model){return model.applyState()})},Proxies.prototype.sortForModal=function(){var refinementsToSort,sortedRefinements,zeroCountRefinements;return refinementsToSort=_.filter(this.models,function(model){return model.get("count")>0}),sortedRefinements=Modules.RefinementBar.Helpers.ModalBuilder.prototype.orderTopDown(refinementsToSort),zeroCountRefinements=_.difference(this.models,sortedRefinements),this.reset(sortedRefinements.concat(zeroCountRefinements),{sort:!1})},Proxies}(Backbone.Collection),Modules.RefinementBar.Helpers.ModalBuilder=function(){function ModalBuilder(){}var isNotInt;return ModalBuilder.prototype.orderTopDown=function(models,numOfCols){var col,index,modelsForModal,numOfModels,numOfRows,numOfViewsLastRow,position,row;if(null==numOfCols&&(numOfCols=Groupon.RefinementBar.ModalColumnNumber),isNotInt(numOfCols)||1>numOfCols)return models;numOfModels=null!=(null!=models?models.length:void 0)?null!=models?models.length:void 0:0,numOfRows=Math.floor(numOfModels/numOfCols),numOfViewsLastRow=numOfModels%numOfCols,modelsForModal=[];for(var cache$=function(){var accum$;accum$=[];for(var i$=0;numOfRows>=0?numOfRows>=i$:i$>=numOfRows;numOfRows>=0?++i$:--i$)accum$.push(i$);return accum$}.apply(this,arguments),i$=0,length$=cache$.length;length$>i$;++i$){row=cache$[i$];for(var cache$1=function(){var accum$;accum$=[];for(var i$1=0;numOfCols>=0?numOfCols>i$1:i$1>numOfCols;numOfCols>=0?++i$1:--i$1)accum$.push(i$1);return accum$}.apply(this,arguments),i$1=0,length$1=cache$1.length;length$1>i$1;++i$1)col=cache$1[i$1],index=numOfRows*col+row+Math.min(col,numOfViewsLastRow),position=numOfCols*row+col,numOfModels>position&&modelsForModal.push(models[index])}return modelsForModal},isNotInt=function(num){return!_.isNumber(num)||0!==num%1},ModalBuilder}(),Modules.RefinementBar.Collections.Interests=function(super$){function Interests(){super$.apply(this,arguments)}return extends$(Interests,super$),Interests.prototype.comparator=function(model1,model2){return model2.get("count")-model1.get("count")},Interests}(Modules.RefinementBar.Collections.Proxies),Modules.RefinementBar.Helpers.ModelBuilder=function(){function ModelBuilder(){}var buildChildModels,buildModelFromEl,buildModelFromElNoCheckbox;return ModelBuilder.prototype.build=function(param$){var cache$,cache$1,cache$2,cache$3,cache$4,categoriesCollection,categoryPairs,cityPairs,interestPairs,interestsCollection,linkCategoryCollection,linkCategoryPair,linkSubCategoryPair,locationsCollection,neighborhoodPairs,proxyCollections,subcategoryPairs;return this.$domRefinements=param$,Groupon.enabledFeatures.showLHNCheckboxes?(cache$=this._buildModels(".category"),categoriesCollection=cache$[0],categoryPairs=cache$[1],subcategoryPairs=cache$[2]):(cache$1=this._buildModelsNoCheckbox(),categoriesCollection=cache$1[0],categoryPairs=cache$1[1]),cache$2=this._buildModels(".city"),locationsCollection=cache$2[0],cityPairs=cache$2[1],neighborhoodPairs=cache$2[2],cache$3=this._buildModels(".interest"),interestsCollection=cache$3[0],interestPairs=cache$3[1],cache$4=this._buildModels(".top-category-links"),linkCategoryCollection=cache$4[0],linkCategoryPair=cache$4[1],linkSubCategoryPair=cache$4[2],proxyCollections=this._buildProxyCollections({categoriesCollection:categoriesCollection,locationsCollection:locationsCollection,interestsCollection:interestsCollection,linkCategoryCollection:linkCategoryCollection}),new Modules.RefinementBar.Helpers.ModelAccessor({collections:{categories:categoriesCollection,locations:locationsCollection,interests:interestsCollection,topLevelCategoryLinks:linkCategoryCollection},modelElPairs:{categories:categoryPairs,subcategories:subcategoryPairs,interests:interestPairs,topLevelCategoryLinks:linkCategoryPair,subCategoryLinks:linkSubCategoryPair,locations:cityPairs,neighborhoodPairs:neighborhoodPairs},proxyCollections:proxyCollections})},ModelBuilder.prototype._buildModels=function(domSelector){var childPairs,parentCollection,parentPairs;return parentCollection=new Modules.RefinementBar.Collections.Refinements,parentPairs={},childPairs={},_.each(this.$domRefinements.filter(domSelector),function(parentElement){var parentModel;return parentModel=buildModelFromEl(parentElement),childPairs[parentModel.get("id")]={},parentCollection.add(parentModel),_.each($(parentElement).find(".child-refinement"),function(childElement){var childModel;return childModel=buildModelFromEl(childElement),parentModel.get("children").add(childModel),childPairs[parentModel.get("id")][childModel.get("id")]={model:childModel,el:childElement}}),parentPairs[parentModel.get("id")]={model:parentModel,el:parentElement}}),[parentCollection,parentPairs,childPairs]},ModelBuilder.prototype._buildModelsNoCheckbox=function(){var categoriesEl,categoryCollection,categoryPairs;return categoryCollection=new Modules.RefinementBar.Collections.Refinements([],{multiSelect:!1}),categoryPairs=[],categoriesEl=$(".category-list").children(".category"),_.each(categoriesEl,function(categoryEl){var childrenPairs,model;return childrenPairs=[],model=buildModelFromElNoCheckbox(categoryEl),categoryPairs.push({model:model,el:categoryEl,childrenPairs:childrenPairs}),categoryCollection.add(model),buildChildModels(categoryEl,model,childrenPairs)}),[categoryCollection,categoryPairs]},buildChildModels=function(parentEl,parentModel,categoryPairs){return _.each($(parentEl).children(".subcategory-list").children(".category"),function(categoryEl){var childrenPairs,model;return childrenPairs=[],model=buildModelFromElNoCheckbox(categoryEl),parentModel.get("children").add(model),categoryPairs.push({model:model,el:categoryEl,childrenPairs:childrenPairs}),buildChildModels(categoryEl,model,childrenPairs)})},buildModelFromEl=function(el){var $el,model;return $el=$(el),model=new Modules.RefinementBar.Models.Refinement({id:$el.data("id"),friendlyName:$el.data("friendlyname"),count:$el.data("count"),selected:!!$el.data("preselected"),baseBhc:$el.data("base-bhc"),distanceFromUser:$el.data("distancefromuser"),urlBase:$el.data("urlBase"),url:$el.find("a").attr("href"),topcategory:$el.data("topcategory"),blindOpen:!!$el.data("blindopen"),badges:$el.data("badge-info")})},buildModelFromElNoCheckbox=function(el){var $el,data,model;return $el=$(el),data=$el.data(),model=new Modules.RefinementBar.Models.Refinement({id:data.id,friendlyName:data.friendlyname,count:data.count,baseBhc:data["base-bhc"],url:$el.find("a").attr("href"),blindOpen:!!data.blindopen,selected:$el.children(".category-name").children(".name.highlighted").length>0,multiSelect:!1})},ModelBuilder.prototype._buildProxyCollections=function(param$){var cache$,categoriesCollection,interestsCollection,linkCategoryCollection,locationsCollection;return cache$=param$,categoriesCollection=cache$.categoriesCollection,locationsCollection=cache$.locationsCollection,interestsCollection=cache$.interestsCollection,linkCategoryCollection=cache$.linkCategoryCollection,{categories:new Modules.RefinementBar.Collections.Proxies([],{collection:categoriesCollection}),locations:new Modules.RefinementBar.Collections.Proxies([],{collection:locationsCollection}),interests:new Modules.RefinementBar.Collections.Interests([],{collection:interestsCollection}),topLevelCategoryLinks:new Modules.RefinementBar.Collections.Proxies([],{collection:linkCategoryCollection})}},ModelBuilder}(),Modules.RefinementBar.Views.All=function(super$){function All(){var instance$;instance$=this,this.className=function(){return All.prototype.className.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(All,super$),All.prototype.tagName="li",All.prototype.template=Groupon.MustacheTemplates.refinement_bar_all,All.prototype.className=function(){return""+this.options.liClass},All.prototype.events={click:"onClick"},All.prototype.initialize=function(param$){var cache$;return cache$=param$,this.modelCounter=cache$.modelCounter,this.refinementCollection=cache$.refinementCollection,this.liClass=cache$.liClass,this.listenTo(this.modelCounter,"change:anyRefinementsSelected",this.render)},All.prototype.render=function(){var selected,templateHash;return selected=!this.modelCounter.get("anyRefinementsSelected"),templateHash=I18n.mixin({selected:selected}),this.$el.html(this.template.render(templateHash)),this.$el.toggleClass("active",selected),this},All.prototype.onClick=function(){return this.refinementCollection.deepClearAll(),this.render()},All}(Backbone.View),Modules.RefinementBar.Presenters.Subcategory=function(){function Subcategory(param$){this.model=param$}return Subcategory.prototype.toHash=function(){return{id:this.model.get("id"),selected:this.model.get("selected"),friendlyNameShort:this.model.get("friendlyName"),count:this.model.get("count"),url:this.model.get("url")}},Subcategory}(),Modules.RefinementBar.Views.Subcategory=function(super$){function Subcategory(){var instance$;instance$=this,this.toggleCheckBox=function(){return Subcategory.prototype.toggleCheckBox.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Subcategory,super$),Subcategory.prototype.initialize=function(param$){return this.parentModel=param$.parentModel,this.listenTo(this.model,"change:selected",this.render),this.listenTo(this.model,"change:count",this.render),this.render()},Subcategory.prototype.events={click:"onClick"},Subcategory.prototype.template=Groupon.MustacheTemplates.refinement_bar_subcategory,Subcategory.prototype.render=function(){var subcategoryHash;return subcategoryHash=new Modules.RefinementBar.Presenters.Subcategory(this.model).toHash(),$(this.el).html(this.template.render(subcategoryHash)),this.$el.data("bhc",Modules.RefinementBar.Helpers.DataConstructor.dataBhc(this.model,"subcategory")),this.$el.toggle(this.model.get("count")>0),this.$el.removeClass("hide")},Subcategory.prototype.onClick=function(event){return setTimeout(this.toggleCheckBox,0),event.preventDefault()},Subcategory.prototype.toggleCheckBox=function(){return this.model.toggle(),this.parentModel.set("selected",!1)},Subcategory}(Backbone.View),Modules.RefinementBar.Views.Subcategories=function(super$){function Subcategories(){super$.apply(this,arguments)}var stringCompare,subcatComparator;return extends$(Subcategories,super$),Subcategories.prototype.initialize=function(param$){var cache$;return cache$=param$,this.collection=cache$.collection,this.categoryModel=cache$.categoryModel,this.subcatViews=this.collection.map(function(this$){return function(model){return new Modules.RefinementBar.Views.Subcategory({parentModel:this$.categoryModel,el:this$.$el.find("[data-id='"+model.id+"']")[0],model:model})}}(this)),this.listenTo(Modules.RefinementBar.Application.dealsEvents,"dealsReplaced",this.render),this.render()},Subcategories.prototype.render=function(){return this.$el.children().detach(),this.subcatViews.sort(subcatComparator),this.$el.append(_.map(this.subcatViews,function(view){return view.el}))},subcatComparator=function(a,b){var aCount,bCount;return aCount=a.model.get("count"),bCount=b.model.get("count"),aCount===bCount?stringCompare(a.model.get("friendlyName"),b.model.get("friendlyName")):bCount-aCount},stringCompare=function(string1,string2){return string2>string1?-1:string1>string2?1:0},Subcategories}(Backbone.View),Modules.RefinementBar.Views.Categories=function(super$){function Categories(){super$.apply(this,arguments)}return extends$(Categories,super$),Categories.prototype.initialize=function(param$){return this.collection=param$.collection,this.listenTo(Modules.RefinementBar.Application.dealsEvents,"dealsReplaced",this.render)},Categories.prototype.render=function(){return this.collection.any(function(cat){return cat.get("count")>0})?this.$el.show():this.$el.hide()},Categories}(Backbone.View),Modules.RefinementBar.Views.TopCategoryLink=function(super$){function TopCategoryLink(){super$.apply(this,arguments)}return extends$(TopCategoryLink,super$),TopCategoryLink.prototype.initialize=function(){return this.listenTo(this.model,"change:count",this.render),this.listenTo(this.model,"change:url",this.render),this.render()},TopCategoryLink.prototype.render=function(){var baseElement;return baseElement=$(this.el),this.model.get("count")>0?(this.$el.removeClass("hide"),this.$refinementLinkHref=$("<a/>").attr("href",this.model.get("url")),baseElement=this.$refinementLinkHref,$(this.el).empty(),$(this.el).append(this.$refinementLinkHref)):this.$el.hasClass("hide")||this.$el.addClass("hide"),baseElement.text(this.model.get("friendlyName")),$("<span/>",{"class":"deal-counts"}).html(" ("+this.model.get("count")+")").appendTo(baseElement),this.model.get("badges")?function(accum$){for(var badge,cache$=this.model.get("badges"),i$=0,length$=cache$.length;length$>i$;++i$)badge=cache$[i$],accum$.push($("<span/>",{"class":"badge-"+badge.id}).html(""+badge.text).appendTo(baseElement));return accum$}.call(this,[]):void 0},TopCategoryLink}(Backbone.View),Modules.RefinementBar.Views.RefinementLinks=function(super$){function RefinementLinks(){super$.apply(this,arguments)}var updateRefinementLinks;return extends$(RefinementLinks,super$),RefinementLinks.prototype.initialize=function(param$){var cache$,interestKeys;return cache$=param$,this.interestsCollection=cache$.interestsCollection,this.topCategoryLinks=cache$.topCategoryLinks,this.omitSearch=cache$.omitSearch,interestKeys=_.pluck(this.interestsCollection.where({selected:!0}),"id"),this.activeInterests=_.object(interestKeys,[]),this.listenTo(this.interestsCollection,"change:selected",this._updateInterestStorage),this.listenTo(this.model,"change:count",this._renderLinksHolder)},RefinementLinks.prototype._updateInterestStorage=function(interest){return interest.get("selected")?this.activeInterests[interest.get("id")]=1:delete this.activeInterests[interest.get("id")],updateRefinementLinks(this.topCategoryLinks,this.activeInterests,this.omitSearch)},updateRefinementLinks=function(topCategoryLinks,activeInterests,omitSearch){var currentParams,interestKeys;return currentParams=Groupon.Utils.unparam(),omitSearch&&(currentParams=_.omit(currentParams,"query")),interestKeys=_.keys(activeInterests),_.each(topCategoryLinks.models,function(topCategoryLinkModel){var buildLink,linkParams;return linkParams=_.extend({},currentParams,{category:topCategoryLinkModel.get("id")}),linkParams=_.omit(linkParams,"interest"),interestKeys.length>0&&(linkParams.interest=interestKeys.toString()),null!=topCategoryLinkModel.get("topcategory")&&(linkParams.topcategory=topCategoryLinkModel.get("topcategory")),buildLink=""+topCategoryLinkModel.get("urlBase")+"?"+$.param(linkParams),topCategoryLinkModel.set("url",buildLink)})},RefinementLinks.prototype._renderLinksHolder=function(){return 0!==this.model.get("count")?this.$el.removeClass("hide"):this.$el.hasClass("hide")?void 0:this.$el.addClass("hide")},RefinementLinks}(Backbone.View),Modules.RefinementBar.Views.RefinementList=function(super$){function RefinementList(){super$.apply(this,arguments)}return extends$(RefinementList,super$),RefinementList.prototype.tagName="ul",RefinementList.prototype.className="checkbox-container",RefinementList.prototype.initialize=function(param$){return this.refinementViews=param$.refinementViews,this.render()},RefinementList.prototype.render=function(){return _.each(this.refinementViews,function(this$){return function(view){return this$.$el.append(view.el)}}(this)),this},RefinementList}(Backbone.View),Modules.RefinementBar.Views.ModalTabbedCities=function(super$){function ModalTabbedCities(){super$.apply(this,arguments)}return extends$(ModalTabbedCities,super$),ModalTabbedCities.prototype.tagName="div",ModalTabbedCities.prototype.initialize=function(param$){return this.cityViews=param$.cityViews,this.$tabsDiv=$("<h4/>",{"class":"pills"}).appendTo(this.$el),_.each(this.cityViews,function(this$){return function(view){return this$.$tabsDiv.append(view.getTabEl()),this$.$el.append(view.getNeighborhoodsEl()),this$.listenTo(view,"selected",this$.showCityView)}}(this)),null!=this.cityViews[0]?this.showCityView(this.cityViews[0]):void 0},ModalTabbedCities.prototype.showCityView=function(selectedView){for(var view,i$=0,length$=this.cityViews.length;length$>i$;++i$)view=this.cityViews[i$],view.hide();return selectedView.show()},ModalTabbedCities.prototype.applyRefinements=function(){return function(accum$){for(var view,i$=0,length$=this.cityViews.length;length$>i$;++i$)view=this.cityViews[i$],accum$.push(view.applyRefinements());return accum$}.call(this,[])},ModalTabbedCities}(Backbone.View),Modules.RefinementBar.Views.ModalNonTabbedCities=function(super$){function ModalNonTabbedCities(){super$.apply(this,arguments)}return extends$(ModalNonTabbedCities,super$),ModalNonTabbedCities.prototype.initialize=function(param$){return this.cityViews=param$.cityViews,this.$noTabsDiv=$("<h4/>").appendTo(this.$el),this.$noTabsDiv.append(this.cityViews.getTabEl()),this.$el.append(this.cityViews.getNeighborhoodsEl())},ModalNonTabbedCities.prototype.applyRefinements=function(){return this.cityViews.applyRefinements()},ModalNonTabbedCities}(Backbone.View),Modules.RefinementBar.Views.CityTab=function(super$){function CityTab(){super$.apply(this,arguments)}return extends$(CityTab,super$),CityTab.prototype.tagName="li",CityTab.prototype.events={click:"onClick"},CityTab.prototype.onClick=function(){return this.trigger("selected",this)},CityTab.prototype.render=function(){var link;return link=$("<a/>").append(this.model.get("friendlyName")),this.$el.html(link),this},CityTab}(Backbone.View),Modules.RefinementBar.Views.ModalCity=function(super$){function ModalCity(){super$.apply(this,arguments)}return extends$(ModalCity,super$),ModalCity.prototype.initialize=function(param$,isTabbed){var cache$;return cache$=param$,this.city=cache$.city,this.neighborhoodsView=cache$.neighborhoodsView,null==isTabbed&&(isTabbed=!1),isTabbed?(this.cityView=new Modules.RefinementBar.Views.CityTab({model:this.city}).render(),this.listenTo(this.cityView,"selected",function(this$){return function(){return this$.trigger("selected",this$)}}(this))):this.cityName=this.city.get("friendlyName")},ModalCity.prototype.getTabEl=function(){return null!=this.cityView?this.cityView.el:this.cityName},ModalCity.prototype.getNeighborhoodsEl=function(){return this.neighborhoodsView.el},ModalCity.prototype.show=function(){return this.toggle(!0)},ModalCity.prototype.hide=function(){return this.toggle(!1)},ModalCity.prototype.toggle=function(show){return null!=this.cityView?(this.neighborhoodsView.$el.toggle(show),this.cityView.$el.toggleClass("active",show)):void 0},ModalCity.prototype.applyRefinements=function(){return this.neighborhoodsView.applyRefinements()},ModalCity}(Backbone.View),Modules.RefinementBar.Views.InterestRefinements=function(super$){function InterestRefinements(){super$.apply(this,arguments)}return extends$(InterestRefinements,super$),InterestRefinements.prototype.liClass="interest",InterestRefinements.prototype.seeMoreLinkClass=".show-more-interests",InterestRefinements.prototype.sortDeselected=function(models){return _.sortBy(models,function(model){return 0-model.get("count")})},InterestRefinements}(Modules.RefinementBar.Views.RecentRefinements),Modules.RefinementBar.Views.LocationRefinements=function(super$){function LocationRefinements(){super$.apply(this,arguments)}return extends$(LocationRefinements,super$),LocationRefinements.prototype.liClass="location",LocationRefinements.prototype.seeMoreLinkClass=".show-more-locations",LocationRefinements.prototype.sortDeselected=function(models){return _.sortBy(models,function(model){return model.get("distanceFromUser")})},LocationRefinements}(Modules.RefinementBar.Views.RecentRefinements),Modules.RefinementBar.Views.ModalCheckbox=function(super$){function ModalCheckbox(){super$.apply(this,arguments)}return extends$(ModalCheckbox,super$),ModalCheckbox.prototype.tagName="li",ModalCheckbox.prototype.className="refine-checkbox",ModalCheckbox.prototype.events={click:"onClick"},ModalCheckbox.prototype.template='<span data-id="<%= id %>"><input type="checkbox"><%= label %></span>\n<span class="modal-deal-count"></span>',ModalCheckbox.prototype.initialize=function(param$){var cache$;return cache$=param$,this.toggleListener=cache$.toggleListener,this.label=cache$.label,this.label||(this.label=this.model.get("friendlyName")),this.$el.html(_.template(this.template,_.extend({label:this.label},this.model.attributes))),this.$input=this.$("input"),this.listenTo(this.model,"change:count",this.render),this.listenTo(this.model,"change:selected",this.render),this.resetState(),this.render()},ModalCheckbox.prototype.resetState=function(){return this.selected=this.model.get("selected")},ModalCheckbox.prototype.render=function(){var isDisabled;return isDisabled=this.isDisabled(),this.$("input").prop("checked",this.model.get("selected")),this.$el.attr("data-bhc",Modules.RefinementBar.Helpers.DataConstructor.dataBhc(this.model,"modal"+this.model.get("baseBhc"))),this.$(".modal-deal-count").text(" ("+this.model.get("count")+")"),this.$("input").prop("disabled",isDisabled),this.$el.toggleClass("disabled",isDisabled),this.$el.toggle(this.isEnabled()||this.model.get("selected"))},ModalCheckbox.prototype.onClick=function(){return this.isDisabled()?void 0:(this.model.toggle(),"function"==typeof this.toggleListener?this.toggleListener():void 0)
},ModalCheckbox.prototype.clearCheckbox=function(){return this.selected=!1,this.render()},ModalCheckbox.prototype.isDisabled=function(){return this.model.get("count")<=0},ModalCheckbox.prototype.isEnabled=function(){return!this.isDisabled()},ModalCheckbox}(Backbone.View),void function(){var commonLibrary,extend;extend=("undefined"!=typeof _&&null!=_?_:require("underscore")).extend,commonLibrary={exportHelper:function(mountingPoint,mountingPath,mountingName,mountedFunction){var currentMountPoint,mountingPathComponent;currentMountPoint=mountingPoint;for(var i$=0,length$=mountingPath.length;length$>i$;++i$)mountingPathComponent=mountingPath[i$],null!=currentMountPoint[mountingPathComponent]?currentMountPoint[mountingPathComponent]:currentMountPoint[mountingPathComponent]={},currentMountPoint=currentMountPoint[mountingPathComponent];return currentMountPoint[mountingName]=mountedFunction}},null!=("undefined"!=typeof module&&null!=module?module.exports:void 0)?module.exports=extend({},commonLibrary,{getChildren:function(collection){return collection.children},getAttribute:function(model,attribute){return model[attribute]},setAttribute:function(model,attribute,value){return model[attribute]=value},getCollectionModels:function(collection){return collection}}):"undefined"!=typeof Modules&&null!=Modules&&(Modules.RefinementBar.Helpers.exportHelpers=extend({},commonLibrary,{getChildren:function(collection){return null!=collection.children?collection.children.toJSON():void 0},getAttribute:function(model,attribute){return model.get(attribute)},setAttribute:function(model,attribute,value){return model.set(attribute,value)},getCollectionModels:function(collection){return collection.models}}))}.call(this),void function(){var cache$,cache$1,each,exportHelper,extend,getAttribute,getCollectionModels,hashifyFacets,indexBy,invoke,mergeFacets,performFacetMerge,setAttribute,updateFacet;cache$="undefined"!=typeof _&&null!=_?_:require("underscore"),each=cache$.each,invoke=cache$.invoke,indexBy=cache$.indexBy,extend=cache$.extend,cache$1=null!=("undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers.exportHelpers:void 0:require("./export_helper"),getCollectionModels=cache$1.getCollectionModels,setAttribute=cache$1.setAttribute,getAttribute=cache$1.getAttribute,exportHelper=cache$1.exportHelper,performFacetMerge=function(refinedFacets,allFacets){var refinedFacetsHash;return refinedFacetsHash=hashifyFacets(refinedFacets),mergeFacets(allFacets,refinedFacetsHash)},mergeFacets=function(facets,refinedFacetsHash){return each(getCollectionModels(facets),function(facetModel){var childrenFacets,refinedFacetHash;return refinedFacetHash=refinedFacetsHash[facetModel.id],updateFacet(facetModel,refinedFacetHash),null!=getAttribute(facetModel,"children")?(childrenFacets=getAttribute(facetModel,"children"),mergeFacets(childrenFacets,refinedFacetsHash)):void 0})},updateFacet=function(facetModel,facetHash){return null!=facetHash?(setAttribute(facetModel,"count",facetHash.count),setAttribute(facetModel,"hidden",!1)):(setAttribute(facetModel,"count",0),setAttribute(facetModel,"hidden",!0))},hashifyFacets=function(facetCollection){var facetHash;return facetHash=indexBy(facetCollection,"id"),each(facetCollection,function(facet){return null!=facet.children?extend(facetHash,hashifyFacets(facet.children)):void 0}),facetHash},exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers:void 0:module.exports,[],"FacetMerge",performFacetMerge)}.call(this),Modules.RefinementBar.Helpers.FacetCountMerger=function(){function FacetCountMerger(param$){this.collections=param$}return FacetCountMerger.prototype.merge=function(facetsResponse){return _.each(facetsResponse,function(this$){return function(facet){switch(facet.id){case Modules.RefinementBar.Application.FACETS.DEAL_TYPE:return this$.updateCountsInterests(facet.values);case Modules.RefinementBar.Application.FACETS.CITY_NEIGHBORHOOD:return this$.updateCountsLocations(facet.values);case Modules.RefinementBar.Application.FACETS.CATEGORIES:return this$.updateCountCategories(facet.values,"local"),this$.updateCountTopLevelCategoryLinks(facet.values)}}}(this))},FacetCountMerger.prototype.updateCountsInterests=function(facetArray){return null!=this.collections.interests?Modules.RefinementBar.Helpers.FacetMerge(facetArray,this.collections.interests):void 0},FacetCountMerger.prototype.updateCountsLocations=function(facetArray){return null!=this.collections.locations?Modules.RefinementBar.Helpers.FacetMerge(facetArray,this.collections.locations):void 0},FacetCountMerger.prototype.updateCountCategories=function(topCategoryFacets,l1FacetId){var cache$,localFacets,matchingL2,matchingL3s;if(null!=this.collections.categories&&(localFacets=null!=(cache$=_.findWhere(topCategoryFacets,{id:l1FacetId}))?cache$.children:void 0,matchingL2=_.findWhere(localFacets,{id:Groupon.Utils.unparam().category})))return Groupon.enabledFeatures.showLHNCheckboxes?(matchingL3s=matchingL2.children,Modules.RefinementBar.Helpers.FacetMerge(matchingL3s,this.collections.categories)):Modules.RefinementBar.Helpers.FacetMerge([matchingL2],this.collections.categories)},FacetCountMerger.prototype.updateCountTopLevelCategoryLinks=function(topCategoryFacets){return null!=this.collections.topLevelCategoryLinks?Modules.RefinementBar.Helpers.FacetMerge(topCategoryFacets,this.collections.topLevelCategoryLinks):void 0},FacetCountMerger}(),Modules.RefinementBar.Views.ShowMoreModal=function(super$){function ShowMoreModal(){super$.apply(this,arguments)}var removeComments;return extends$(ShowMoreModal,super$),ShowMoreModal.prototype.template=Groupon.MustacheTemplates.refinement_bar_showmore_modal,ShowMoreModal.prototype.initialize=function(param$){var cache$;cache$=param$,this.categoriesCollection=cache$.categoriesCollection,this.locationsCollection=cache$.locationsCollection,this.interestsCollection=cache$.interestsCollection,this.tabbedCitiesView=cache$.tabbedCitiesView,this.allCitiesView=cache$.allCitiesView,this.interestsView=cache$.interestsView},ShowMoreModal.prototype.createModal=function(){var countMerger,currentShowMoreModalView,modalId,refinementCollections;return this.modalId=GIG.Modal.create(removeComments(this.template.render(I18n)),{destroyOnClose:!1}),this.el=$("#"+this.modalId),this.setElement(this.el),this.getToggleEls(),this.locationsCollection.length||this.locationToggleEl.hide(),this.getCheckboxHolders(),this.buildModal(),this.buildSpinnerControl(),refinementCollections={locations:this.locationsCollection,interests:this.interestsCollection,categories:this.categoriesCollection},countMerger=new Modules.RefinementBar.Helpers.FacetCountMerger(refinementCollections),currentShowMoreModalView=this,this.filterPresenter=new Modules.RefinementBar.Presenters.FilterString(refinementCollections,!0),this.filterPresenter.on("filterChanged",function(){var dealsearcher;return dealsearcher=new Modules.Deals.Application({facet_group_filters:this.filterString,omitSearch:Modules.RefinementBar.Application.omitSearch}),dealsearcher.on("success",function(dealResult){return countMerger.merge(dealResult.metadata.facets),currentShowMoreModalView.stopSpinners()})}),this.filterPresenter.on("filterNotChanged",function(){return currentShowMoreModalView.stopSpinners()}),GIG.Modal.onClose(function(this$){return function(){return this$.onCloseModal()}}(this),modalId=this.modalId)},ShowMoreModal.prototype.events={"click .interests-tab":"showInterests","click .locations-tab":"showLocations","click .apply":"onClickApply"},ShowMoreModal.prototype.getToggleEls=function(){return this.locationToggleEl=$(this.el).find(".locations-tab"),this.interestsToggleEl=$(this.el).find(".interests-tab")},ShowMoreModal.prototype.getCheckboxHolders=function(){return this.locationsCheckboxHolder=$(this.el).find(".location-checkboxes"),this.interestsCheckboxHolder=$(this.el).find(".interest-checkboxes")},ShowMoreModal.prototype.buildModal=function(){return this.locationsCheckboxHolder.prepend(this.tabbedCitiesView.el),this.locationsCheckboxHolder.append(this.allCitiesView.el),this.interestsCheckboxHolder.prepend(this.interestsView.el)},ShowMoreModal.prototype.buildSpinnerControl=function(){return this.locationsSpinner=new Modules.Page.Views.Spinner({el:this.locationsCheckboxHolder,topMargin:"50px"}),this.interestsSpinner=new Modules.Page.Views.Spinner({el:this.interestsCheckboxHolder,topMargin:"50px"})},ShowMoreModal.prototype.onCloseModal=function(){return $("body").css("overflow","auto")},ShowMoreModal.prototype.closeModal=function(opts){return opts.resetPage&&$("body").scrollTop(0),GIG.Modal.close()},ShowMoreModal.prototype.showInterests=function(evt){return null==this.modalId&&this.createModal(),$("body").css("overflow","hidden"),this.locationToggleEl.removeClass("active"),this.interestsToggleEl.addClass("active"),this.locationsCheckboxHolder.hide(),this.interestsCheckboxHolder.show(),null!=evt?(this.interestsSpinner.render(),this.filterPresenter.createFilterString()):this.resetModelsState(),GIG.Modal.open({id:this.modalId})},ShowMoreModal.prototype.showLocations=function(evt){return null==this.modalId&&this.createModal(),$("body").css("overflow","hidden"),this.interestsToggleEl.removeClass("active"),this.locationToggleEl.addClass("active"),this.interestsCheckboxHolder.hide(),this.locationsCheckboxHolder.show(),null!=evt?(this.locationsSpinner.render(),this.filterPresenter.createFilterString()):this.resetModelsState(),GIG.Modal.open({id:this.modalId})},ShowMoreModal.prototype.startSpinners=function(){return this.locationsSpinner.render(),this.interestsSpinner.render()},ShowMoreModal.prototype.stopSpinners=function(){return this.locationsSpinner.close(),this.interestsSpinner.close()},ShowMoreModal.prototype.onClickApply=function(){return this.applyRefinements(),this.closeModal({resetPage:!0})},ShowMoreModal.prototype.applyRefinements=function(){return this.locationsCollection.applyState(),this.interestsCollection.applyState()},ShowMoreModal.prototype.resetModelsState=function(){return this.interestsCollection.resetState(),this.locationsCollection.resetState()},removeComments=function(string){return string.replace(/<!--[\s\S]*?-->/g,"")},ShowMoreModal}(Backbone.View),Modules.RefinementBar.Models.Refinement=function(super$){function Refinement(){super$.apply(this,arguments)}return extends$(Refinement,super$),Refinement.prototype.defaults=function(){return{selected:!1,children:new Modules.RefinementBar.Collections.Refinements([],{multiSelect:this.get("multiSelect")}),blindOpen:!1}},Refinement.prototype.toggle=function(){return this.set("selected",!this.get("selected"))},Refinement.prototype.getSidebarName=function(){var children;return children=this.get("children"),null!=children&&children.length>=Groupon.RefinementBar.NeighborhoodsDisplayThreshold?""+I18n.translate("js.modules.refinement_bar.all")+" "+this.get("friendlyName"):this.get("friendlyName")},Refinement.prototype.unsetChildren=function(){return this.get("children").each(function(child){return child.set("selected",!1)})},Refinement.prototype.openBlind=function(){return this.set("blindOpen",!0)},Refinement}(Backbone.Model),Modules.RefinementBar.Models.Proxy=function(super$){function Proxy(){super$.apply(this,arguments)}return extends$(Proxy,super$),Proxy.prototype.initialize=function(param$){return this.model=param$.model,this.resetState()},Proxy.prototype.resetState=function(){var existingChildren,newChildren,proxiedChildren;return this.set(_.omit(this.model.attributes,"children")),newChildren=this.model.get("children"),existingChildren=this.get("children"),null!=existingChildren&&(null!=newChildren?newChildren.length:void 0)===(null!=existingChildren?existingChildren.length:void 0)?existingChildren.each(function(child){return child.resetState()}):null!=newChildren?(proxiedChildren=new Modules.RefinementBar.Collections.Refinements(newChildren.map(function(child){return new Modules.RefinementBar.Models.Proxy({model:child})})),this.set({children:proxiedChildren})):void 0},Proxy.prototype.applyState=function(){var children;return this.model.set({selected:this.attributes.selected}),children=this.get("children"),null!=children?children.each(function(child){return child.applyState()}):void 0},Proxy}(Modules.RefinementBar.Models.Refinement),void function(){var constructDataBhc;Modules.RefinementBar.Presenters.CategoryNoCheckbox=function(){function CategoryNoCheckbox(param$,param$1){this.model=param$,this.level=param$1}return CategoryNoCheckbox.prototype.toHash=function(){return{dataBhc:constructDataBhc(this.model,this.level),isHighlighted:this.model.get("selected"),friendlyNameShort:this.model.get("friendlyName"),url:this.model.get("url"),count:this.model.get("count")}},CategoryNoCheckbox}(),constructDataBhc=function(model,level){var dealCountString;return(1===level||null==level)&&(level=""),dealCountString=model.get("count")?"_"+model.get("count"):"","category"+level+":"+model.get("id")+dealCountString}}.call(this),Modules.RefinementBar.Views.CategoryNoCheckbox=function(super$){function CategoryNoCheckbox(){var instance$;instance$=this,this.toggleCategory=function(){return CategoryNoCheckbox.prototype.toggleCategory.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(CategoryNoCheckbox,super$),CategoryNoCheckbox.prototype.initialize=function(param$){var cache$;return cache$=param$,this.parentModel=cache$.parentModel,this.level=cache$.level,this._setupListeners()},CategoryNoCheckbox.prototype.template=Groupon.MustacheTemplates.refinement_bar_category_link,CategoryNoCheckbox.prototype.events={"click .category-name:first":"onClick"},CategoryNoCheckbox.prototype.render=function(){var categoryHash;return this._categoryVisible()?(categoryHash=new Modules.RefinementBar.Presenters.CategoryNoCheckbox(this.model,this.level),$(this.el).find("div.category-name:first").html(this.template.render(categoryHash.toHash())),this.model.get("blindOpen")&&this._anyChildrenShowing()?this.$el.children(".subcategory-list").slideDown(200):this.$el.children(".subcategory-list").slideUp(200).hide(),this.$el.show()):(this.$el.hide(),void 0)},CategoryNoCheckbox.prototype._setupListeners=function(){return this.listenTo(this.model,"change:count",this.render),this.listenTo(this.model,"change:selected",this.render),this.listenTo(this.model,"change:blindOpen",this.render)},CategoryNoCheckbox.prototype._categoryVisible=function(){return this.model.get("count")>0},CategoryNoCheckbox.prototype._anyChildrenShowing=function(){return this.model.get("children").some(function(subcat){return subcat.get("count")>0})},CategoryNoCheckbox.prototype.onClick=function(event){return setTimeout(this.toggleCategory,0),event.preventDefault()},CategoryNoCheckbox.prototype.toggleCategory=function(){var cache$;return this.model.get("selected")?void 0:((null!=(cache$=this.model.get("children"))?cache$.length:void 0)>0&&this.model.set("blindOpen",!0),null!=this.parentModel&&this.parentModel.set("selected",!1),this.model.set("selected",!0))},CategoryNoCheckbox}(Backbone.View),Modules.RefinementBar.Views.Reset=function(super$){function Reset(){super$.apply(this,arguments)}return extends$(Reset,super$),Reset.prototype.initialize=function(param$){return this.modelsAccessor=param$.modelsAccessor,this.openModels=new Backbone.Collection,this.watchedCollections=[],Groupon.enabledFeatures.showLHNCheckboxes?this.watchedCollections=this.modelsAccessor.getCollections():(this.watchedCollections.push(this.modelsAccessor.getCollections("locations")),this.watchedCollections.push(this.modelsAccessor.getCollections("interests")),this.watchedCollections.push(this.modelsAccessor.getCollections("topLevelCategoryLinks"))),_.each(this.watchedCollections,function(this$){return function(collectionItem){return _.each(collectionItem.models,function(this$1){return function(collectionModel){return collectionModel.get("selected")&&this$1.openModels.push(collectionModel),null!=collectionModel.get("children")?_.each(collectionModel.get("children").models,function(this$2){return function(collectionChild){return collectionChild.get("selected")?this$2.openModels.push(collectionChild):void 0}}(this$1)):void 0}}(this$))}}(this)),this.registerListeners(),this.openModels.length>0?this.showButton():void 0},Reset.prototype.events={click:"resetCategories"},Reset.prototype.registerListeners=function(){return _.each(this.watchedCollections,function(this$){return function(CollectionItem){return this$.listenTo(CollectionItem,"selectionChanged",this$.updateButtonState)}}(this))},Reset.prototype.updateButtonState=function(changedItem){return changedItem.get("selected")?this.openModels.add(changedItem):this.openModels.remove(changedItem),this.openModels.length?this.showButton():this.hideButton()},Reset.prototype.hideButton=function(){return this.$el.hide()},Reset.prototype.showButton=function(){return this.$el.show()},Reset.prototype.resetCategories=function(){return this.stopListening(),this.openModels.invoke("set",{selected:!1}),this.openModels.reset(),this.hideButton(),this.registerListeners()},Reset}(Backbone.View),Modules.RefinementBar.Helpers.ViewBuilder=function(){function ViewBuilder(){}var buildCategoryViewsNoCheckbox,buildViewsForCheckboxRefinements,buildViewsForInterestsBar,buildViewsForLocationsBar;return ViewBuilder.prototype.build=function(modelsAccessor,omitSearch,pageReadyEventConfig){var cache$,eventSource,eventType;return null==pageReadyEventConfig&&(pageReadyEventConfig={}),Groupon.enabledFeatures.showLHNCheckboxes?buildViewsForCheckboxRefinements(modelsAccessor):buildCategoryViewsNoCheckbox(modelsAccessor.getCategoryPairs(),1),buildViewsForInterestsBar(modelsAccessor),buildViewsForLocationsBar(modelsAccessor),this.buildViewsForRefinementLinks(modelsAccessor,omitSearch),cache$=pageReadyEventConfig,eventSource=cache$.eventSource,eventType=cache$.eventType,null!=eventSource&&null!=eventType?Backbone.Events.listenTo(eventSource,eventType,function(this$){return function(){return this$.buildViewsForModal(modelsAccessor)}}(this)):this.buildViewsForModal(modelsAccessor),new Modules.RefinementBar.Views.Reset({modelsAccessor:modelsAccessor,el:$("#clear-module")})},ViewBuilder.prototype.buildViewsForRefinementLinks=function(modelsAccessor,omitSearch){var subcategoryLinkPairs;return subcategoryLinkPairs=modelsAccessor.getSubcategoryLinkPairs(),function(accum$){for(var cache$1,el,model,cache$=modelsAccessor.getTopLevelCategoryLinks(),i$=0,length$=cache$.length;length$>i$;++i$)cache$1=cache$[i$],model=cache$1.model,el=cache$1.el,_.each(model.get("children").models,function(subcategoryLink){var linkInstance,modelElPair;return modelElPair=subcategoryLinkPairs[model.get("id")][subcategoryLink.get("id")],null!=modelElPair?linkInstance=new Modules.RefinementBar.Views.TopCategoryLink({model:modelElPair.model,el:modelElPair.el}):void 0}),accum$.push(new Modules.RefinementBar.Views.RefinementLinks({interestsCollection:modelsAccessor.getCollections("interests"),topCategoryLinks:model.get("children"),omitSearch:omitSearch,model:model,el:el}));return accum$}.call(this,[])},ViewBuilder.prototype.buildViewsForModal=function(modelsAccessor){var allCitiesView,citiesAndNeighborhoodsView,cityCheckboxes,cityViews,interestCollection,interestsView,isTabbed,modalView,neighborhoodsCheckboxes,onOpenListener,proxyInterests,proxyLocations,tabbedCities;return proxyLocations=modelsAccessor.getProxyCollections("locations"),proxyInterests=modelsAccessor.getProxyCollections("interests"),tabbedCities=new Backbone.Collection(proxyLocations.filter(function(city){return city.get("children").length>=Groupon.RefinementBar.NeighborhoodsDisplayThreshold})),isTabbed=tabbedCities.length>1,neighborhoodsCheckboxes={},cityViews=tabbedCities.map(function(this$){return function(city){var neighborhoodsView;return neighborhoodsView=this$.buildNeighborhoodsViewForCity(city,neighborhoodsCheckboxes),this$.buildCityNeighborhoodsView(city,neighborhoodsView,isTabbed)}}(this)),citiesAndNeighborhoodsView=1===tabbedCities.length?new Modules.RefinementBar.Views.ModalNonTabbedCities({cityViews:cityViews[0]}):new Modules.RefinementBar.Views.ModalTabbedCities({cityViews:cityViews}),cityCheckboxes=proxyLocations.sortForModal().map(function(this$){return function(city){return tabbedCities.contains(city)?this$.buildCityCheckbox(city,neighborhoodsCheckboxes[city.get("id")]):new Modules.RefinementBar.Views.ModalCheckbox({model:city})}}(this)),allCitiesView=new Modules.RefinementBar.Views.RefinementList({refinementViews:cityCheckboxes}),interestCollection=proxyInterests.sortForModal(),interestsView=this.buildInterestsView(interestCollection),modalView=new Modules.RefinementBar.Views.ShowMoreModal({locationsCollection:proxyLocations,interestsCollection:proxyInterests,categoriesCollection:modelsAccessor.getProxyCollections("categories"),tabbedCitiesView:citiesAndNeighborhoodsView,allCitiesView:allCitiesView,interestsView:interestsView}),onOpenListener=function(){return proxyLocations.resetState(),proxyInterests.resetState()},$(".show-more-locations").bind("click",function(){return onOpenListener(),modalView.showLocations()}),$(".show-more-interests").bind("click",function(){return onOpenListener(),modalView.showInterests()})},ViewBuilder.prototype.buildInterestsView=function(interestCollection){var interestViews;return interestViews=interestCollection.map(function(interest){return new Modules.RefinementBar.Views.ModalCheckbox({model:interest})}),new Modules.RefinementBar.Views.RefinementList({refinementViews:interestViews})},ViewBuilder.prototype.buildNeighborhoodsViewForCity=function(city,neighborhoodsCheckboxes){var filteredNeighborhoods,filteredNeighborhoodViews,neighborhoodsView,neighborhoodViews,zeroCountNeighborhoods;return neighborhoodViews=_.map(city.get("children").models,function(neighborhood){return new Modules.RefinementBar.Views.ModalCheckbox({model:neighborhood,toggleListener:function(){return city.set("selected",!1)}})}),neighborhoodsCheckboxes[city.get("id")]=_.clone(neighborhoodViews),neighborhoodViews.unshift(this.buildAllCityView(city,neighborhoodViews.slice(0))),filteredNeighborhoods=_.filter(neighborhoodViews,function(neighborhood){return neighborhood.isEnabled()}),zeroCountNeighborhoods=_.difference(neighborhoodViews,filteredNeighborhoods),filteredNeighborhoodViews=Modules.RefinementBar.Helpers.ModalBuilder.prototype.orderTopDown(filteredNeighborhoods),neighborhoodsView=new Modules.RefinementBar.Views.RefinementList({refinementViews:filteredNeighborhoodViews.concat(zeroCountNeighborhoods)})},ViewBuilder.prototype.buildCityNeighborhoodsView=function(city,neighborhoodsView,isTabbed){return null==isTabbed&&(isTabbed=!0),new Modules.RefinementBar.Views.ModalCity({city:city,neighborhoodsView:neighborhoodsView},isTabbed)},ViewBuilder.prototype.buildAllCityView=function(refinement,neighborhoodViews){return this.buildModalCheckbox(refinement,{toggleListener:function(){return _.invoke(neighborhoodViews,"clearCheckbox")},label:I18n.translate("js.modules.refinement_bar.all")})},ViewBuilder.prototype.buildCityCheckbox=function(city,neighborhoodViews){return this.buildModalCheckbox(city,{toggleListener:function(){return _.invoke(neighborhoodViews,"clearCheckbox")}})},ViewBuilder.prototype.buildModalCheckbox=function(refinement,constructorParams){var defaultConstructorParams;return null==constructorParams&&(constructorParams={}),defaultConstructorParams={model:refinement},new Modules.RefinementBar.Views.ModalCheckbox(_.defaults(constructorParams,defaultConstructorParams))},buildViewsForCheckboxRefinements=function(modelsAccessor){for(var cache$1,el,model,subcatCollectionView,view,cache$=modelsAccessor.getCategoryPairs(),i$=0,length$=cache$.length;length$>i$;++i$)cache$1=cache$[i$],model=cache$1.model,el=cache$1.el,subcatCollectionView=new Modules.RefinementBar.Views.Subcategories({collection:model.get("children"),categoryModel:model,el:$(el).find(".subcategory-list")[0]}),view=new Modules.RefinementBar.Views.Category({el:el,model:model}),view.render();return new Modules.RefinementBar.Views.Categories({collection:modelsAccessor.getCollections("categories"),el:$(".categories-wrapper")[0]}).render()},buildCategoryViewsNoCheckbox=function(categories,level,parentModel){return function(accum$){for(var cache$,childrenPairs,el,model,i$=0,length$=categories.length;length$>i$;++i$)cache$=categories[i$],model=cache$.model,el=cache$.el,childrenPairs=cache$.childrenPairs,new Modules.RefinementBar.Views.CategoryNoCheckbox({el:el,model:model,parentModel:parentModel,level:level}).render(),accum$.push(buildCategoryViewsNoCheckbox(childrenPairs,level+1,model));return accum$}.call(this,[])},buildViewsForInterestsBar=function(modelsAccessor){return new Modules.RefinementBar.Views.InterestRefinements({el:$(".recent-interests"),refinements:modelsAccessor.getCollections("interests")}).render()},buildViewsForLocationsBar=function(modelsAccessor){return new Modules.RefinementBar.Views.LocationRefinements({el:$(".recent-locations"),refinements:modelsAccessor.getCollections("locations")}).render()},ViewBuilder}(),Modules.RefinementBar.Helpers.BuilderFromHtml=function(){function BuilderFromHtml(){}return BuilderFromHtml.prototype.build=function(param$,omitSearch,pageReadyEventConfig){var modelsAccessor;return this.$DomRefinements=param$,modelsAccessor=(new Modules.RefinementBar.Helpers.ModelBuilder).build(this.$DomRefinements),(new Modules.RefinementBar.Helpers.ViewBuilder).build(modelsAccessor,omitSearch,pageReadyEventConfig),modelsAccessor},BuilderFromHtml}(),Modules.RefinementBar.Presenters.Category=function(){function Category(param$,param$1){this.model=param$,this.attributes=param$1}return Category.prototype.toHash=function(){return{id:this.model.get("id"),countText:this._getCountText(),showCount:this._showCountText(),expanderClass:this._getExpanderClass(),childrenShowing:this.attributes.childrenShowing,dataBhc:Modules.RefinementBar.Helpers.DataConstructor.dataBhc(this.model,"category"),checked:this.model.get("selected"),friendlyNameShort:this.model.get("friendlyName"),url:this.model.get("url")}},Category.prototype._getCountText=function(){return this.model.get("selected")?I18n.translate("js.modules.refinement_bar.all"):this.attributes.selectedChildCount},Category.prototype._showCountText=function(){return this.model.get("selected")||this.attributes.selectedChildCount>0},Category.prototype._getExpanderClass=function(){return this.model.get("blindOpen")?"minus":"plus"},Category}(),Modules.RefinementBar.Views.Category=function(super$){function Category(){var instance$;instance$=this,this.toggleCheckBox=function(){return Category.prototype.toggleCheckBox.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Category,super$),Category.prototype.initialize=function(){return this._setupListeners(),this.initialDomRemoved=!1},Category.prototype.template=Groupon.MustacheTemplates.refinement_bar_category,Category.prototype.events={"click .category-name input":"onClickInput","click .category-name":"onClick"},Category.prototype.render=function(){var $countEl,categoryHash;return this._anyCategoriesShowing()?(categoryHash=new Modules.RefinementBar.Presenters.Category(this.model,{selectedChildCount:this._selectedChildrenCount(),childrenShowing:this._anyChildrenShowing()}),$(this.el).find("div.category-name").html(this.template.render(categoryHash.toHash())),$countEl=this.$el.find(".count"),this._anyCategoriesSelected()?$countEl.fadeIn(300):$countEl.fadeOut(300).hide(),this.model.get("blindOpen")&&this._anyChildrenShowing()?this.$el.find(".subcategory-list").slideDown(200):this.$el.find(".subcategory-list").slideUp(200).hide(),this.$el.find(".category-name input").prop("indeterminate",this._selectedChildrenCount()>0),this.$el.show()):this.$el.hide(),this.initialDomRemoved?void 0:(this.removeInitializationDOM(),this.initialDomRemoved=!0)},Category.prototype._setupListeners=function(){return this.listenTo(this.model,"change:selected",this.render),this.listenTo(this.model,"change:blindOpen",this.render),this.listenTo(Modules.RefinementBar.Application.dealsEvents,"dealsReplaced",this.render),this.listenTo(this.model.get("children"),"change:selected",this.render)},Category.prototype._anyCategoriesSelected=function(){return this._selectedChildrenCount()>0||this.model.get("selected")},Category.prototype._anyCategoriesShowing=function(){return this.model.get("count")>0||this._anyChildrenShowing()},Category.prototype._anyChildrenShowing=function(){return this.model.get("children").some(function(subcat){return subcat.get("count")>0})},Category.prototype._selectedChildrenCount=function(){return this.model.get("children").where({selected:!0}).length},Category.prototype.onClickInput=function(){return setTimeout(this.toggleCheckBox,0)},Category.prototype.onClick=function(event){var target;return target=$(event.target),this._anyChildrenShowing()&&!target.is("input")&&this.toggleBlind(),event.preventDefault()},Category.prototype.toggleBlind=function(){return this.model.set("blindOpen",!this.model.get("blindOpen"))},Category.prototype.toggleCheckBox=function(){return this.model.toggle(),this.model.unsetChildren(),this.render()},Category.prototype.removeInitializationDOM=function(){return this.$el.find(".category-name").removeClass("hide"),this.$el.find(".subcategory-list").removeClass("hide"),this.$el.find(".count").removeClass("hide")},Category}(Backbone.View),Modules.RefinementBar.Views.SearchBubble=function(super$){function SearchBubble(){super$.apply(this,arguments)}return extends$(SearchBubble,super$),SearchBubble.prototype.template=Groupon.MustacheTemplates.refinement_bar_search_bubble,SearchBubble.prototype.events={click:"_removeSearch"},SearchBubble.prototype.initialize=function(param$){var searchText;return searchText=param$.searchText,this.render(searchText)},SearchBubble.prototype.render=function(queryParam){return this.$el.find("ul").append(this.template.render({searchTerm:queryParam})),this.$el.show()},SearchBubble.prototype._removeSearch=function(){var queryParams;return queryParams=_.omit(Groupon.Utils.unparam(),"query"),window.location=""+window.location.pathname+"?"+$.param(queryParams)},SearchBubble}(Backbone.View),void function(){var andCondition,cache$,cache$1,constructFacetString,createCategoriesFilterString,createCityNeighborhoodFilterString,createCollectionFilterString,createFilterString,createFlatFilterString,each,exportHelper,FACETS,filter,filterStringConstructor,filterStringFromTree,find,getChildren,getRefinementSpecifier,groupBy,map,orCondition,reject,TAGS,union,where,wrapAndJoin;cache$="undefined"!=typeof _&&null!=_?_:require("underscore"),filter=cache$.filter,each=cache$.each,find=cache$.find,groupBy=cache$.groupBy,map=cache$.map,where=cache$.where,reject=cache$.reject,union=cache$.union,cache$1=null!=("undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers.exportHelpers:void 0:require("./export_helper"),getChildren=cache$1.getChildren,exportHelper=cache$1.exportHelper,TAGS={category:"category2",subcategory:"category3",city:"city",neighborhood:"neighborhood"},FACETS={DEAL_TYPE:"deal_type",CITY_NEIGHBORHOOD:"city|neighborhood",CATEGORIES:"topcategory|category|category2|category3"},filterStringConstructor=function(param$){var cache$2,categories,country,interests,locations;return cache$2=param$,categories=cache$2.categories,interests=cache$2.interests,locations=cache$2.locations,country=cache$2.country,createFilterString(categories,interests,locations,country)},createFilterString=function(categories,interests,locations,country){var conjunction,filterStr;return null==country&&(country="US"),conjunction=[createCategoriesFilterString(categories,country),createFlatFilterString(interests,FACETS.DEAL_TYPE,country),createCityNeighborhoodFilterString(locations,country)],conjunction=reject(conjunction,function(str){return""===str
}),filterStr=conjunction.join(";")},createFlatFilterString=function(refinementsCollection,tag,country){var disjunction,filterString,selected;return selected=where(refinementsCollection,{selected:!0}),disjunction=map(selected,function(refinement){return""+tag+":"+refinement.id}),filterString=wrapAndJoin(disjunction,orCondition(country)),constructFacetString(filterString,tag)},createCityNeighborhoodFilterString=function(locCollection,country){var cityNeighborhoodFilterString;return cityNeighborhoodFilterString=filterStringFromTree(locCollection,["city","neighborhood"],country),constructFacetString(cityNeighborhoodFilterString,FACETS.CITY_NEIGHBORHOOD)},createCategoriesFilterString=function(catCollection,country){var categoryCollection,categoryFilterString;return categoryCollection=catCollection,null==("undefined"!=typeof Groupon&&null!=Groupon?Groupon.enabledFeatures:void 0)||Groupon.enabledFeatures.showLHNCheckboxes||(categoryCollection=map(null!=catCollection&&null!=catCollection[0]&&null!=catCollection[0].children?catCollection[0].children.models:void 0,function(category){return category.attributes})),categoryFilterString=filterStringFromTree(categoryCollection,["category","subcategory"],country),constructFacetString(categoryFilterString,FACETS.CATEGORIES)},constructFacetString=function(filterString,tag){return filterString?""+tag+"->"+filterString:tag},filterStringFromTree=function(collection,levelTypes,country){var cache$2,disjunction,selectedCats,split,unselected;return split=groupBy(collection,"selected"),cache$2=[split["true"],split["false"]],selectedCats=cache$2[0],unselected=cache$2[1],disjunction=map(selectedCats,function(c){return getRefinementSpecifier(c,levelTypes[0])}),levelTypes[1]&&each(unselected,function(parent){var childStr,selectedChildren;return selectedChildren=where(getChildren(parent),{selected:!0}),selectedChildren.length>0?(childStr=createCollectionFilterString(selectedChildren,levelTypes[1],country),disjunction.push("("+getRefinementSpecifier(parent,levelTypes[0])+andCondition(country)+childStr+")")):void 0}),wrapAndJoin(disjunction,orCondition(country))},createCollectionFilterString=function(collection,refinementType,country){var disjunction;return disjunction=map(collection,function(refinement){return""+TAGS[refinementType]+":"+refinement.id}),wrapAndJoin(disjunction,orCondition(country))},getRefinementSpecifier=function(model,refinementType){return""+TAGS[refinementType]+":"+model.id},wrapAndJoin=function(array,separator){return array.length>1?"("+array.join(separator)+")":array.join(separator)},exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.RefinementBar.Helpers:void 0:module.exports,[],"ConstructFilterString",filterStringConstructor),andCondition=function(country){return"US"===country?",":" AND "},orCondition=function(country){return"US"===country?"|":" OR "}}.call(this),Modules.RefinementBar.Presenters.FilterString=function(){function FilterString(param$,initFilterString){var cache$;cache$=param$,this.categories=cache$.categories,this.locations=cache$.locations,this.interests=cache$.interests,null==initFilterString&&(initFilterString=!1),this.filterString="",initFilterString&&(this.filterString=this.buildFilterString()),_.each([this.categories,this.locations,this.interests],function(this$){return function(collection){return collection.on("selectionChanged",function(this$1){return function(){return this$1.queueCreateFilterString()}}(this$))}}(this))}return _.extend(FilterString.prototype,Backbone.Events),FilterString.prototype.queueCreateFilterString=function(){var queued;return queued=!1,function(){return queued?void 0:(queued=!0,_.defer(function(this$){return function(){return queued=!1,this$.createFilterString()}}(this)))}}(),FilterString.prototype.setFilterString=function(str){var emit;return emit=str!==this.filterString,this.filterString=str,emit?this.trigger("filterChanged"):this.trigger("filterNotChanged")},FilterString.prototype.createFilterString=function(){var filterStr;return filterStr=this.buildFilterString(),this.setFilterString(filterStr)},FilterString.prototype.buildFilterString=function(){return Modules.RefinementBar.Helpers.ConstructFilterString({categories:this.categories.toJSON(),interests:this.interests.toJSON(),locations:this.locations.toJSON(),country:I18n.country})},FilterString}(),null!=window.Groupon?window.Groupon:window.Groupon={},null!=Groupon.Modules?Groupon.Modules:Groupon.Modules={},Groupon.Modules.Cookies=function(){function Cookies(){}var DEFAULT_EXPIRATIONS,ONE_WEEK,TEN_YEARS;return TEN_YEARS=31536e4,ONE_WEEK=604800,DEFAULT_EXPIRATIONS={now_address:TEN_YEARS,has_dismissed_address_prompt:ONE_WEEK,has_dismissed_browse_redirect_prompt:TEN_YEARS},Cookies.get=function(key){return Cookie.get(key)},Cookies.set=function(key,val,expires){return null!=expires||(expires=DEFAULT_EXPIRATIONS[key]),Cookie.set(key,val,expires)},Cookies.unset=function(key){return Cookie.unset(key)},Cookies}(),Modules.RefinementBar.Helpers.PreserveRefinements=function(){function PreserveRefinements(param$){var cache$,watchCategories;cache$=param$,this.categories=cache$.categories,this.watchLocations=cache$.watchLocations,this.watchInterests=cache$.watchInterests,this.watchBlinds=cache$.watchBlinds,this.urlConstruction=cache$.urlConstruction,watchCategories=[],Groupon.enabledFeatures.showLHNCheckboxes?(watchCategories=this.categories,this.openedBlinds=watchCategories.filter(function(watchedCategory){return watchedCategory.get("blindOpen")}),this.openedBlinds=_.pluck(this.openedBlinds,"id")):null!=(null!=this.categories?this.categories.models[0]:void 0)&&(watchCategories=this.categories.models[0].get("children")),this.modelStorage={},this.enabledFacets={},this.avaliableFacetNames={CATEGORY_QUERY:CATEGORY_QUERY,SUBCATEGORY_QUERY:SUBCATEGORY_QUERY,INTEREST_QUERY:INTEREST_QUERY,LOCATION_QUERY:LOCATION_QUERY},_.each(_.values(this.avaliableFacetNames),function(this$){return function(facet){return this$.enabledFacets[facet]=[]}}(this)),_.each([[this.watchLocations,LOCATION_QUERY,LOCATION_QUERY],[this.watchInterests,INTEREST_QUERY],[watchCategories,CATEGORY_QUERY,SUBCATEGORY_QUERY]],function(this$){return function(param$1){var cache$1,facet,facetChild,watched;return cache$1=param$1,watched=cache$1[0],facet=cache$1[1],facetChild=cache$1[2],_.each(watched.models,function(this$1){return function(watchedModel){var cache$2;return this$1.modelStorage[watchedModel.get("id")]={model:watchedModel,type:facet},watchedModel.get("selected")&&this$1._markEnabledFacet(watchedModel,facet),null!=(cache$2=watchedModel.get("children"))?cache$2.each(function(this$2){return function(childModel){return this$2.modelStorage[childModel.get("id")]={model:childModel,type:facetChild},childModel.get("selected")?this$2._markEnabledFacet(childModel,facetChild):void 0}}(this$1)):void 0}}(this$))}}(this))}var CATEGORY_QUERY,INTEREST_QUERY,LOCATION_QUERY,PARAMS_BLACKLIST,SUBCATEGORY_QUERY;return CATEGORY_QUERY="category2",SUBCATEGORY_QUERY="category3",INTEREST_QUERY="interest",LOCATION_QUERY="location",PARAMS_BLACKLIST=["page"],_.extend(PreserveRefinements.prototype,Backbone.Events),PreserveRefinements.prototype.restore=function(){return this._setupListeners()},PreserveRefinements.prototype._setupListeners=function(){return this.watchLocations.each(function(this$){return function(location){return location.get("children").length>0?this$.listenTo(location.get("children"),"change:selected",this$._onSelectChanged):void 0}}(this)),this.listenTo(this.watchInterests,"change:selected",this._onSelectChanged),this.listenTo(this.watchLocations,"change:selected",this._onSelectChanged),this.listenTo(this.categories,"selectionChanged",this._onSelectChanged),Groupon.enabledFeatures.showLHNCheckboxes?this.listenTo(this.watchBlinds,"change:blindOpen",this._onBlindChange):void 0},PreserveRefinements.prototype._onBlindChange=function(affectedModel){return affectedModel.get("blindOpen")?this.openedBlinds.push(affectedModel.get("id")):this.openedBlinds=_.without(this.openedBlinds,affectedModel.get("id")),Groupon.Modules.Cookies.set(Groupon.RefinementBar.BlindsCookie,this.openedBlinds.toString(),300)},PreserveRefinements.prototype._onSelectChanged=function(affectedModel){var modelFound;return(modelFound=this.modelStorage[affectedModel.get("id")])?(affectedModel.get("selected")?this.enabledFacets[modelFound.type].push(affectedModel.get("id")):this.enabledFacets[modelFound.type]=_.without(this.enabledFacets[modelFound.type],affectedModel.get("id")),this._updateAppURL()):null},PreserveRefinements.prototype._updateAppURL=function(){var adjustedURL,queryParams;return queryParams=Groupon.Utils.unparam(),queryParams=_.omit(Groupon.Utils.unparam(),_.values(this.avaliableFacetNames),PARAMS_BLACKLIST),adjustedURL=this.urlConstruction(this.enabledFacets,this.avaliableFacetNames,queryParams),null!=(null!=window.history?window.history.replaceState:void 0)?window.history.replaceState(null,null,adjustedURL):window.location=adjustedURL},PreserveRefinements.prototype._markEnabledFacet=function(enabledModel,facetName){return this.enabledFacets[facetName].push(enabledModel.id)},PreserveRefinements}(),Modules.RefinementBar.Presenters.ModelCounter=function(super$){function ModelCounter(){super$.apply(this,arguments)}return extends$(ModelCounter,super$),ModelCounter.prototype.initialize=function(param$){return this.collections=param$,_.each(this.collections,function(this$){return function(collection){return this$.listenTo(collection,"selectionChanged",this$.update)}}(this)),this.update()},ModelCounter.prototype.update=function(){var counts;return counts=function(accum$){for(var collection,i$=0,length$=this.collections.length;length$>i$;++i$)collection=this.collections[i$],accum$.push(collection.countSelected());return accum$}.call(this,[]),this.set("anyRefinementsSelected",_.max(counts)>0)},ModelCounter}(Backbone.Model),void function(){function in$(member,list){for(var i=0,length=list.length;length>i;++i)if(i in list&&list[i]===member)return!0;return!1}var addSelectionChangedEvent,buildModelsAndViews,getCategoryCollection,getCategoryId,getSelectedCategoryIds,getSelectedRefinementIds;Modules.RefinementBar.Application={FACETS:{DEAL_TYPE:"deal_type",CITY_NEIGHBORHOOD:"city|neighborhood",CATEGORIES:"topcategory|category|category2|category3"},omitSearch:!1,filterString:"",events:_.clone(Backbone.Events),initialize:function(urlConstructionLibrary,pageReadyEventConfig,cb){return $(function(this$){return function(){var dealsEvents,filterPresenter;return dealsEvents=_.extend({},Backbone.Events),Modules.RefinementBar.Application.dealsEvents=dealsEvents,this$.refinementModels=buildModelsAndViews(urlConstructionLibrary,pageReadyEventConfig),filterPresenter=this$.buildFilterStringPresenter(this$.refinementModels),filterPresenter.createFilterString(),Groupon.onNoDealsPage&&(this$.omitSearch=!0),null!=cb?cb():void 0}}(this))},buildFilterStringPresenter:function(refinementModels){var filterPresenter;return filterPresenter=new Modules.RefinementBar.Presenters.FilterString(refinementModels),filterPresenter.on("filterChanged",function(this$){return function(){return this$.filterString=filterPresenter.filterString,this$.events.trigger("filterChanged")}}(this)),filterPresenter},getParsedParams:function(){var cache$,categoryCollection,filterString,interestIds,locationIds,refinementModels,selectedCategory2Ids,selectedCategory3Ids;return refinementModels=this.refinementModels,filterString=this.filterString,categoryCollection=getCategoryCollection(refinementModels),cache$=getSelectedCategoryIds(categoryCollection),selectedCategory2Ids=cache$.selectedCategory2Ids,selectedCategory3Ids=cache$.selectedCategory3Ids,interestIds=getSelectedRefinementIds(null!=refinementModels?refinementModels.interests:void 0),locationIds=getSelectedRefinementIds(null!=refinementModels?refinementModels.locations:void 0),{category:getCategoryId(),category2:selectedCategory2Ids.join(","),category3:selectedCategory3Ids.join(","),interests:interestIds.join(","),location:locationIds.join(","),filterString:filterString,local_path:window.location.pathname}}},getCategoryId=function(){var category,selectedCategory,staticCategories;return selectedCategory=Groupon.browseApp.getSelectedCategory(),staticCategories=null!=(null!=Groupon.Categories&&null!=Groupon.Categories.staticCategories?Groupon.Categories.staticCategories.ids:void 0)?null!=Groupon.Categories&&null!=Groupon.Categories.staticCategories?Groupon.Categories.staticCategories.ids:void 0:[],in$(selectedCategory,staticCategories)||(category=selectedCategory),category},getSelectedCategoryIds=function(categories){var category2,category3,selectedCategory2Ids,selectedCategory3Ids;if(selectedCategory2Ids=[],selectedCategory3Ids=[],!categories)return{selectedCategory2Ids:selectedCategory2Ids,selectedCategory3Ids:selectedCategory3Ids};for(var i$=0,length$=categories.models.length;length$>i$;++i$){category2=categories.models[i$],category2.get("selected")&&selectedCategory2Ids.push(category2.get("id"));for(var cache$=category2.get("children").models,i$1=0,length$1=cache$.length;length$1>i$1;++i$1)category3=cache$[i$1],category3.get("selected")&&selectedCategory3Ids.push(category3.get("id"))}return{selectedCategory2Ids:selectedCategory2Ids,selectedCategory3Ids:selectedCategory3Ids}},getCategoryCollection=function(refinementModels){return refinementModels?null==("undefined"!=typeof Groupon&&null!=Groupon?Groupon.enabledFeatures:void 0)||Groupon.enabledFeatures.showLHNCheckboxes?refinementModels.categories:null!=refinementModels.categories&&null!=refinementModels.categories.models[0]?refinementModels.categories.models[0].attributes.children:void 0:{}},getSelectedRefinementIds=function(refinementCollection){var children,refinement,selectedRefinementIds;if(!(null!=refinementCollection?refinementCollection.models:void 0))return[];selectedRefinementIds=[];for(var i$=0,length$=refinementCollection.models.length;length$>i$;++i$)refinement=refinementCollection.models[i$],refinement.get("selected")&&selectedRefinementIds.push(refinement.get("id")),children=refinement.get("children"),children.models.length&&(selectedRefinementIds=selectedRefinementIds.concat(getSelectedRefinementIds(children)));return selectedRefinementIds},buildModelsAndViews=function(urlConstructionLibrary,pageReadyEventConfig){var modelsAccessor,queryParams,refinementModels,selectionState;return modelsAccessor=(new Modules.RefinementBar.Helpers.BuilderFromHtml).build($(".refinement"),Groupon.onNoDealsPage,pageReadyEventConfig),refinementModels=modelsAccessor.getCollections(),Modules.RefinementBar.Application.countMerger=new Modules.RefinementBar.Helpers.FacetCountMerger(refinementModels),Modules.RefinementBar.Application.modelCounter=new Modules.RefinementBar.Presenters.ModelCounter(modelsAccessor.getCollectionsList()),selectionState=new Modules.RefinementBar.Helpers.PreserveRefinements({categories:refinementModels.categories,watchLocations:refinementModels.locations,watchInterests:refinementModels.interests,watchBlinds:refinementModels.categories,urlConstruction:urlConstructionLibrary}),selectionState.restore(),addSelectionChangedEvent(refinementModels.interests,"interestSelectionChanged"),queryParams=Groupon.Utils.unparam(),null!=queryParams.query&&null!=queryParams.category&&new Modules.RefinementBar.Views.SearchBubble({searchText:queryParams.query,el:$("#search-bubble-module")}),refinementModels},addSelectionChangedEvent=function(collection,eventName){return collection.on("change:selected",function(){return Modules.RefinementBar.Application.dealsEvents.trigger(eventName,collection)})}}.call(this),Modules.Map.Views.Controls=function(super$){function Controls(){super$.apply(this,arguments)}return extends$(Controls,super$),Controls.prototype.RESULTS_SELECTOR=".map-pagination-controls .results",Controls.prototype.PREVIOUS_SELECTOR=".map-pagination-controls .previous",Controls.prototype.NEXT_SELECTOR=".map-pagination-controls .next",Controls.prototype.events={"click .map-zoom-controls .minimize":"onClickMinimize","click .map-zoom-controls .zoom-in":"onClickZoomIn","click .map-zoom-controls .zoom-out":"onClickZoomOut","click .map-pagination-controls .previous":"onClickPaginationPrevious","click .map-pagination-controls .next":"onClickPaginationNext"},Controls.prototype.initialize=function(param$){return this.map=param$.map,this.listenTo(Modules.Deals.paginationEvents,"newPage",this.updatePagination)},Controls.prototype.render=function(){return this.$el.removeClass("hide")},Controls.prototype.hide=function(){return this.$el.addClass("hide")},Controls.prototype.onClickMinimize=function(){return Modules.Map.Application.minimizeMap()},Controls.prototype.onClickZoomIn=function(){return this.map.setZoom(this.map.getZoom()+1)},Controls.prototype.onClickZoomOut=function(){return this.map.setZoom(this.map.getZoom()-1)},Controls.prototype.onClickPaginationPrevious=function(){var shouldScroll;return Modules.Deals.Helpers.PaginationEvents.updateToPreviousPage(shouldScroll=!1)},Controls.prototype.onClickPaginationNext=function(){var shouldScroll;return Modules.Deals.Helpers.PaginationEvents.updateToNextPage(shouldScroll=!1)},Controls.prototype.updatePagination=function(event){var cache$,endingIndex,number,startingIndex,totalPages;return cache$=event,startingIndex=cache$.startingIndex,endingIndex=cache$.endingIndex,number=cache$.number,totalPages=cache$.totalPages,$(this.RESULTS_SELECTOR).text(""+startingIndex+" - "+endingIndex),1>=number?$(this.PREVIOUS_SELECTOR).removeClass("active"):$(this.PREVIOUS_SELCTOR).hasClass("active")||$(this.PREVIOUS_SELECTOR).addClass("active"),number>=totalPages?$(this.NEXT_SELECTOR).removeClass("active"):$(this.NEXT_SELECTOR).hasClass("active")?void 0:$(this.NEXT_SELECTOR).addClass("active")},Controls}(Backbone.View),Modules.Map.Views.Marker=function(super$){function Marker(){super$.apply(this,arguments)}var buildIconHash,decideMarkerIcon,differentMarkerActive,DOT_ICON_HEIGHT,DOT_ICON_URL,DOT_ICON_WIDTH,markerMouseoutCb,PIN_ICON_HEIGHT,PIN_ICON_URL,PIN_ICON_WIDTH;return extends$(Marker,super$),PIN_ICON_URL=Groupon.Maps.pinSpriteIconUrl,DOT_ICON_URL=Groupon.Maps.dotSpriteIconUrl,PIN_ICON_WIDTH=24,PIN_ICON_HEIGHT=35,DOT_ICON_WIDTH=14,DOT_ICON_HEIGHT=14,Marker.prototype.initialize=function(param$,param$1,param$2){var cache$,lat,lng;return this.markerModel=param$,this.map=param$1,this.dealCardOverlay=param$2,cache$=this.markerModel.get("location"),lat=cache$.lat,lng=cache$.lng,this.mouseOver=!1,this.marker=new google.maps.Marker({position:new google.maps.LatLng(lat,lng),map:this.map,icon:decideMarkerIcon(this.markerModel)}),this.marker.view=this,this._addListeners()},Marker.prototype.isOnPage=function(){return this.markerModel.get("isOnPage")},Marker.prototype.updateIcon=function(){return this.marker.setIcon(decideMarkerIcon(this.markerModel))},Marker.prototype._addListeners=function(){return google.maps.event.addListener(this.marker,"mouseover",function(this$){return function(){return this$.dealCardOverlay.flyoutVisible=!0,this$.dealCardOverlay.attachToMarker(this$),this$.marker.setIcon(decideMarkerIcon(this$.markerModel,{hover:!0}))}}(this)),google.maps.event.addListener(this.marker,"mouseout",function(this$){return function(){return this$.dealCardOverlay.flyoutVisible=!1,setTimeout(function(this$1){return function(){return markerMouseoutCb(this$1.dealCardOverlay,this$1.marker,this$1.markerModel)}}(this$),60)}}(this))},markerMouseoutCb=function(dealCardOverlay,marker,markerModel){return dealCardOverlay.flyoutVisible?differentMarkerActive(markerModel,dealCardOverlay)?marker.setIcon(decideMarkerIcon(markerModel)):void 0:(dealCardOverlay.detachFromMarker(),marker.setIcon(decideMarkerIcon(markerModel)))},differentMarkerActive=function(markerModel,dealCardOverlay){return markerModel.get("dealId")!==dealCardOverlay.activeMarkerView.markerModel.get("dealId")},decideMarkerIcon=function(markerModel,opts){return null==opts&&(opts={}),markerModel.get("isOnPage")?buildIconHash(PIN_ICON_URL,PIN_ICON_HEIGHT,PIN_ICON_WIDTH,opts):buildIconHash(DOT_ICON_URL,DOT_ICON_HEIGHT,DOT_ICON_WIDTH,opts)},buildIconHash=function(iconUrl,iconHeight,iconWidth,opts){var xPosition;return null==opts&&(opts={}),xPosition=opts.hover?iconWidth:0,{url:iconUrl,size:{width:iconWidth,height:iconHeight},scaledSize:{width:3*iconWidth,height:iconHeight},origin:{x:xPosition,y:0}}},Marker}(Backbone.View),ClusterIcon.prototype.onAdd=function(){var cMouseDownInCluster,cDraggingMapByCluster,cClusterIcon=this;this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){cDraggingMapByCluster=cMouseDownInCluster}),google.maps.event.addDomListener(this.div_,"mousedown",function(){cMouseDownInCluster=!0,cDraggingMapByCluster=!1}),google.maps.event.addDomListener(this.div_,"click",function(e){if(cMouseDownInCluster=!1,!cDraggingMapByCluster){var theBounds,mz,mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"click",cClusterIcon.cluster_),google.maps.event.trigger(mc,"clusterclick",cClusterIcon.cluster_),mc.getZoomOnClick()&&(mz=mc.getMaxZoom(),theBounds=cClusterIcon.cluster_.getBounds(),mc.getMap().fitBounds(theBounds),setTimeout(function(){mc.getMap().fitBounds(theBounds),null!==mz&&mc.getMap().getZoom()>mz&&mc.getMap().setZoom(mz+1)},100)),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseover",cClusterIcon.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseout",cClusterIcon.cluster_)})},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.draw=function(){if(this.visible_){var pos=this.getPosFromLatLng_(this.center_);this.div_.style.top=pos.y+"px",this.div_.style.left=pos.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var img="",bp=this.backgroundPosition_.split(" "),spriteH=parseInt(bp[0].trim(),10),spriteV=parseInt(bp[1].trim(),10),pos=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(pos),img="<img src='"+this.url_+"' style='position: absolute; top: "+spriteV+"px; left: "+spriteH+"px; ",this.cluster_.getMarkerClusterer().enableRetinaIcons_||(img+="clip: rect("+-1*spriteV+"px, "+(-1*spriteH+this.width_)+"px, "+(-1*spriteV+this.height_)+"px, "+-1*spriteH+"px);"),img+="'>",this.div_.innerHTML=img+"<div style='"+"position: absolute;"+"top: "+this.anchorText_[0]+"px;"+"left: "+this.anchorText_[1]+"px;"+"color: "+this.textColor_+";"+"font-size: "+this.textSize_+"px;"+"font-family: "+this.fontFamily_+";"+"font-weight: "+this.fontWeight_+";"+"font-style: "+this.fontStyle_+";"+"text-decoration: "+this.textDecoration_+";"+"text-align: center;"+"width: "+this.width_+"px;"+"line-height:"+this.height_+"px;"+"'>"+this.sums_.text+"</div>",this.div_.title="undefined"==typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.useStyle=function(sums){this.sums_=sums;var index=Math.max(0,sums.index-1);index=Math.min(this.styles_.length-1,index);var style=this.styles_[index];this.url_=style.url,this.height_=style.height,this.width_=style.width,this.anchorText_=style.anchorText||[0,0],this.anchorIcon_=style.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=style.textColor||"black",this.textSize_=style.textSize||11,this.textDecoration_=style.textDecoration||"none",this.fontWeight_=style.fontWeight||"bold",this.fontStyle_=style.fontStyle||"normal",this.fontFamily_=style.fontFamily||"Arial,sans-serif",this.backgroundPosition_=style.backgroundPosition||"0 0"},ClusterIcon.prototype.setCenter=function(center){this.center_=center},ClusterIcon.prototype.createCss=function(pos){var style=[];return style.push("cursor: pointer;"),style.push("position: absolute; top: "+pos.y+"px; left: "+pos.x+"px;"),style.push("width: "+this.width_+"px; height: "+this.height_+"px;"),style.join("")},ClusterIcon.prototype.getPosFromLatLng_=function(latlng){var pos=this.getProjection().fromLatLngToDivPixel(latlng);return pos.x-=this.anchorIcon_[1],pos.y-=this.anchorIcon_[0],pos.x=parseInt(pos.x,10),pos.y=parseInt(pos.y,10),pos},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var i,bounds=new google.maps.LatLngBounds(this.center_,this.center_),markers=this.getMarkers();for(i=0;i<markers.length;i++)bounds.extend(markers[i].getPosition());return bounds},Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},Cluster.prototype.addMarker=function(marker){var i,mCount,mz;if(this.isMarkerAlreadyAdded_(marker))return!1;if(this.center_){if(this.averageCenter_){var l=this.markers_.length+1,lat=(this.center_.lat()*(l-1)+marker.getPosition().lat())/l,lng=(this.center_.lng()*(l-1)+marker.getPosition().lng())/l;this.center_=new google.maps.LatLng(lat,lng),this.calculateBounds_()}}else this.center_=marker.getPosition(),this.calculateBounds_();if(marker.isAdded=!0,this.markers_.push(marker),mCount=this.markers_.length,mz=this.markerClusterer_.getMaxZoom(),null!==mz&&this.map_.getZoom()>mz)marker.getMap()!==this.map_&&marker.setMap(this.map_);else if(mCount<this.minClusterSize_)marker.getMap()!==this.map_&&marker.setMap(this.map_);else if(mCount===this.minClusterSize_)for(i=0;mCount>i;i++)this.markers_[i].setMap(null);else marker.setMap(null);return this.updateIcon_(),!0},Cluster.prototype.isMarkerInClusterBounds=function(marker){return this.bounds_.contains(marker.getPosition())},Cluster.prototype.calculateBounds_=function(){var bounds=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(bounds)},Cluster.prototype.updateIcon_=function(){var mCount=this.markers_.length,mz=this.markerClusterer_.getMaxZoom();if(null!==mz&&this.map_.getZoom()>mz)return this.clusterIcon_.hide(),void 0;if(mCount<this.minClusterSize_)return this.clusterIcon_.hide(),void 0;var numStyles=this.markerClusterer_.getStyles().length,sums=this.markerClusterer_.getCalculator()(this.markers_,numStyles);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(sums),this.clusterIcon_.show()},Cluster.prototype.isMarkerAlreadyAdded_=function(marker){var i;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(marker);for(i=0;i<this.markers_.length;i++)if(marker===this.markers_[i])return!0;return!1},MarkerClusterer.prototype.onAdd=function(){var cMarkerClusterer=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){cMarkerClusterer.resetViewport_(!1),(this.getZoom()===(this.get("minZoom")||0)||this.getZoom()===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){cMarkerClusterer.redraw_()})]},MarkerClusterer.prototype.onRemove=function(){var i;for(i=0;i<this.markers_.length;i++)this.markers_[i].getMap()!==this.activeMap_&&this.markers_[i].setMap(this.activeMap_);for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();for(this.clusters_=[],i=0;i<this.listeners_.length;i++)google.maps.event.removeListener(this.listeners_[i]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){var i,size;if(!(this.styles_.length>0))for(i=0;i<this.imageSizes_.length;i++)size=this.imageSizes_[i],this.styles_.push({url:this.imagePath_+(i+1)+"."+this.imageExtension_,height:size,width:size})},MarkerClusterer.prototype.fitMapToMarkers=function(){var i,markers=this.getMarkers(),bounds=new google.maps.LatLngBounds;for(i=0;i<markers.length;i++)bounds.extend(markers[i].getPosition());this.getMap().fitBounds(bounds)},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(gridSize){this.gridSize_=gridSize},MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinimumClusterSize=function(minimumClusterSize){this.minClusterSize_=minimumClusterSize},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.setMaxZoom=function(maxZoom){this.maxZoom_=maxZoom},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.setStyles=function(styles){this.styles_=styles},MarkerClusterer.prototype.getTitle=function(){return this.title_},MarkerClusterer.prototype.setTitle=function(title){this.title_=title},MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.setZoomOnClick=function(zoomOnClick){this.zoomOnClick_=zoomOnClick},MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.setAverageCenter=function(averageCenter){this.averageCenter_=averageCenter},MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},MarkerClusterer.prototype.setIgnoreHidden=function(ignoreHidden){this.ignoreHidden_=ignoreHidden},MarkerClusterer.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons_},MarkerClusterer.prototype.setEnableRetinaIcons=function(enableRetinaIcons){this.enableRetinaIcons_=enableRetinaIcons},MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_},MarkerClusterer.prototype.setImageExtension=function(imageExtension){this.imageExtension_=imageExtension},MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_},MarkerClusterer.prototype.setImagePath=function(imagePath){this.imagePath_=imagePath},MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_},MarkerClusterer.prototype.setImageSizes=function(imageSizes){this.imageSizes_=imageSizes},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.setCalculator=function(calculator){this.calculator_=calculator},MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},MarkerClusterer.prototype.setBatchSizeIE=function(batchSizeIE){this.batchSizeIE_=batchSizeIE},MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_},MarkerClusterer.prototype.setClusterClass=function(clusterClass){this.clusterClass_=clusterClass},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.getClusters=function(){return this.clusters_},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.addMarker=function(marker,opt_nodraw){this.pushMarkerTo_(marker),opt_nodraw||this.redraw_()},MarkerClusterer.prototype.addMarkers=function(markers,opt_nodraw){var key;for(key in markers)markers.hasOwnProperty(key)&&this.pushMarkerTo_(markers[key]);opt_nodraw||this.redraw_()},MarkerClusterer.prototype.pushMarkerTo_=function(marker){if(marker.getDraggable()){var cMarkerClusterer=this;
google.maps.event.addListener(marker,"dragend",function(){cMarkerClusterer.ready_&&(this.isAdded=!1,cMarkerClusterer.repaint())})}marker.isAdded=!1,this.markers_.push(marker)},MarkerClusterer.prototype.removeMarker=function(marker,opt_nodraw){var removed=this.removeMarker_(marker);return!opt_nodraw&&removed&&this.repaint(),removed},MarkerClusterer.prototype.removeMarkers=function(markers,opt_nodraw){var i,r,removed=!1;for(i=0;i<markers.length;i++)r=this.removeMarker_(markers[i]),removed=removed||r;return!opt_nodraw&&removed&&this.repaint(),removed},MarkerClusterer.prototype.removeMarker_=function(marker){var i,index=-1;if(this.markers_.indexOf)index=this.markers_.indexOf(marker);else for(i=0;i<this.markers_.length;i++)if(marker===this.markers_[i]){index=i;break}return-1===index?!1:(marker.setMap(null),this.markers_.splice(index,1),!0)},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},MarkerClusterer.prototype.repaint=function(){var oldClusters=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){var i;for(i=0;i<oldClusters.length;i++)oldClusters[i].remove()},0)},MarkerClusterer.prototype.getExtendedBounds=function(bounds){var projection=this.getProjection(),tr=new google.maps.LatLng(bounds.getNorthEast().lat(),bounds.getNorthEast().lng()),bl=new google.maps.LatLng(bounds.getSouthWest().lat(),bounds.getSouthWest().lng()),trPix=projection.fromLatLngToDivPixel(tr);trPix.x+=this.gridSize_,trPix.y-=this.gridSize_;var blPix=projection.fromLatLngToDivPixel(bl);blPix.x-=this.gridSize_,blPix.y+=this.gridSize_;var ne=projection.fromDivPixelToLatLng(trPix),sw=projection.fromDivPixelToLatLng(blPix);return bounds.extend(ne),bounds.extend(sw),bounds},MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)},MarkerClusterer.prototype.resetViewport_=function(opt_hide){var i,marker;for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();for(this.clusters_=[],i=0;i<this.markers_.length;i++)marker=this.markers_[i],marker.isAdded=!1,opt_hide&&marker.setMap(null)},MarkerClusterer.prototype.distanceBetweenPoints_=function(p1,p2){var R=6371,dLat=(p2.lat()-p1.lat())*Math.PI/180,dLon=(p2.lng()-p1.lng())*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(p1.lat()*Math.PI/180)*Math.cos(p2.lat()*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d},MarkerClusterer.prototype.isMarkerInBounds_=function(marker,bounds){return bounds.contains(marker.getPosition())},MarkerClusterer.prototype.addToClosestCluster_=function(marker){var i,d,cluster,center,distance=4e4,clusterToAddTo=null;for(i=0;i<this.clusters_.length;i++)cluster=this.clusters_[i],center=cluster.getCenter(),center&&(d=this.distanceBetweenPoints_(center,marker.getPosition()),distance>d&&(distance=d,clusterToAddTo=cluster));clusterToAddTo&&clusterToAddTo.isMarkerInClusterBounds(marker)?clusterToAddTo.addMarker(marker):(cluster=new Cluster(this),cluster.addMarker(marker),this.clusters_.push(cluster))},MarkerClusterer.prototype.createClusters_=function(iFirst){var i,marker,mapBounds,cMarkerClusterer=this;if(this.ready_){0===iFirst&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!=typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),mapBounds=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));var bounds=this.getExtendedBounds(mapBounds),iLast=Math.min(iFirst+this.batchSize_,this.markers_.length);for(i=iFirst;iLast>i;i++)marker=this.markers_[i],!marker.isAdded&&this.isMarkerInBounds_(marker,bounds)&&(!this.ignoreHidden_||this.ignoreHidden_&&marker.getVisible())&&this.addToClosestCluster_(marker);iLast<this.markers_.length?this.timerRefStatic=setTimeout(function(){cMarkerClusterer.createClusters_(iLast)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}},MarkerClusterer.prototype.extend=function(obj1,obj2){return function(object){var property;for(property in object.prototype)this.prototype[property]=object.prototype[property];return this}.apply(obj1,[obj2])},MarkerClusterer.CALCULATOR=function(markers,numStyles){for(var index=0,title="",count=markers.length.toString(),dv=count;0!==dv;)dv=parseInt(dv/10,10),index++;return index=Math.min(index,numStyles),{text:count,index:index,title:title}},MarkerClusterer.BATCH_SIZE=2e3,MarkerClusterer.BATCH_SIZE_IE=500,MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m",MarkerClusterer.IMAGE_EXTENSION="png",MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90],"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Modules.Map.Models.Cluster=function(super$){function Cluster(){super$.apply(this,arguments)}var isProximityCluster;return extends$(Cluster,super$),Cluster.prototype.initialize=function(markerCluster){return this.set("isProximityCluster",isProximityCluster(markerCluster))},isProximityCluster=function(markerCluster){var differentLocation,firstLat,firstLng,firstLocation,locations;return locations=_.map(markerCluster.getMarkers(),function(marker){return marker.getPosition()}),firstLocation=locations.shift(),firstLat=firstLocation.lat(),firstLng=firstLocation.lng(),differentLocation=_.find(locations,function(location){return location.lat()!==firstLat||location.lng()!==firstLng}),null!=differentLocation},Cluster}(Backbone.Model),Modules.Map.Views.InitializeClusterZoomControl=function(){return Modules.Map.Views.ClusterZoomControlOverlay=function(super$){function ClusterZoomControlOverlay(param$){var cache$,markerClustererMaxZoom;cache$=param$,this.markerClusterer=cache$.markerClusterer,this.map=cache$.map,this.activeCluster=null,this.$div=this.div=null,this.setMap(this.map),markerClustererMaxZoom=this.markerClusterer.getMaxZoom(),this.MAX_ZOOM=null!=markerClustererMaxZoom&&MAX_GOOGLE_MAP_ZOOM_LEVEL>markerClustererMaxZoom?markerClustererMaxZoom:MAX_GOOGLE_MAP_ZOOM_LEVEL}var addListeners,ICON_HEIGHT,ICON_WIDTH,MAX_GOOGLE_MAP_ZOOM_LEVEL;return extends$(ClusterZoomControlOverlay,super$),ICON_WIDTH=38,ICON_HEIGHT=38,MAX_GOOGLE_MAP_ZOOM_LEVEL=21,ClusterZoomControlOverlay.prototype.onAdd=function(){var panes;return this.$div=$("<div/>",{"class":"cluster-zoom-control zoom-in"}),this.div=this.$div[0],panes=this.getPanes(),panes.floatPane.appendChild(this.div),addListeners(this)},ClusterZoomControlOverlay.prototype.draw=function(){},ClusterZoomControlOverlay.prototype.onRemove=function(){return this.div.parentNode.removeChild(this.div)},ClusterZoomControlOverlay.prototype.attachToCluster=function(markerCluster){return this.isZoomable()&&(null!=markerCluster?markerCluster.model.get("isProximityCluster"):void 0)?(this.activeCluster=markerCluster,this.positionAndShowZoomControl()):void 0},ClusterZoomControlOverlay.prototype.positionAndShowZoomControl=function(){var cache$,clusterCenter,overlayProjection,x,y;return clusterCenter=null!=this.activeCluster?this.activeCluster.getCenter():void 0,null!=clusterCenter?(overlayProjection=this.getProjection(),cache$=overlayProjection.fromLatLngToDivPixel(clusterCenter),x=cache$.x,y=cache$.y,this.$div.css({left:x-ICON_WIDTH/2,top:y-ICON_HEIGHT/2}),this.$div.show()):void 0},ClusterZoomControlOverlay.prototype.detach=function(){return this.activeCluster=null,this.$div.hide()},ClusterZoomControlOverlay.prototype.isZoomable=function(){return this.map.getZoom()<this.MAX_ZOOM},ClusterZoomControlOverlay.prototype.zoom=function(){return null!=this.activeCluster&&this.isZoomable()?(this.map.fitBounds(this.activeCluster.getBounds()),this.detach()):void 0},ClusterZoomControlOverlay.prototype.onMouseOver=function(markerCluster){return null!=markerCluster.model?markerCluster.model:markerCluster.model=new Modules.Map.Models.Cluster(markerCluster),markerCluster.model.get("isProximityCluster")?this.attachToCluster(markerCluster):this.detach()},addListeners=function(clusterZoomControlOverlay){var cache$,div,markerClusterer;return cache$=clusterZoomControlOverlay,markerClusterer=cache$.markerClusterer,div=cache$.div,google.maps.event.addListener(markerClusterer,"mouseover",function(markerCluster){return clusterZoomControlOverlay.onMouseOver(markerCluster)}),google.maps.event.addDomListener(div,"click",function(){return clusterZoomControlOverlay.zoom()})},ClusterZoomControlOverlay}(google.maps.OverlayView)},Modules.Map.Views.InitializeClusterDealCardOverlay=function(){return Modules.Map.Views.ClusterDealCardOverlay=function(super$){function ClusterDealCardOverlay(options){var cache$;null==options&&(options={}),cache$=options,this.$el=cache$.$el,this.map=cache$.map,this.markerClusterer=cache$.markerClusterer,this.clusterZoomControl=cache$.clusterZoomControl,this.activeMarkerCluster=null,this.setMap(this.map)}var addListeners,buildClusterDealOverlay,calculateSpaceAroundCluster,styleClusterDealOverlay;return extends$(ClusterDealCardOverlay,super$),ClusterDealCardOverlay.prototype.template=Groupon.MustacheTemplates.map_deal_flyout_list,ClusterDealCardOverlay.prototype.onAdd=function(){return addListeners(this)},ClusterDealCardOverlay.prototype.draw=function(){},ClusterDealCardOverlay.prototype.show=function(){return this.$el.show()},ClusterDealCardOverlay.prototype.hide=function(){return this.$el.hide()},ClusterDealCardOverlay.prototype.attachToCluster=function(markerCluster){var arrowPointClass,bottom,bounds,cache$,cache$1,clusterDealOverlay,flyoutSideClass,hash,left,markerClusterPosition,northEastPosition,overlayProjection,renderHash,right,southWestPosition,style,top;if(null!=markerCluster)return this.activeMarkerCluster=markerCluster,overlayProjection=this.getProjection(),bounds=this.map.getBounds(),southWestPosition=overlayProjection.fromLatLngToDivPixel(bounds.getSouthWest()),northEastPosition=overlayProjection.fromLatLngToDivPixel(bounds.getNorthEast()),markerClusterPosition=overlayProjection.fromLatLngToDivPixel(this.activeMarkerCluster.getCenter()),clusterDealOverlay=buildClusterDealOverlay(this.activeMarkerCluster,markerClusterPosition,southWestPosition,northEastPosition),cache$=clusterDealOverlay,hash=cache$.hash,style=cache$.style,cache$1=style,left=cache$1.left,right=cache$1.right,top=cache$1.top,bottom=cache$1.bottom,arrowPointClass=cache$1.arrowPointClass,flyoutSideClass=cache$1.flyoutSideClass,renderHash=I18n.mixin(hash),this.$el.html(this.template.render(renderHash,Groupon.MustacheTemplates)),this.$el.css({left:left,right:right,top:top,bottom:bottom}),this.$el.removeClass("point-up point-down left right").addClass(arrowPointClass).addClass(flyoutSideClass),this.show()},ClusterDealCardOverlay.prototype.detachFromCluster=function(){return this.activeMarkerCluster=null,this.clusterZoomControl.detach(),this.hide()},addListeners=function(clusterDealCardOverlay){var $body,$el,cache$,clusterZoomControl,hoverFlyout,markerClusterer,mouseOutHandler;return cache$=clusterDealCardOverlay,markerClusterer=cache$.markerClusterer,$el=cache$.$el,clusterZoomControl=cache$.clusterZoomControl,hoverFlyout=!1,$body=$("body"),mouseOutHandler=function(){return hoverFlyout=!1,setTimeout(function(){return hoverFlyout?void 0:clusterDealCardOverlay.detachFromCluster()},60)},google.maps.event.addListener(markerClusterer,"mouseover",function(markerCluster){return hoverFlyout=!0,clusterDealCardOverlay.attachToCluster(markerCluster)}),google.maps.event.addDomListener(clusterZoomControl.div,"mouseout",mouseOutHandler),google.maps.event.addListener(markerClusterer,"mouseout",function(markerCluster){return markerCluster.model.get("isProximityCluster")?void 0:mouseOutHandler()}),$el.on("mouseleave",function(){return $body.css("overflow","auto"),hoverFlyout=!1,clusterDealCardOverlay.detachFromCluster()}),$el.on("mouseenter",function(){return $body.css("overflow","hidden"),hoverFlyout=!0})},buildClusterDealOverlay=function(activeMarkerCluster,markerClusterPosition,southWestPosition,northEastPosition){var addedDealIds,dealsOffPageFlyouts,dealsOnPageFlyouts,dealsOnPageMarker;return dealsOnPageFlyouts=[],dealsOffPageFlyouts=[],addedDealIds={},dealsOnPageMarker=!1,_.each(activeMarkerCluster.getMarkers(),function(clusteredMarker){var dealId,marker;return marker=clusteredMarker.view.markerModel,dealId=marker.get("dealId"),_.has(addedDealIds,dealId)?void 0:(addedDealIds[dealId]=dealId,marker.get("isOnPage")?(dealsOnPageMarker=!0,dealsOnPageFlyouts.push(marker.toJSON())):dealsOffPageFlyouts.push(marker.toJSON()))}),{hash:{dealFlyouts:dealsOnPageFlyouts.concat(dealsOffPageFlyouts)},style:styleClusterDealOverlay(markerClusterPosition,southWestPosition,northEastPosition,dealsOnPageMarker)}},styleClusterDealOverlay=function(markerClusterPosition,southWestPosition,northEastPosition,dealsOnPageMarker){var arrowPointClass,bottom,bottomSpace,cache$,flyoutSideClass,left,leftSpace,offsetX,offsetY,right,rightSpace,spaceAroundCluster,top,topSpace;return offsetX=52,offsetY=dealsOnPageMarker?25:15,spaceAroundCluster=calculateSpaceAroundCluster(markerClusterPosition,southWestPosition,northEastPosition),cache$=spaceAroundCluster,topSpace=cache$.topSpace,bottomSpace=cache$.bottomSpace,leftSpace=cache$.leftSpace,rightSpace=cache$.rightSpace,bottomSpace>topSpace?(arrowPointClass="point-up",top=topSpace+offsetY,bottom="auto"):(arrowPointClass="point-down",bottom=bottomSpace+offsetY,top="auto"),leftSpace>rightSpace?(flyoutSideClass="left",right=rightSpace-offsetX,left="auto"):(flyoutSideClass="right",left=leftSpace-offsetX,right="auto"),{left:left,right:right,top:top,bottom:bottom,arrowPointClass:arrowPointClass,flyoutSideClass:flyoutSideClass}},calculateSpaceAroundCluster=function(markerClusterPosition,southWestPosition,northEastPosition){return{topSpace:markerClusterPosition.y-northEastPosition.y,bottomSpace:southWestPosition.y-markerClusterPosition.y,leftSpace:markerClusterPosition.x-southWestPosition.x,rightSpace:northEastPosition.x-markerClusterPosition.x}},ClusterDealCardOverlay}(google.maps.OverlayView)},void function(){var clusterIconStyleCalculator,DEFAULTS;DEFAULTS={clusteringOptions:{averageCenter:!0,enableRetinaIcons:!0,gridSize:20,zoomOnClick:!1,styles:[{url:Groupon.Maps.pinIconUrl,height:35,width:24},{url:Groupon.Maps.dotIconUrl,height:14,width:14}]}},Modules.Map.Helpers.setupClustering=function(googleMap,googleMarkers,clusteringOptions){var clusterDealCardOverlay,clusterZoomControl,markerClusterer;return null==clusteringOptions&&(clusteringOptions={}),_.defaults(clusteringOptions,DEFAULTS.clusteringOptions),clusteringOptions.calculator=clusterIconStyleCalculator,markerClusterer=new MarkerClusterer(googleMap,googleMarkers,clusteringOptions),Modules.Map.Views.InitializeClusterZoomControl(),clusterZoomControl=new Modules.Map.Views.ClusterZoomControlOverlay({map:googleMap,markerClusterer:markerClusterer}),Modules.Map.Views.InitializeClusterDealCardOverlay(),clusterDealCardOverlay=new Modules.Map.Views.ClusterDealCardOverlay({map:googleMap,markerClusterer:markerClusterer,$el:$("#cluster-deal-card-overlay"),clusterZoomControl:clusterZoomControl}),markerClusterer},clusterIconStyleCalculator=function(googleMarkers){var DOT_STYLE_INDEX,PIN_STYLE_INDEX,pinDeal,styleIndex;return PIN_STYLE_INDEX=1,DOT_STYLE_INDEX=2,pinDeal=_.find(googleMarkers,function(googleMarker){return googleMarker.view.isOnPage()}),styleIndex=null!=pinDeal?PIN_STYLE_INDEX:DOT_STYLE_INDEX,{index:styleIndex,text:""}}}.call(this),Modules.Map.Views.Markers=function(super$){function Markers(){super$.apply(this,arguments)}return extends$(Markers,super$),Markers.prototype.initialize=function(param$){var cache$;return cache$=param$,this.markersCollection=cache$.markersCollection,this.map=cache$.map,this.dealCardOverlay=cache$.dealCardOverlay,this.listenTo(this.markersCollection,"change:isOnPage",this._updateMarkerIcon),this.listenTo(this.markersCollection,"reset",this.reset),this.markerViews={},this._create()},Markers.prototype.reset=function(){return this._clear(),this._create()},Markers.prototype.findChild=function(markerModel){return this.markerViews[markerModel.get("id")].marker},Markers.prototype._clear=function(){var key,view;for(key in this.markerViews)view=this.markerViews[key],view.marker.setMap(null);return this.markerClusterer.clearMarkers(),this.markerViews={}},Markers.prototype._create=function(){var googleMarkers;googleMarkers=[],this.markersCollection.each(function(this$){return function(markerModel){var markerView;return markerView=new Modules.Map.Views.Marker(markerModel,this$.map,this$.dealCardOverlay),googleMarkers.push(markerView.marker),this$.markerViews[markerModel.get("id")]=markerView}}(this)),this.markerClusterer=Modules.Map.Helpers.setupClustering(this.map,googleMarkers,{})},Markers.prototype._updateMarkerIcon=function(markerModel){return this.markerViews[markerModel.get("id")].updateIcon()},Markers}(Backbone.View),Modules.Map.Views.InitializeDealCard=function(){return Modules.Map.Views.DealCardOverlay=function(super$){function DealCardOverlay(options){var cache$;null==options&&(options={}),cache$=options,this.$el=cache$.$el,this.map=cache$.map,this.activeMarkerView=null,this.flyoutVisible=!1,this.setMap(this.map)}var addListeners,calculateSpaceAroundMarker,styleDealCardOverlay;return extends$(DealCardOverlay,super$),DealCardOverlay.prototype.template=Groupon.MustacheTemplates.map_deal_flyout,DealCardOverlay.prototype.onAdd=function(){return addListeners(this)},DealCardOverlay.prototype.draw=function(){},DealCardOverlay.prototype.show=function(){return this.$el.show()},DealCardOverlay.prototype.hide=function(){return this.$el.hide()},DealCardOverlay.prototype.attachToMarker=function(markerView){var arrowPointClass,bounds,cache$,dealCardOverlayStyles,left,markerPosition,northEastPosition,overlayProjection,renderHash,right,southWestPosition,top;if(null!=markerView)return this.activeMarkerView=markerView,overlayProjection=this.getProjection(),markerPosition=overlayProjection.fromLatLngToDivPixel(this.activeMarkerView.marker.getPosition()),bounds=this.map.getBounds(),northEastPosition=overlayProjection.fromLatLngToDivPixel(bounds.getNorthEast()),southWestPosition=overlayProjection.fromLatLngToDivPixel(bounds.getSouthWest()),dealCardOverlayStyles=styleDealCardOverlay(markerPosition,southWestPosition,northEastPosition,this.activeMarkerView),cache$=dealCardOverlayStyles,left=cache$.left,right=cache$.right,top=cache$.top,arrowPointClass=cache$.arrowPointClass,renderHash=I18n.mixin(this.activeMarkerView.markerModel.toJSON()),this.$el.html(this.template.render(renderHash)),this.$el.css({left:left,right:right,top:top}),this.$el.removeClass("point-left point-right").addClass(arrowPointClass),this.show()},DealCardOverlay.prototype.detachFromMarker=function(){return this.activeMarkerView=null,this.hide()},addListeners=function(dealCardOverlay){var $el;return $el=dealCardOverlay.$el,$el.on("mouseenter",function(){return dealCardOverlay.flyoutVisible=!0}),$el.on("mouseleave",function(){return dealCardOverlay.flyoutVisible=!1,dealCardOverlay.activeMarkerView.updateIcon(),dealCardOverlay.detachFromMarker()})},styleDealCardOverlay=function(markerPosition,southWestPosition,northEastPosition,activeMarkerView){var arrowPointClass,cache$,dealOnPageMarker,left,leftSpace,offsetX,offsetY,right,rightSpace,spaceAroundMarker,top,topSpace;return dealOnPageMarker=activeMarkerView.isOnPage(),offsetX=dealOnPageMarker?20:15,offsetY=dealOnPageMarker?55:40,spaceAroundMarker=calculateSpaceAroundMarker(markerPosition,southWestPosition,northEastPosition),cache$=spaceAroundMarker,topSpace=cache$.topSpace,leftSpace=cache$.leftSpace,rightSpace=cache$.rightSpace,leftSpace>rightSpace?(arrowPointClass="point-right",left="auto",right=rightSpace+offsetX):(arrowPointClass="point-left",left=leftSpace+offsetX,right="auto"),top=topSpace-offsetY,{arrowPointClass:arrowPointClass,left:left,right:right,top:top}},calculateSpaceAroundMarker=function(markerPosition,southWestPosition,northEastPosition){return{topSpace:markerPosition.y-northEastPosition.y,leftSpace:markerPosition.x-southWestPosition.x,rightSpace:northEastPosition.x-markerPosition.x}},DealCardOverlay}(google.maps.OverlayView)},Modules.Map.Helpers.mapStyles=[{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#d8d8d8"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{gamma:1.28}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#666666"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#666666"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b1cffe"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#666666"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"administrative.country",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:3}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{weight:3}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{invertLightness:"true"},{lightness:50}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],Modules.Map.Views.DynamicMap=function(super$){function DynamicMap(){super$.apply(this,arguments)}var createMap,initializeAndCreateDealCardOverlay;return extends$(DynamicMap,super$),DynamicMap.prototype.initialize=function(param$){var dealCardOverlay;return this.markersCollection=param$.markersCollection,this.map=createMap(this.$el),google.maps.event.addListenerOnce(this.map,"idle",function(this$){return function(){return this$.trigger("maps:dynamicMapLoaded")}}(this)),dealCardOverlay=initializeAndCreateDealCardOverlay(this.map),this.markerViews=new Modules.Map.Views.Markers({markersCollection:this.markersCollection,map:this.map,dealCardOverlay:dealCardOverlay}),this.listenTo(this.markersCollection,"visibleMarkersUpdated",this.updateMapBounds)},DynamicMap.prototype.render=function(){return null==this.mapControls&&this._initMapControls(),this.mapControls.render(),this.$el.show(),google.maps.event.trigger(this.map,"resize"),this.updateMapBounds()},DynamicMap.prototype.hideMap=function(){return this.mapControls.hide(),this.$el.hide()},initializeAndCreateDealCardOverlay=function(map){var dealCardOverlay;return Modules.Map.Views.InitializeDealCard(),dealCardOverlay=new Modules.Map.Views.DealCardOverlay({$el:$("#deal-card-overlay"),map:map})},DynamicMap.prototype.updateMapBounds=function(){var bounds,dealCentroid;return bounds=new google.maps.LatLngBounds,dealCentroid=this.markersCollection.dealCentroid,_.each(this.markersCollection.where({isOnPage:!0,inMapBounds:!0}),function(this$){return function(visibleMarker){return bounds.extend(this$.markerViews.findChild(visibleMarker).getPosition())}}(this)),bounds.isEmpty()?this.map.setCenter(dealCentroid):(this.map.setCenter(bounds.getCenter()),this.map.fitBounds(bounds))},DynamicMap.prototype._initMapControls=function(){return this.mapControls=new Modules.Map.Views.Controls({el:$("#dynamic-map-section #map-controls-container"),map:this.map})},createMap=function($el){return new google.maps.Map($el[0],{streetViewControl:!1,zoomControl:!1,disableDefaultUI:!0,mapTypeControl:!1,scrollwheel:!1,zoom:10,styles:Modules.Map.Helpers.mapStyles})},DynamicMap}(Backbone.View),void function(){var usePushState;Modules.Shared.Helpers.updateAppURL=function(adjustedURL,opts){return null==opts&&(opts={}),usePushState(opts)?window.history.pushState(null,null,adjustedURL):null!=(null!=window.history?window.history.replaceState:void 0)?window.history.replaceState(null,null,adjustedURL):window.location=adjustedURL},usePushState=function(opts){return opts.pushState?null!=(null!=window.history?window.history.pushState:void 0):!1}}.call(this),void function(){var buildChannelQueryString,buildMapOptions,cache$,channelToQueryString,COLON_CHARACTER,cutUrl,defaults,each,escape,exportHelper,extendChannelDefaults,getDealCentroid,getMarkerLocation,getStaticMapMarkersParam,getStaticMapParams,getStaticMapUrl,PIPE_CHARACTER,qs,toArray;cache$="undefined"!=typeof _&&null!=_?_:require("underscore"),defaults=cache$.defaults,each=cache$.each,escape=cache$.escape,toArray=cache$.toArray,exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,"undefined"!=typeof require&&null!=require&&(qs=require("qs")),PIPE_CHARACTER="%7C",COLON_CHARACTER="%3A",buildMapOptions=function(options){var channel;return null==options&&(options={}),channel=extendChannelDefaults(options),{sensor:"false",version:"3.13",callback:"Modules.Map.Application.onMapsScriptLoaded",channel:channel,channelQueryString:channelToQueryString(channel)}},buildChannelQueryString=function(options){return channelToQueryString(extendChannelDefaults(options))},channelToQueryString=function(channel){return escape(toArray(channel).join("-"))},extendChannelDefaults=function(options){return defaults(options,{domain:"www.groupon.com",product:"pull",page:"browse",usage:"company-box"})},getStaticMapUrl=function(options){var cache$1,mapProxyBase,parameterHash,stringify,url,urlMaxLength;return stringify=null!=(null!=qs?qs.stringify:void 0)?null!=qs?qs.stringify:void 0:$.param,cache$1=options,urlMaxLength=cache$1.urlMaxLength,mapProxyBase=cache$1.mapProxyBase,parameterHash=getStaticMapParams(options),url=""+mapProxyBase+"/maps/api/staticmap?"+decodeURIComponent(stringify(parameterHash)),cutUrl(url,urlMaxLength)},getStaticMapParams=function(options){var cache$1,domain,height,locations,pinIconUrl,width;return cache$1=options,width=cache$1.width,height=cache$1.height,domain=cache$1.domain,locations=cache$1.locations,pinIconUrl=cache$1.pinIconUrl,{size:""+width+"x"+height,scale:2,maptype:"roadmap",sensor:"false",format:"png",channel:buildChannelQueryString({domain:domain}),markers:getStaticMapMarkersParam(locations,pinIconUrl)}},getStaticMapMarkersParam=function(locations,iconUrl){var locationsList,markerQueryString;return markerQueryString="icon:http%3A"+iconUrl+PIPE_CHARACTER+"scale"+COLON_CHARACTER+"2",locationsList=null!=locations.models?locations.models:locations,each(locationsList,function(location){var cache$1,lat,lng;return cache$1=getMarkerLocation(location),lat=cache$1.lat,lng=cache$1.lng,markerQueryString+=""+PIPE_CHARACTER+lat+","+lng}),markerQueryString},getMarkerLocation=function(location){return"function"==typeof location.get?location.get("location"):{lat:location.lat,lng:location.lng}},getDealCentroid=function(queryParams,division){return null==queryParams&&(queryParams={}),null==division&&(division={}),null!=queryParams.lat&&null!=queryParams.lng?{lat:parseFloat(queryParams.lat),lng:parseFloat(queryParams.lng)}:null!=division.lat&&null!=division.lng?{lat:division.lat,lng:division.lng}:{lat:0,lng:0}},cutUrl=function(url,urlMaxLength){var lastIndex;return url.length>urlMaxLength&&(url=url.substring(0,urlMaxLength+1),lastIndex=url.lastIndexOf(PIPE_CHARACTER),url=url.substring(0,lastIndex)),url},"undefined"!=typeof Modules&&null!=Modules&&(Modules.Map.Helpers.MapBuilder={}),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0:module.exports,[],"getStaticMapUrl",getStaticMapUrl),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0:module.exports,[],"buildMapOptions",buildMapOptions),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.MapBuilder:void 0:module.exports,[],"getDealCentroid",getDealCentroid)}.call(this),Modules.Map.Views.StaticMap=function(super$){function StaticMap(){var instance$;instance$=this,this.hideMap=function(){return StaticMap.prototype.hideMap.apply(instance$,arguments)},super$.apply(this,arguments)}var buildStaticMap;return extends$(StaticMap,super$),StaticMap.prototype.initialize=function(param$){this.markers=param$.markers},StaticMap.prototype.events={click:"maximizeMap"},StaticMap.prototype.render=function(){return $("#static-map .map-error").addClass("hide"),this.$el.find(".maximize-map-icon").show(),null!=this.markers&&buildStaticMap(this.$el,this.markers),this.$el.show()},StaticMap.prototype.maximizeMap=function(){return"none"!==this.$el.find("img").css("display")?Modules.Map.Application.maximizeMap():void 0},StaticMap.prototype.hideMap=function(){return this.$el.hide()},buildStaticMap=function($el,markers){var cache$,mapproxy,options,pinIconUrl,staticMap,url;return cache$=Groupon.Maps,staticMap=cache$.staticMap,mapproxy=cache$.mapproxy,pinIconUrl=cache$.pinIconUrl,options={urlMaxLength:staticMap.url_max_length,mapProxyBase:mapproxy,domain:window.location.host,width:staticMap.width,height:staticMap.height,locations:markers.where({inMapBounds:!0}),pinIconUrl:pinIconUrl,dealCentroid:Modules.Map.Helpers.MapBuilder.getDealCentroid(Groupon.Utils.unparam(),Groupon.division)},url=Modules.Map.Helpers.MapBuilder.getStaticMapUrl(options),$el.find("img").attr("src",url).show()},StaticMap}(Backbone.View),Modules.Map.Models.Marker=function(super$){function Marker(){super$.apply(this,arguments)}return extends$(Marker,super$),Marker.prototype.defaults=function(){return{isOnPage:!1}},Marker.prototype.initialize=function(){return this.collection?this.listenTo(this.collection,"newPagination",this.onPagination):void 0},Marker.prototype.onPagination=function(param$){var cache$,cache$1,endingIndex,startingIndex;return cache$=param$,startingIndex=cache$.startingIndex,endingIndex=cache$.endingIndex,this.set("isOnPage",startingIndex<=(cache$1=this.get("dealPosition"))&&endingIndex>=cache$1)},Marker}(Backbone.Model),void function(){var exportHelper,getPageBlockForPageNumber,getValidPageNumber,isSamePageBlock;exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,getValidPageNumber=function(pageNumber){return pageNumber=parseInt(pageNumber),isNaN(pageNumber)||1>pageNumber?1:pageNumber},getPageBlockForPageNumber=function(pageNumber,numPagesPerBlock){return Math.floor((pageNumber-1)/numPagesPerBlock)},isSamePageBlock=function(priorPageNumber,currentPageNumber,numPagesPerBlock){return getPageBlockForPageNumber(priorPageNumber,numPagesPerBlock)===getPageBlockForPageNumber(currentPageNumber,numPagesPerBlock)},"undefined"!=typeof Modules&&null!=Modules&&(Modules.Map.Helpers.PaginationHelper={}),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0:module.exports,[],"getValidPageNumber",getValidPageNumber),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0:module.exports,[],"getPageBlockForPageNumber",getPageBlockForPageNumber),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Map.Helpers.PaginationHelper:void 0:module.exports,[],"isSamePageBlock",isSamePageBlock)
}.call(this),void function(){var EARTH_RADIUS_IN_MILES,exportHelper,milesBetweenLocations,radiansBetweenLocations;exportHelper=(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Shared.Helpers.exportHelpers:void 0:requireRoot("modules/shared/helpers/export_helper")).exportHelper,EARTH_RADIUS_IN_MILES=3956.547,radiansBetweenLocations=function(a,b){var cosΔλ,cosφ0,cosφ1,dec2rad,sinΔλ,sinφ0,sinφ1,t,Δλ,φ0,φ1;return dec2rad=Math.PI/180,Δλ=(b.lng-a.lng)*dec2rad,φ0=a.lat*dec2rad,φ1=b.lat*dec2rad,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ)},milesBetweenLocations=function(a,b){var radianDistance;return radianDistance=radiansBetweenLocations(a,b),radianDistance*EARTH_RADIUS_IN_MILES},"undefined"!=typeof Modules&&null!=Modules&&(Modules.Browse.Helpers.LocationDistance={}),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.LocationDistance:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.LocationDistance:void 0:module.exports,[],"radiansBetweenLocations",radiansBetweenLocations),exportHelper(null!=("undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.LocationDistance:void 0)?"undefined"!=typeof Modules&&null!=Modules?Modules.Browse.Helpers.LocationDistance:void 0:module.exports,[],"milesBetweenLocations",milesBetweenLocations)}.call(this),void function(){function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}var inMapBounds;Modules.Map.Collections.Markers=function(super$){function Markers(){super$.apply(this,arguments)}return extends$(Markers,super$),Markers.prototype.model=Modules.Map.Models.Marker,Markers.prototype.url="/browse/deals/map",Markers.prototype.initialize=function(){return this.page=Modules.Map.Helpers.PaginationHelper.getValidPageNumber(Groupon.pagination.pageNumber),this.dealCentroid=Modules.Map.Helpers.MapBuilder.getDealCentroid(Groupon.Utils.unparam(),Groupon.division),this.listenTo(Modules.Deals.paginationEvents,"newPage",this.updatePagination)},Markers.prototype.parse=function(fetchedData){var cache$,dealPosition,endingIndex,mapData,markers,startingDealPosition,startingIndex;return mapData=fetchedData.mapData,cache$=Groupon.pagination,startingIndex=cache$.startingIndex,endingIndex=cache$.endingIndex,startingDealPosition=cache$.startingDealPosition,markers=[],dealPosition=startingDealPosition,_.each(mapData,function(this$){return function(deal){var cache$1,id,isOnPage,locations;return cache$1=deal,id=cache$1.id,locations=cache$1.locations,isOnPage=dealPosition>=startingIndex&&endingIndex>=dealPosition,_.each(locations,function(this$1){return function(location){var markerData;return markerData=_.extend({},deal,{id:""+id+"-"+location.id,dealId:id,dealPosition:dealPosition,location:location,isOnPage:isOnPage,inMapBounds:inMapBounds(location,this$1.dealCentroid),bloodhoundData:JSON.stringify({accessType:deal.accessType,dealId:id,isOnPage:isOnPage})}),markers.push(markerData)}}(this$)),dealPosition+=1}}(this)),markers},Markers.prototype.updatePagination=function(event){var number,numPagesOfDealsOnMap;return number=event.number,numPagesOfDealsOnMap=Groupon.Maps.numPagesOfDealsOnMap,Modules.Map.Helpers.PaginationHelper.isSamePageBlock(this.page,number,numPagesOfDealsOnMap)?(this.page=number,this.trigger("newPagination",event),_.defer(_.bind(this.notifyBoundsUpdate,this,event))):(this.page=number,this.trigger("maps:newPageBlock"))},Markers.prototype.notifyBoundsUpdate=function(event){return this.trigger("visibleMarkersUpdated",event)},Markers}(Backbone.Collection),inMapBounds=function(location,centroid){var markerDistanceFromCentroid;return markerDistanceFromCentroid=Modules.Browse.Helpers.LocationDistance.milesBetweenLocations({lat:location.lat,lng:location.lng},centroid),markerDistanceFromCentroid<Groupon.Maps.zoomDealRadius}}.call(this),void function(){var startSpinner,stopSpinner,updateDynamicMap,updateStaticMap;Modules.Map.Application={DYNAMIC_MAP_SELECTOR:"#dynamic-map",STATIC_MAP_SELECTOR:"#static-map",DYNAMIC_MAP_MAP_ERROR_SELECTOR:"#dynamic-map-section .map-error",listenTo:Backbone.Events.listenTo,stopListening:Backbone.Events.stopListening,dealsEvents:_.extend({},Backbone.Events),initializeDynamicMap:function(){return this.$dynamicMap=$(this.DYNAMIC_MAP_SELECTOR),this._loadGoogleMapsJS(Modules.Map.Helpers.MapBuilder.buildMapOptions({domain:window.location.host})),this.markersCollection=new Modules.Map.Collections.Markers,this._fetchMapData()},initializeStaticMap:function(){return this.staticMapView=new Modules.Map.Views.StaticMap({el:$(this.STATIC_MAP_SELECTOR),markers:this.markersCollection}),this.staticMapView.render()},onMapsScriptLoaded:function(){return this.mapsDataLoaded?(this.dynamicMapView=new Modules.Map.Views.DynamicMap({el:this.$dynamicMap,markersCollection:this.markersCollection}),this.dynamicMapView.on("maps:dynamicMapLoaded",function(this$){return function(){return this$.mapsContentLoaded=!0}}(this)),this.dynamicMapView.render(),stopSpinner()):void 0},onMapsDataLoaded:function(){return this.mapsDataLoaded=!0,(null!=window.google?window.google.maps:void 0)?this.dynamicMapView?(this.dynamicMapView.updateMapBounds(),stopSpinner()):this.onMapsScriptLoaded():void 0},onMapsDataFetchError:function(){return stopSpinner(),null!=this.dynamicMapView?this.dynamicMapView.hideMap():this.$dynamicMap.hide(),$(this.DYNAMIC_MAP_MAP_ERROR_SELECTOR).removeClass("hide")},maximizeMap:function(){return this.staticMapView.hideMap(),null!=this.dynamicMapView?(this._fetchMapData(),updateDynamicMap(this.dynamicMapView)):this.initializeDynamicMap(),Cookie.set("dynamicMapOpen","true",0)},minimizeMap:function(){return this._stopDynamicMapListeners(),this.dynamicMapView.hideMap(),Cookie.set("dynamicMapOpen","false",0),null!=this.staticMapView?updateStaticMap(this.staticMapView,this.markersCollection):this.initializeStaticMap()},_startDynamicMapListeners:function(){return this.listenTo(Modules.Map.Application.dealsEvents,"dealsChangedForMap",this._fetchMapData),this.listenTo(this.markersCollection,"maps:newPageBlock",this._fetchMapData)},_stopDynamicMapListeners:function(){return this.stopListening(Modules.Map.Application.dealsEvents,"dealsChangedForMap"),this.stopListening(this.markersCollection,"maps:newPageBlock")},_fetchMapData:function(){return this.mapsDataLoaded=!1,$(this.DYNAMIC_MAP_MAP_ERROR_SELECTOR).addClass("hide"),this.$dynamicMap.show(),startSpinner(),this.markersCollection.fetch({data:Modules.Deals.Helpers.SearchParams.getBaseParams(),success:function(this$){return function(){return this$.onMapsDataLoaded()}}(this),error:_.bind(this.onMapsDataFetchError,this),reset:!0}),this._startDynamicMapListeners()},_loadGoogleMapsJS:function(mapOptions){var googleMapsJS;return googleMapsJS=""+Groupon.Maps.mapproxy+"/maps/api/js?",googleMapsJS+=$.param(_.pick(mapOptions,"sensor","version","callback","channelQueryString")),$.getScript(googleMapsJS).fail(function(this$){return function(){return this$.onMapsDataFetchError()}}(this))}},updateStaticMap=function(staticMapView,markersCollection){return staticMapView.markers=markersCollection,staticMapView.render()},updateDynamicMap=function(dynamicMapView){return dynamicMapView.render()},startSpinner=function(){return Modules.Page.Helpers.SpinnerGroup.start("map",{el:"#dynamic-map-section",topMargin:"55px"})},stopSpinner=function(){return Modules.Page.Helpers.SpinnerGroup.stop("map")}}.call(this),Modules.Widgets.Views.Widget=function(super$){function Widget(){super$.apply(this,arguments)}return extends$(Widget,super$),Widget.prototype.initialize=function(){return this.hide(),this.listenTo(this.model,"change",this.render)},Widget.prototype.render=function(){return this.$el.html(this.model.get(this.options.widgetKey)),this.show(),WLS.init()},Widget.prototype.show=function(){return this.$el.show()},Widget.prototype.hide=function(){return this.$el.hide()},Widget}(Backbone.View),Modules.Widgets.Helpers.SearchParams={getBaseParams:function(options){return null==options&&(options={}),{dealIds:options.dealIds,division:Cookie.get("division")}}},Modules.Widgets.Models.WidgetHTML=function(super$){function WidgetHTML(){super$.apply(this,arguments)}return extends$(WidgetHTML,super$),WidgetHTML.prototype.url="/browse/widgets",WidgetHTML}(Backbone.Model),Modules.Widgets.Application={listenTo:Backbone.Events.listenTo,initializeWidgetLayoutService:function(){var showRecentlyViewed,showRelatedDeals;return showRelatedDeals=Modules.Shared.Helpers.Experiments.showRelatedDeals(),showRecentlyViewed=Modules.Shared.Helpers.Experiments.showRecentlyViewed(),showRelatedDeals||showRecentlyViewed?(this.widgetHTML=new Modules.Widgets.Models.WidgetHTML,showRelatedDeals&&(this.relatedDeals=new Modules.Widgets.Views.Widget({el:$("#pull-related-deals"),model:this.widgetHTML,widgetKey:"OtherDeals"})),showRecentlyViewed&&(this.recentlyViewed=new Modules.Widgets.Views.Widget({el:$("#pull-recently-viewed"),model:this.widgetHTML,widgetKey:"RightRail"})),this._fetchWidgetLayoutService(),this.listenTo(Modules.Deals.paginationEvents,"newPage",this._fetchWidgetLayoutService)):void 0},_fetchWidgetLayoutService:function(param$){var firstDeal;return null==param$&&(param$={}),firstDeal=param$.firstDeal,null!=this.widgetHTML?this.widgetHTML.fetch({data:Modules.Widgets.Helpers.SearchParams.getBaseParams({dealIds:null!=(null!=firstDeal?firstDeal.uuid:void 0)?null!=firstDeal?firstDeal.uuid:void 0:Groupon.Widgets.relatedDeals.firstDealUUID}),success:function(this$){return function(){return this$.onWidgetLayoutServiceDataLoaded()}}(this),error:function(this$){return function(){return this$.onWidgetLayoutServiceDataError()}}(this)}):void 0},onWidgetLayoutServiceDataLoaded:function(){return null!=this.relatedDeals&&this.relatedDeals.show(),null!=this.recentlyViewed?this.recentlyViewed.show():void 0},onWidgetLayoutServiceDataError:function(){return null!=this.relatedDeals&&this.relatedDeals.hide(),null!=this.recentlyViewed?this.recentlyViewed.hide():void 0}},Modules.Browse.Application=function(){function Application(param$){var cache$,instance$;instance$=this,this.constructV1=function(){return Application.prototype.constructV1.apply(instance$,arguments)},cache$=param$,this.isLeftBarVisible=cache$.isLeftBarVisible,this.isOnNoDealsPage=cache$.isOnNoDealsPage,Modules.Page.Helpers.SpinnerGroup.initialize(),this.assignURLBuilder()}var DYNAMIC_MAP_SELECTOR,fetchAndRenderDeals,initAppWithoutRefinementBar,initAppWithRefinementBar,initDealsLayoutToggle,initDealsSortToggle,initRefinementBar,isInitialCallNeeded,showDynamicMap,STATIC_MAP_SELECTOR;return DYNAMIC_MAP_SELECTOR="#dynamic-map",STATIC_MAP_SELECTOR="#static-map",Application.prototype.assignURLBuilder=function(){return this.constructUrl=this.constructV1},Application.prototype.startApp=function(){var fireDealsRequest;return fireDealsRequest=isInitialCallNeeded(this.isOnNoDealsPage),this.isLeftBarVisible?initAppWithRefinementBar(fireDealsRequest,this.constructUrl,this.initializeDynamicMap):initAppWithoutRefinementBar(fireDealsRequest,this.initializeDynamicMap),initDealsLayoutToggle(),initDealsSortToggle(),this.initializeStaticMap(),this.initializeWidgetLayoutService()},Application.prototype.initializeDynamicMap=function(){return showDynamicMap()?Modules.Map.Application.initializeDynamicMap():void 0},Application.prototype.initializeStaticMap=function(){return $(STATIC_MAP_SELECTOR).is(":visible")?Modules.Map.Application.initializeStaticMap():void 0},Application.prototype.initializeWidgetLayoutService=function(){return Modules.Widgets.Application.initializeWidgetLayoutService()},initAppWithRefinementBar=function(fireDealsRequest,constructionLibrary,initializeDynamicMap){return initRefinementBar(constructionLibrary,initializeDynamicMap),fireDealsRequest||new Modules.Browse.Views.Content({isContentRendered:!0}),Modules.RefinementBar.Application.events.on("filterChanged",function(){return fireDealsRequest?(fetchAndRenderDeals(),OptimizeSuite.treatAsNewPage(window.location.href)):fireDealsRequest=!0})},initAppWithoutRefinementBar=function(fireDealsRequest,initializeDynamicMap){var options;return options={},fireDealsRequest?options.paginatedDealsListViewBuilder=new Modules.Deals.Helpers.PaginatedDealsListViewBuilder:options.isContentRendered=!0,new Modules.Browse.Views.Content(options),initializeDynamicMap()},initRefinementBar=function(constructionLibrary,initializeDynamicMap){var pageReadyEventConfig;return Modules.RefinementBar.Application.initialize(constructionLibrary,pageReadyEventConfig={},function(){return new Modules.Browse.Views.ResultsHeading({el:$(".browse-title-heading")}),initializeDynamicMap()})},initDealsLayoutToggle=function(){return $(function(){return new Modules.Browse.Views.DealsLayoutToggle({el:$("#content")})})},initDealsSortToggle=function(){return $(function(){var $dealsSortToggleEl;return $dealsSortToggleEl=$(".deals-sort-selector"),$dealsSortToggleEl.length>0?new Modules.Browse.Views.DealsSortToggle({$el:$dealsSortToggleEl,onChange:fetchAndRenderDeals}):void 0})},isInitialCallNeeded=function(isOnNoDealsPage){return Groupon.gsmFirstVisit?!0:isOnNoDealsPage?!0:Groupon.onEmptyMerchandisedPage?!0:!1},fetchAndRenderDeals=function(){var paginatedBuilder;return paginatedBuilder=new Modules.Deals.Helpers.PaginatedDealsListViewBuilder({omitSearch:Modules.RefinementBar.Application.omitSearch}),new Modules.Browse.Views.Content({paginatedDealsListViewBuilder:paginatedBuilder}),Modules.Map.Application.dealsEvents.trigger("dealsChangedForMap"),paginatedBuilder.on("fetchSuccess",function(search){return Modules.RefinementBar.Application.countMerger.merge(search.page.facets),Modules.RefinementBar.Application.dealsEvents.trigger("dealsReplaced"),Modules.Deals.paginationEvents.trigger("newPage",search.page)})},Application.prototype.constructV1=function(enabledFacets,facetNames,extraQS){var appRoot;return appRoot=Groupon.urls.browse,prettyUrls.V1.construct({baseURL:appRoot,division:Groupon.parsedDivisionId,l2Categories:this.isCategoryPage()?[this.getSelectedCategory()]:void 0,l3Categories:enabledFacets[facetNames.CATEGORY_QUERY],l4Categories:enabledFacets[facetNames.SUBCATEGORY_QUERY],interests:enabledFacets[facetNames.INTEREST_QUERY],locations:enabledFacets[facetNames.LOCATION_QUERY],extraQS:extraQS})},Application.prototype.isCategoryPage=function(){var selectedCategoryId;return selectedCategoryId=this.getSelectedCategory(),!in$(selectedCategoryId,Groupon.Categories.staticCategories.ids)},Application.prototype.getSelectedCategory=function(){return Groupon.Categories.selectedCategory.id},showDynamicMap=function(){return 0===$(DYNAMIC_MAP_SELECTOR).length?!1:"false"===Cookie.get("dynamicMapOpen")?!1:Groupon.enabledFeatures.showMap&&"true"!==Cookie.get("dynamicMapOpen")?!1:!0},Application}(),void function(){var removeVirtualPrefix,VIRTUAL_CATEGORY_PREFIX_REGEX;VIRTUAL_CATEGORY_PREFIX_REGEX=/^(v[0-9]?-)/gi,removeVirtualPrefix=function(categoryId){return categoryId.replace(VIRTUAL_CATEGORY_PREFIX_REGEX,"")},null!=("undefined"!=typeof module&&null!=module?module.exports:void 0)?module.exports={removeVirtualPrefix:removeVirtualPrefix}:"undefined"!=typeof Modules&&null!=Modules&&(Modules.RefinementBar.Helpers.VirtualCategories={removeVirtualPrefix:removeVirtualPrefix})}.call(this),Modules.Local.Application=function(super$){function Application(){var instance$;instance$=this,this.constructV2=function(){return Application.prototype.constructV2.apply(instance$,arguments)},super$.apply(this,arguments)}var constructCategoryTaxonomy,constructTaxonomyNode,decideSelectedCategories,decideSelectedLocations,removeVirtualPrefix;return extends$(Application,super$),removeVirtualPrefix=Modules.RefinementBar.Helpers.VirtualCategories.removeVirtualPrefix,Application.prototype.assignURLBuilder=function(){return this.constructUrl=this.constructV2},Application.prototype.constructV2=function(enabledFacets,facetNames,extraQS){var appRoot,locationRoot,selectedCategories;return appRoot=Groupon.urls.local,locationRoot=Groupon.parsedMainLocationId,this.categoryTaxonomy=null!=this.categoryTaxonomy?this.categoryTaxonomy:constructCategoryTaxonomy(this.isCategoryPage()),selectedCategories=_.uniq(_.map(decideSelectedCategories(enabledFacets,facetNames,this.isCategoryPage()),function(categoryId){return removeVirtualPrefix(categoryId)})),prettyUrls.V2.construct(this.categoryTaxonomy,{mainLocation:locationRoot,selectedCategories:selectedCategories,selectedInterests:enabledFacets[facetNames.INTEREST_QUERY],secondaryLocations:decideSelectedLocations(enabledFacets,facetNames,locationRoot),baseURL:appRoot,extraQS:extraQS})},constructCategoryTaxonomy=function(isCategoryPage){var categoryTaxonomy,rootPath,selectedCategory,startingLevel;return categoryTaxonomy={},selectedCategory=Groupon.Categories.selectedCategory,isCategoryPage?(startingLevel=2,rootPath=[selectedCategory.id],categoryTaxonomy[selectedCategory.id]=constructTaxonomyNode(selectedCategory.id,startingLevel,rootPath),_.each(selectedCategory.children,function(selectedSubCategory){var taxonomyNode;return rootPath=[selectedCategory.id,selectedSubCategory.id],taxonomyNode=constructTaxonomyNode(selectedSubCategory.id,startingLevel+1,rootPath),categoryTaxonomy[taxonomyNode.id]=taxonomyNode,_.each(selectedSubCategory.children,function(childCategory){return rootPath=[selectedCategory.id,selectedSubCategory.id,childCategory.id],taxonomyNode=constructTaxonomyNode(childCategory.id,startingLevel+2,rootPath),categoryTaxonomy[taxonomyNode.id]=taxonomyNode})}),categoryTaxonomy):categoryTaxonomy},constructTaxonomyNode=function(id,level,rootPath){var nonVirtualCategoryId,nonVirtualRootPath;return nonVirtualCategoryId=removeVirtualPrefix(id),nonVirtualRootPath=rootPath,nonVirtualCategoryId!==id&&(nonVirtualRootPath=_.map(rootPath,function(categoryId){return removeVirtualPrefix(categoryId)})),{id:nonVirtualCategoryId,level:level,rootPath:nonVirtualRootPath}},decideSelectedCategories=function(enabledFacets,facetNames,isCategoryPage){return isCategoryPage?_.isEmpty(enabledFacets[facetNames.CATEGORY_QUERY])&&_.isEmpty(enabledFacets[facetNames.SUBCATEGORY_QUERY])?[Groupon.Categories.selectedCategory.id]:_.compact(_.union(enabledFacets[facetNames.CATEGORY_QUERY],enabledFacets[facetNames.SUBCATEGORY_QUERY])):[]},decideSelectedLocations=function(enabledFacets,facetNames,mainLocation){return _.without(enabledFacets[facetNames.LOCATION_QUERY],mainLocation)},Application}(Modules.Browse.Application),Modules.Page.Helpers.Tracking=function(){function Tracking(){this.recordedFirstPage=!1}return Tracking.prototype.pageReady=function(){return!this.recordedFirstPage&&Groupon.Performance?(Groupon.Performance.pageReady(),this.recordedFirstPage=!0):void 0},Tracking}(),void function(){for(var el,selector,cache$=["personalize_wizard","personalize_wizard_call_to_action"],i$=0,length$=cache$.length;length$>i$;++i$)selector=cache$[i$],(el=document.getElementById(selector))&&document.body.insertBefore(el,document.body.firstChild);$(function(){return $("#personalize_wizard_call_to_action").show()})}.call(this),null!=window.Groupon?window.Groupon:window.Groupon={},null!=Groupon.Modules?Groupon.Modules:Groupon.Modules={},null!=Groupon.Modules.PersonalizeWizard?Groupon.Modules.PersonalizeWizard:Groupon.Modules.PersonalizeWizard={},null!=Groupon.Modules.PersonalizeWizard.Models?Groupon.Modules.PersonalizeWizard.Models:Groupon.Modules.PersonalizeWizard.Models={},null!=Groupon.Modules.PersonalizeWizard.Views?Groupon.Modules.PersonalizeWizard.Views:Groupon.Modules.PersonalizeWizard.Views={},Groupon.Modules.PersonalizeWizard.Models.BaseStep=function(super$){function BaseStep(){var instance$;instance$=this,this.handleErrorResponse=function(){return BaseStep.prototype.handleErrorResponse.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(BaseStep,super$),BaseStep.prototype.initialize=function(){return this.TRANSLATION_KEY_BASE="js.modules.personalize_wizard."+this.get("name")+"_step"},BaseStep.prototype.validate=function(){},BaseStep.prototype.isValid=function(){return!this.validate(this.attributes)},BaseStep.prototype.handleErrorResponse=function(model,response){var errors;return errors=this._parseErrorResponse(response),this.trigger("error",errors)},BaseStep.prototype.handleNotDone=function(){return this.trigger("error",[this._notDoneYetText()])},BaseStep.prototype._parseErrorResponse=function(response){var message,parsed,responseText;return!response||_.isArray(response)?response:(responseText=response.responseText,responseText?"<"===_.first(responseText)?[$(response.responseText).text()]:"{"===_.first(responseText)?(parsed=$.parseJSON(responseText),(message=null!=parsed&&null!=parsed.error?parsed.error.message:void 0)?[message]:[parsed]):[responseText]:null)},BaseStep.prototype._notDoneYetText=function(){return I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.not_done_yet")},BaseStep}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.Consumer=function(super$){function Consumer(){super$.apply(this,arguments)}return extends$(Consumer,super$),Consumer.prototype.urlRoot="/__apiproxy__/v2/consumers",Consumer.prototype.url=function(){var superUrl;return superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"?client_id="+this.options.clientId},Consumer.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Consumer}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.GenderStep=function(super$){function GenderStep(){super$.apply(this,arguments)}return extends$(GenderStep,super$),GenderStep.prototype.defaults={name:"gender",viewName:"GenderStep"},GenderStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Models.BaseStep,superClass.prototype.initialize.apply(this,arguments),this._setupConsumer()},GenderStep.prototype._setupConsumer=function(){var attributes;return attributes={id:this.get("consumerId"),_csrf:this.get("_csrf")},this.set({consumer:new Groupon.Modules.PersonalizeWizard.Models.Consumer(attributes,{clientId:this.get("clientId")})},{silent:!0})},GenderStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Models.Place=function(super$){function Place(){super$.apply(this,arguments)}var DEFAULT_LOCATION_TYPE;return extends$(Place,super$),Place.prototype.TRANSLATION_KEY_BASE="js.modules.personalize_wizard.place",DEFAULT_LOCATION_TYPE="home",Place.prototype.defaults={name:DEFAULT_LOCATION_TYPE},Place.prototype.urlRoot="/__apiproxy__/v2/consumers",Place.prototype.url=function(){var clientId,consumerId,superUrl;return consumerId=this.get("consumerId"),clientId=this.options.clientId,superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"/"+consumerId+"/places?client_id="+clientId},Place.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Place.prototype.isNew=function(){return!0},Place.prototype.validate=function(attributes){return _.keys(attributes).length>0&&!((null!=attributes.location_string?attributes.location_string.length:void 0)>0)?[I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.required")]:void 0},Place}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.PlacesStep=function(super$){function PlacesStep(){super$.apply(this,arguments)}return extends$(PlacesStep,super$),PlacesStep.prototype.defaults={name:"places",viewName:"PlacesStep"},PlacesStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Models.BaseStep,superClass.prototype.initialize.apply(this,arguments),this._setupPlace(),this.get("place").bind("invalid",this.handleErrorResponse,this)},PlacesStep.prototype.validate=function(attributes){var place;return place=attributes.place,null==place?[I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.required")]:place.validate(place.attributes)},PlacesStep.prototype._setupPlace=function(){var attributes;return attributes={consumerId:this.get("consumerId"),_csrf:this.get("_csrf")},this.set({place:new Groupon.Modules.PersonalizeWizard.Models.Place(attributes,{clientId:this.get("clientId")})},{silent:!0})},PlacesStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Models.InterestsStep=function(super$){function InterestsStep(){super$.apply(this,arguments)}return extends$(InterestsStep,super$),InterestsStep.prototype.defaults={name:"interests",viewName:"InterestsStep"},InterestsStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Views.BaseStep=function(super$){function BaseStep(){super$.apply(this,arguments)}return extends$(BaseStep,super$),BaseStep.prototype.tagName="section",BaseStep.prototype.className="personalize_step",BaseStep.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this.wizardModel=this.options.wizardModel},BaseStep.prototype.render=function(){return this.$el.show()},BaseStep.prototype.hide=function(){return this.$el.hide()},BaseStep.prototype.nextStep=function(){return this.wizardModel.incrementStep()},BaseStep}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.GenderStep=function(super$){function GenderStep(){var instance$;instance$=this,this._handleError=function(){return GenderStep.prototype._handleError.apply(instance$,arguments)},this._handleSuccess=function(){return GenderStep.prototype._handleSuccess.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(GenderStep,super$),GenderStep.prototype.el="#gender_step",GenderStep.prototype.events={"click .male":"_setMaleGenderPreference","click .female":"_setFemaleGenderPreference"},GenderStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),this.consumer=this.model.get("consumer")},GenderStep.prototype._setMaleGenderPreference=function(){return this._saveGender("male"),this.$(".male").addClass("active"),this.$(".female").removeClass("active")},GenderStep.prototype._setFemaleGenderPreference=function(){return this._saveGender("female"),this.$(".female").addClass("active"),this.$(".male").removeClass("active")},GenderStep.prototype._saveGender=function(gender){return this.consumer.save({deal_preference_gender:gender},{success:this._handleSuccess,error:this._handleError})},GenderStep.prototype._handleSuccess=function(){return this.nextStep()},GenderStep.prototype._handleError=function(){},GenderStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep),Groupon.Modules.PersonalizeWizard.Views.PlacesStep=function(super$){function PlacesStep(){var instance$;instance$=this,this._saveError=function(){return PlacesStep.prototype._saveError.apply(instance$,arguments)},this._saveSuccess=function(){return PlacesStep.prototype._saveSuccess.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(PlacesStep,super$),PlacesStep.prototype.el="#places_step",PlacesStep.prototype.partials={errorList:'<ul class="errors">\n  {{#errors}}\n  <li>{{message}}</li>\n  {{/errors}}\n</ul>'},PlacesStep.prototype.events={"click .next_step":"_continueClick",'keypress input[name="location_string"]':"_continueOnEnter"},PlacesStep.prototype.loadingClass="loading",PlacesStep.prototype.doubleClickPreventerClass="prevent_double_click",PlacesStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),this.model.bind("error",this._renderErrors,this)},PlacesStep.prototype._continueOnEnter=function(e){return 13===(e.which||e.keyCode)?(e.preventDefault(),this.$(".next_step").click()):void 0},PlacesStep.prototype._continueClick=function(){return this._submitEnabled()?(this._disableSubmit(),this._savePlace()):!1},PlacesStep.prototype._savePlace=function(){var input,trimmedVal;return this.$(".place_input").addClass(this.loadingClass),input=this.$(".place_input input[name=location_string]"),this._clearInputPlaceholder(input),trimmedVal=$.trim(input.val()),this.model.get("place").save({location_string:trimmedVal},{success:this._saveSuccess,error:this._saveError,dataType:"text"})},PlacesStep.prototype._saveSuccess=function(){return this.$(".place_input").removeClass(this.loadingClass),this._enableSubmit(),this.nextStep()},PlacesStep.prototype._saveError=function(model,response){return this.model.handleErrorResponse(model,response)},PlacesStep.prototype._renderErrors=function(errors){var errorAttributes,template;return this.$(".place_input").removeClass(this.loadingClass),this._enableSubmit(),errorAttributes=_(errors).map(function(e){return{message:e}}),template=Hogan.compile(this.partials.errorList),this.$(".errors").replaceWith(template.render({errors:errorAttributes}))},PlacesStep.prototype._clearInputPlaceholder=function(input){return input.val()===input.attr("placeholder")?(input.val(""),input.removeClass("prompting")):void 0},PlacesStep.prototype._disableSubmit=function(){return this.$(".next_step").addClass(this.doubleClickPreventerClass)},PlacesStep.prototype._enableSubmit=function(){return this.$(".next_step").removeClass(this.doubleClickPreventerClass)},PlacesStep.prototype._submitEnabled=function(){return this.$(".next_step").hasClass(this.doubleClickPreventerClass)?void 0:!0},PlacesStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep),null!=this.Groupon?this.Groupon:this.Groupon={},null!=this.Groupon.Modules?this.Groupon.Modules:this.Groupon.Modules={},null!=this.Groupon.Modules.P13n?this.Groupon.Modules.P13n:this.Groupon.Modules.P13n={},this.Groupon.Modules.P13n.InterestPreferences={updatePreferenceCookie:function(id,value){var cookie,cookieJson,ONE_HOUR_IN_SECONDS,PREFERENCE_COOKIE,updatedPreferences;return ONE_HOUR_IN_SECONDS=3600,PREFERENCE_COOKIE="myprofile_interest_preferences","neutral"===value&&(value="negative"),cookie=Cookie.get(PREFERENCE_COOKIE),cookieJson=JSON.parse(decodeURIComponent(null!=cookie?cookie:"[]")),updatedPreferences=_(cookieJson).reject(function(pref){return pref.id===id}),updatedPreferences.push({id:id,value:value}),Cookie.set(PREFERENCE_COOKIE,encodeURIComponent(JSON.stringify(updatedPreferences)),ONE_HOUR_IN_SECONDS)}},Groupon.Modules.PersonalizeWizard.Models.Interest=function(super$){function Interest(){var instance$;instance$=this,this.toJSON=function(){return Interest.prototype.toJSON.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Interest,super$),Interest.prototype.defaults={value:"neutral"},Interest.prototype.urlRoot="/__apiproxy__/v2/consumers",Interest.prototype.url=function(){var clientId,consumerId,superUrl;return consumerId=this.options.consumerId,clientId=this.options.clientId,superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"/"+consumerId+"/feedback?client_id="+clientId},Interest.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Interest.prototype.toggleValue=function(){switch(this.get("value")){case"positive":return this.set({value:"neutral"});case"neutral":return this.set({value:"positive"})}},Interest.prototype.toJSON=function(){return{deal_types:[{id:this.id,value:this.get("value")}],_csrf:this.get("_csrf")}},Interest.prototype.isNew=function(){return!0},Interest.prototype.savePreferenceCookie=function(){return Groupon.Modules.P13n.InterestPreferences.updatePreferenceCookie(this.get("id"),this.get("value"))},Interest}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Views.Interest=function(super$){function Interest(){var instance$;instance$=this,this._updateSelectedClass=function(){return Interest.prototype._updateSelectedClass.apply(instance$,arguments)
},this._toggleInterest=function(){return Interest.prototype._toggleInterest.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Interest,super$),Interest.prototype.events={click:"_toggleInterest"},Interest.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this._setupInterest(),this.model.on("change",this._updateSelectedClass)},Interest.prototype._toggleInterest=function(){return this.model.toggleValue(),this.model.save(),this.model.savePreferenceCookie()},Interest.prototype._setupInterest=function(){var attributes,options;return attributes={id:this.$el.data("modelId"),value:this.$el.hasClass("selected")?"positive":"neutral",_csrf:this.options._csrf},options=_(this.options).pick("consumerId","clientId"),this.model=new Groupon.Modules.PersonalizeWizard.Models.Interest(attributes,options)},Interest.prototype._updateSelectedClass=function(){switch(this.model.get("value")){case"neutral":return this.$el.removeClass("selected");case"positive":return this.$el.addClass("selected")}},Interest}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.InterestsStep=function(super$){function InterestsStep(){var instance$;instance$=this,this._continueClick=function(){return InterestsStep.prototype._continueClick.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(InterestsStep,super$),InterestsStep.prototype.el="#interests_step",InterestsStep.prototype.events={"click .next_step":"_continueClick"},InterestsStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),function(accum$){for(var interestEl,cache$=this.$(".p13n-interest"),i$=0,length$=cache$.length;length$>i$;++i$)interestEl=cache$[i$],accum$.push(new Groupon.Modules.PersonalizeWizard.Views.Interest({el:interestEl,consumerId:this.model.get("consumerId"),clientId:this.model.get("clientId"),_csrf:this.model.get("_csrf")}));return accum$}.call(this,[])},InterestsStep.prototype._continueClick=function(){return this.nextStep()},InterestsStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep),Groupon.Modules.PersonalizeWizard.Models.Modal=function(super$){function Modal(){super$.apply(this,arguments)}return extends$(Modal,super$),Modal.prototype.defaults={index:0},Modal.prototype.initialize=function(){return this.set({steps:this._setUpSteps()})},Modal.prototype.incrementStep=function(){return this.set({index:this.get("index")+1})},Modal.prototype.getPreviousStep=function(){return this._getStepAtIndex(this.get("index")-1)},Modal.prototype.getCurrentStep=function(){return this._getStepAtIndex(this.get("index"))},Modal.prototype.resetIndex=function(){return this.set({index:0},{silent:!0})},Modal.prototype._getStepAtIndex=function(index){return this.get("steps")[index]},Modal.prototype._stepModels=function(){var options;return options={_csrf:this.get("csrfToken"),clientId:this.get("clientId"),consumerId:this.get("consumerId")},[new Groupon.Modules.PersonalizeWizard.Models.GenderStep(options),new Groupon.Modules.PersonalizeWizard.Models.PlacesStep(options),new Groupon.Modules.PersonalizeWizard.Models.InterestsStep(options)]},Modal.prototype._setUpSteps=function(){return _.map(this._stepModels(),function(this$){return function(model){return new(Groupon.Modules.PersonalizeWizard.Views[model.get("viewName")])({model:model,id:model.get("name")+"_step",wizardModel:this$})}}(this))},Modal}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Views.Modal=function(super$){function Modal(){var instance$;instance$=this,this._getValueFromDOM=function(){return Modal.prototype._getValueFromDOM.apply(instance$,arguments)},this._calculateHorizontalClippingPoint=function(){return Modal.prototype._calculateHorizontalClippingPoint.apply(instance$,arguments)},this._clip=function(){return Modal.prototype._clip.apply(instance$,arguments)},this._updateProgress=function(){return Modal.prototype._updateProgress.apply(instance$,arguments)},this._resize=function(){return Modal.prototype._resize.apply(instance$,arguments)},this._marginBeneathModal=function(){return Modal.prototype._marginBeneathModal.apply(instance$,arguments)},this._close=function(){return Modal.prototype._close.apply(instance$,arguments)},this._open=function(){return Modal.prototype._open.apply(instance$,arguments)},this.finish=function(){return Modal.prototype.finish.apply(instance$,arguments)},this.onIndexChange=function(){return Modal.prototype.onIndexChange.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Modal,super$),Modal.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this.$modal=this.$(".modal-content"),this.model.bind("change:index",this.onIndexChange)},Modal.prototype.show=function(){return this._open(),this._updateProgress(),this.model.getCurrentStep().render(),this._resize(),this._shouldSkipStep(this.model.get("index"))?this._skipStep():void 0},Modal.prototype.onIndexChange=function(model,index){return this._hidePreviousStep(),this._isFinished()?this.finish():this._shouldSkipStep(index)?this._skipStep():this._showStep()},Modal.prototype.finish=function(){return this.model.resetIndex(),this._close()},Modal.prototype._hidePreviousStep=function(){return this.model.getPreviousStep().hide()},Modal.prototype._isFinished=function(){return!this.model.getCurrentStep()},Modal.prototype._shouldSkipStep=function(index){return this._onLocationStep(index)&&this._hasProvidedLocation()?!0:this._onGenderStep(index)&&this._hasProvidedDealPreferenceGender()?!0:!1},Modal.prototype._skipStep=function(){return this.model.incrementStep()},Modal.prototype._showStep=function(){return this.model.getCurrentStep().render(),this._resize(),this._updateProgress()},Modal.prototype._open=function(){return GIG.Modal.open({el:this.$el})},Modal.prototype._close=function(){return GIG.Modal.close()},Modal.prototype._marginBeneathModal=function(){var modalHeight,topMargin;return topMargin=parseInt(this.$modal.css("top"),10),modalHeight=this.$modal.outerHeight(),$(window).height()-modalHeight-topMargin},Modal.prototype._resize=function(){var $scrollable,currentMargin,minimumMargin,newHeight;return $scrollable=this.$(".scrollable:visible"),minimumMargin=50,currentMargin=this._marginBeneathModal(),currentMargin>minimumMargin?$scrollable.height("auto"):(newHeight=$scrollable.height()-(minimumMargin-currentMargin),$scrollable.height(newHeight))},Modal.prototype._updateProgress=function(){return this._clip(this.model.get("index")),this.$("#progress_indicator .step").each(function(this$){return function(index,step){var currentIndex;return currentIndex=this$.model.get("index"),this$._shouldSkipStep(index)?$(step).addClass("completed_step"):currentIndex>index?$(step).addClass("viewed completed_step"):index===currentIndex?$(step).addClass("viewed"):$(step).removeClass("viewed completed_step")}}(this))},Modal.prototype._clip=function(stepIndex){var $progressBar,clipOptions;return $progressBar=this.$("#progress_indicator .complete"),clipOptions="rect(0px "+this._calculateHorizontalClippingPoint(stepIndex)+"px 40px 0px)",$progressBar.css({clip:clipOptions})},Modal.prototype._calculateHorizontalClippingPoint=function(stepIndex){var $step,$stepNumber;return $stepNumber=this.$("#progress_indicator .complete .step_number"),$step=this.$("#progress_indicator .stepped_progress_bar .step"),$stepNumber.width()+$step.width()*stepIndex},Modal.prototype._onGenderStep=function(stepIndex){return 0===stepIndex},Modal.prototype._onLocationStep=function(stepIndex){return 1===stepIndex},Modal.prototype._hasProvidedDealPreferenceGender=function(){return"true"===this._getValueFromDOM("input[name='has_provided_deal_preference_gender']")},Modal.prototype._hasProvidedLocation=function(){return"true"===this._getValueFromDOM("input[name='has_provided_location']")},Modal.prototype._getValueFromDOM=function(selector){return this.$(selector).val()},Modal}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.CallToAction=function(super$){function CallToAction(){var instance$;instance$=this,this._getValueFromDOM=function(){return CallToAction.prototype._getValueFromDOM.apply(instance$,arguments)},this._csrf=function(){return CallToAction.prototype._csrf.apply(instance$,arguments)},this._clientId=function(){return CallToAction.prototype._clientId.apply(instance$,arguments)},this._consumerId=function(){return CallToAction.prototype._consumerId.apply(instance$,arguments)},this._wizard=function(){return CallToAction.prototype._wizard.apply(instance$,arguments)},super$.apply(this,arguments)}var _WIZARD_SELECTOR,NINETY_DAYS;return extends$(CallToAction,super$),NINETY_DAYS=7776e3,CallToAction.prototype.events={"click .close":"_close","click .open_wizard":"_openWizard"},CallToAction.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this._showPersonalizeWizardOnLoad()?this._openWizard():void 0},_WIZARD_SELECTOR="#personalize_wizard",CallToAction.prototype._close=function(e){return e.preventDefault(),this.$el.slideUp("fast"),Cookie.set("personalize_wizard_cta_dismissed",!0,NINETY_DAYS)},CallToAction.prototype._openWizard=function(e){return this._canShowWizard()?(null!=e&&e.preventDefault(),this._wizard().show()):void 0},CallToAction.prototype._wizard=function(){var clientId,consumerId,csrfToken;return clientId=this._clientId(),consumerId=this._consumerId(),csrfToken=this._csrf(),null!=this.wizard?this.wizard:this.wizard=new Groupon.Modules.PersonalizeWizard.Views.Modal({el:_WIZARD_SELECTOR,model:new Groupon.Modules.PersonalizeWizard.Models.Modal({clientId:clientId,consumerId:consumerId,csrfToken:csrfToken})})},CallToAction.prototype._canShowWizard=function(){return $(_WIZARD_SELECTOR).length>0},CallToAction.prototype._showPersonalizeWizardOnLoad=function(){return"true"===this._getValueFromDOM("input[name='auto_pop_wizard']")},CallToAction.prototype._consumerId=function(){return this._getValueFromDOM("input[name='consumer_id']")},CallToAction.prototype._clientId=function(){return this._getValueFromDOM("input[name='client_id']")},CallToAction.prototype._csrf=function(){return this._getValueFromDOM("input[name='_csrf']")},CallToAction.prototype._getValueFromDOM=function(selector){return this.$(selector).val()},CallToAction}(Backbone.View),$(function(){return new Groupon.Modules.PersonalizeWizard.Views.CallToAction({el:"#personalize_wizard_call_to_action"})}),Groupon.ui=Groupon.ui||{},Groupon.ui.GSMEditorialWidget={selector:{expandable:".has-expando",gradient:".gradient",mainColumn:".article-main",pullQuote:".pull-quote",relatedArticles:".related-articles-list",relatedContent:".related-content",sidebar:".article-sidebar",toggle:".toggler",widget:".editorial-widget"},closedSidebarHeight:180,expandableElements:null,gradientElement:null,pullQuoteElement:null,relatedContentElement:null,sidebarElement:null,toggleElements:null,relatedArticlesHeight:null,closedHeightFix:8,closedPx:32,initExpandables:function(options){return null!=(null!=options?options.closedHeightFix:void 0)&&(this.closedHeightFix=options.closedHeightFix),null!=(null!=options?options.closedPx:void 0)&&(this.closedPx=options.closedPx),this.expandableElements=$(this.selector.mainColumn).find(this.selector.expandable),this.expandableElements.length&&this.expandableElements.each(function(){var articleInfo,articleTitle,el,readMoreLink,textElmt;return el=$(this),textElmt=el.find(".body-text"),articleInfo=el.parent(".article-info").find("a"),readMoreLink=articleInfo.attr("href"),articleTitle=articleInfo.html(),el.data("fullContent",textElmt.clone()),el.dotdotdot({callback:function(){return el.hasClass("go-to-article-page")?el.append("<span class='toggler'><a href='"+readMoreLink+"' title='"+articleTitle+"'>"+I18n.t("js.modules.seo-platform-editorial.readMore")+"</a></span>"):el.append("<span class='toggler'>"+I18n.t("js.modules.seo-platform-editorial.readMore")+"</span>")}}),el.data("closedHeight",el.height()-this.closedHeightFix),el.find("span.toggler").data("toggleState","closed")}),this.makeExpandable()},makeExpandable:function(){return this.toggleElements=$(this.selector.mainColumn).find(this.selector.toggle),this.toggleElements.length?this.toggleElements.on("click",this.toggleClickHandler):void 0},toggleClickHandler:function(event){var el,expando,toggle;return el=$(event.target),expando=el.closest(".has-expando"),expando.hasClass("go-to-article-page")?void 0:"closed"===el.data("toggleState")?(el.data("toggleState","open"),toggle=el.clone(!0),expando.data("truncatedContent",expando.children().clone(!0)),toggle.text(""+I18n.t("js.modules.seo-platform-editorial.readLess")),expando.empty().append(expando.data("fullContent"),toggle),expando.css({height:"auto","max-height":""}),$("#inner-wrap").removeClass("lbl").removeClass("collapsedArticleMargin").addClass("expandedArticleMargin")):(el.data("toggleState","closed"),toggle=el.clone(!0).text(""+I18n.t("js.modules.seo-platform-editorial.readMore")),expando.empty().append(expando.data("truncatedContent")),toggle.replaceAll(expando.find("span.toggler")),expando.css({height:expando.data("closedHeight")+this.closedPx+"px","max-height":expando.data("closedHeight")+this.closedPx+"px"}),$("#inner-wrap").removeClass("expandedArticleMargin").addClass("collapsedArticleMargin"))},initSidebar:function(){return this.sidebarElement=$(this.selector.widget).find(this.selector.sidebar),this.relatedContentElement=this.sidebarElement.find(this.selector.relatedContent),this.pullQuoteElement=this.sidebarElement.find(this.selector.pullQuote),this.gradientElement=this.sidebarElement.find(this.selector.gradient),this.relatedArticlesHeight=this.sidebarElement.find(this.selector.relatedArticles).height(),this.makeHoverable(this)},makeHoverable:function(that){return!this.pullQuoteElement.length&&this.closedSidebarHeight<this.relatedArticlesHeight?(this.gradientElement.show(),this.relatedContentElement.hover(function(){return $(this).css({height:"auto","max-height":""}).addClass("box-shadow"),that.gradientElement.hide()},function(){return $(this).css({height:that.closedSidebarHeight+"px","max-height":that.closedSidebarHeight+"px"}).removeClass("box-shadow"),that.gradientElement.show()})):void 0},initWidget:function(options){return $(this.selector.widget).show(),this.initExpandables(options),this.initSidebar()}},void function(){var findScrollTop;Modules.Browse.Views.BackToTop={render:function(){return $(window).on("scroll",function(){var scrollTop;return scrollTop=findScrollTop(),scrollTop>100?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()}),$("#back-to-top").on("click",function(){return $("body,html").animate({scrollTop:0},500)})}},findScrollTop=function(){return $(window).scrollTop()>0?$(window).scrollTop():document.documentElement.scrollTop>0?document.documentElement.scrollTop:0}}.call(this),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){window.prettyUrls={V2:{construct:require("./v2/construct")},V1:{construct:require("./v1/construct")}}},{"./v1/construct":3,"./v2/construct":4}],2:[function(require,module,exports){var each,keys,omit,_ref;_ref="undefined"!=typeof _&&null!==_?_:require("underscore"),keys=_ref.keys,each=_ref.each,omit=_ref.omit,exports.UrlString=function(){function _Class(baseURL){this.url="",null!=baseURL&&this.append(baseURL)}return _Class.prototype.RESERVED_PARAMS=["category","category2","category3","interest","location","topcategory"],_Class.prototype.appendPath=function(pathValue){return this.url+="/"+pathValue},_Class.prototype.appendQuery=function(hash){return this.url+="?"+this.stringifyQS(hash)},_Class.prototype.append=function(newValue){return this.url+=newValue},_Class.prototype.removeReservedQS=function(QS){return omit(QS,this.RESERVED_PARAMS)},_Class.prototype.getUrl=function(){return this.url},_Class.prototype.stringifyQS=function(hash){var encodedValue,hashKey,stingifiedQS,_i,_len,_ref1,_ref2;for(stingifiedQS="",_ref2=null!=(_ref1=keys(hash))?_ref1:[],_i=0,_len=_ref2.length;_len>_i;_i++)hashKey=_ref2[_i],stingifiedQS.length>0&&(stingifiedQS+="&"),encodedValue=encodeURIComponent(hash[hashKey]),stingifiedQS+=""+hashKey+"="+encodedValue;return stingifiedQS},_Class}()},{}],3:[function(require,module){var UrlString,compact,each,extend,isEmpty,joinParam,omitUndefined,_ref;_ref="undefined"!=typeof _&&null!==_?_:require("underscore"),isEmpty=_ref.isEmpty,each=_ref.each,extend=_ref.extend,compact=_ref.compact,UrlString=require("../url").UrlString,module.exports=function(_arg){var baseURL,clonedQS,division,extraQS,interests,l2Categories,l3Categories,l4Categories,locations,topcategory,urlInstance;return topcategory=_arg.topcategory,l2Categories=_arg.l2Categories,l3Categories=_arg.l3Categories,l4Categories=_arg.l4Categories,interests=_arg.interests,locations=_arg.locations,division=_arg.division,extraQS=_arg.extraQS,baseURL=_arg.baseURL,urlInstance=new UrlString(baseURL),null!=division&&urlInstance.appendPath(division),clonedQS=extend({},urlInstance.removeReservedQS(extraQS),omitUndefined({category:joinParam(l2Categories),category2:joinParam(l3Categories),category3:joinParam(l4Categories),interest:joinParam(interests),location:joinParam(locations),topcategory:topcategory})),isEmpty(clonedQS)||urlInstance.appendQuery(clonedQS),urlInstance.getUrl()},joinParam=function(array){var compactedArray;return compactedArray=compact(array),isEmpty(compactedArray)?void 0:compactedArray.sort().join(",")},omitUndefined=function(hash){var filteredObj,key,value;filteredObj={};for(key in hash)value=hash[key],null!=value&&(filteredObj[key]=value);return filteredObj}},{"../url":2}],4:[function(require,module){var UrlString,addLeadingCategoryToUrl,aggregateRootPaths,clone,constructInterestsLocations,constructQueryCategories,contains,defaults,each,filterMissingAndDuplicateCategories,groupBy,intersection,isEmpty,keys,last,parseCategories,removeVirtualPrefix,without,_ref,_ref1;_ref="undefined"!=typeof _&&null!==_?_:require("underscore"),each=_ref.each,clone=_ref.clone,groupBy=_ref.groupBy,intersection=_ref.intersection,contains=_ref.contains,without=_ref.without,isEmpty=_ref.isEmpty,defaults=_ref.defaults,last=_ref.last,keys=_ref.keys,UrlString=require("../url").UrlString,_ref1=require("./helpers"),aggregateRootPaths=_ref1.aggregateRootPaths,removeVirtualPrefix=_ref1.removeVirtualPrefix,module.exports=function(flatCategories,_arg){var baseURL,clonedQS,extraQS,hypenThreshold,leadingCategory,leveledCategories,mainLocation,rewriteVirtualCategoryUrls,secondaryLocations,selectedCategories,selectedInterests,urlInstance,_ref2;return mainLocation=_arg.mainLocation,secondaryLocations=_arg.secondaryLocations,selectedCategories=_arg.selectedCategories,selectedInterests=_arg.selectedInterests,baseURL=_arg.baseURL,extraQS=_arg.extraQS,rewriteVirtualCategoryUrls=_arg.rewriteVirtualCategoryUrls,urlInstance=new UrlString(baseURL),clonedQS=clone(null!=extraQS?extraQS:{}),clonedQS=urlInstance.removeReservedQS(clonedQS),selectedCategories=filterMissingAndDuplicateCategories(flatCategories,selectedCategories),_ref2=parseCategories(flatCategories,selectedCategories),leadingCategory=_ref2.leadingCategory,leveledCategories=_ref2.leveledCategories,null!=mainLocation&&urlInstance.appendPath(mainLocation),constructInterestsLocations("location",urlInstance,secondaryLocations,clonedQS,hypenThreshold=void 0),null!=leadingCategory&&addLeadingCategoryToUrl(leadingCategory,rewriteVirtualCategoryUrls,urlInstance),constructQueryCategories("category",leveledCategories["2"],leadingCategory,clonedQS),constructQueryCategories("category2",leveledCategories["3"],leadingCategory,clonedQS),constructQueryCategories("category3",leveledCategories["4"],leadingCategory,clonedQS),constructInterestsLocations("interest",urlInstance,selectedInterests,clonedQS,hypenThreshold=2),isEmpty(clonedQS)||urlInstance.appendQuery(clonedQS),urlInstance.getUrl()},addLeadingCategoryToUrl=function(leadingCategory,rewriteVirtualCategoryUrls,urlInstance){var categoryPermalink;return categoryPermalink=leadingCategory,rewriteVirtualCategoryUrls&&(categoryPermalink=removeVirtualPrefix(leadingCategory)),urlInstance.appendPath(categoryPermalink)},constructQueryCategories=function(queryParam,selectedCategories,leadingCategory,clonedQS){var strippedLeading;return strippedLeading=without(selectedCategories,leadingCategory).sort(function(a,b){return a>=b}),(null!=strippedLeading?strippedLeading.length:void 0)>0?clonedQS[queryParam]=strippedLeading.join(","):void 0},constructInterestsLocations=function(queryParam,urlInstance,selectedItems,clonedQS,hypenThreshold){return null==selectedItems||isEmpty(selectedItems)?void 0:1===selectedItems.length?urlInstance.appendPath(selectedItems[0]):null!=hypenThreshold&&selectedItems.length<=hypenThreshold?urlInstance.appendPath(selectedItems.sort(function(a,b){return a>=b}).join("--")):clonedQS[queryParam]=selectedItems.sort(function(a,b){return a>=b}).join(",")},parseCategories=function(flatCategories,selectedCategories){var groupedCategories,leadingCategory,leadingRoot;return leadingCategory=void 0,leadingRoot=!1,groupedCategories=groupBy(selectedCategories,function(selectedCategory){var _ref2;return null!=(_ref2=flatCategories[selectedCategory])?_ref2.level:void 0}),defaults(groupedCategories,{2:[],3:[],4:[]}),each(selectedCategories,function(selectedCategory){var categoryInfo,intersectedPaths,possibleLeadingCategory;if(categoryInfo=flatCategories[selectedCategory],null!=categoryInfo&&!leadingRoot){if(null==leadingCategory)return leadingCategory=categoryInfo,void 0;if(intersectedPaths=intersection(leadingCategory.rootPath,categoryInfo.rootPath),intersectedPaths.length>0){if(possibleLeadingCategory=flatCategories[last(intersectedPaths)],1===possibleLeadingCategory.level)return;return leadingCategory=possibleLeadingCategory}return contains(categoryInfo.rootPath,leadingCategory.id)?void 0:(leadingRoot=!0,leadingCategory=void 0)}}),{leadingCategory:null!=leadingCategory?leadingCategory.id:void 0,leveledCategories:groupedCategories}},filterMissingAndDuplicateCategories=function(flatCategories,selectedCategories){var filteredCategories,rootPaths;return filteredCategories={},rootPaths=aggregateRootPaths(flatCategories,selectedCategories),each(selectedCategories,function(selectedCategory){return null!=flatCategories[selectedCategory]&&null==rootPaths[selectedCategory]&&null==filteredCategories[selectedCategory]?filteredCategories[selectedCategory]=selectedCategory:void 0}),keys(filteredCategories)}},{"../url":2,"./helpers":5}],5:[function(require,module){var VIRTUAL_CATEGORY_PREFIX_REGEX,each,extend,indexArray,initial,object,_ref;_ref="undefined"!=typeof _&&null!==_?_:require("underscore"),each=_ref.each,initial=_ref.initial,extend=_ref.extend,object=_ref.object,VIRTUAL_CATEGORY_PREFIX_REGEX=/^(v[0-9]?-)/gi,module.exports={aggregateRootPaths:function(flatCategories,selectedCategories){var allPaths;return allPaths={},each(selectedCategories,function(){return function(selectedCategory){var parsedCategory;return parsedCategory=flatCategories[selectedCategory],null!=parsedCategory?extend(allPaths,indexArray(initial(parsedCategory.rootPath))):void 0}}(this)),allPaths},removeVirtualPrefix:function(categoryId){return categoryId.replace(VIRTUAL_CATEGORY_PREFIX_REGEX,"")}},indexArray=function(array){return object(array,array)}},{}]},{},[1]),void function(){function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}var FourPackCarouselView,RightRailView,VideoWidgetView;FourPackCarouselView=function(super$){function FourPackCarouselView(){super$.apply(this,arguments)}return extends$(FourPackCarouselView,super$),FourPackCarouselView.prototype.events={"click .carousel-previous":"moveLeft","click .carousel-next":"moveRight"},FourPackCarouselView.prototype.initialize=function(){return this.$carousel=this.$(".carousel"),this.$leftButton=this.$(".carousel-previous"),this.$rightButton=this.$(".carousel-next"),this.currentPosition=0,this.maxPosition=this.$(".deal-card").length-1,this.visibleCards=4},FourPackCarouselView.prototype.moveLeft=function(){return this.canMoveLeft()&&!this.$leftButton.hasClass("inactive")?this.currentPosition-this.visibleCards<0?this.animate(0):this.animate(this.currentPosition-this.visibleCards):void 0},FourPackCarouselView.prototype.moveRight=function(){return this.canMoveRight()&&!this.$rightButton.hasClass("inactive")?this.currentPosition+(this.visibleCards-1)+this.visibleCards>this.maxPosition?this.animate(this.maxPosition-(this.visibleCards-1)):this.animate(this.currentPosition+this.visibleCards):void 0},FourPackCarouselView.prototype.canMoveRight=function(){return this.currentPosition+this.visibleCards<=this.maxPosition},FourPackCarouselView.prototype.canMoveLeft=function(){return this.currentPosition>=1},FourPackCarouselView.prototype.showButton=function($button){return $button.removeClass("inactive")},FourPackCarouselView.prototype.hideButton=function($button){return $button.addClass("inactive")},FourPackCarouselView.prototype.animate=function(newPosition){return Modernizr.csstransitions?(this.$carousel.css({left:-(239*newPosition)}),this.finishAnimation(newPosition)):this.$carousel.animate({left:-(239*newPosition)},{duration:250,complete:function(this$){return function(){return this$.finishAnimation(newPosition)}}(this)})},FourPackCarouselView.prototype.finishAnimation=function(newPosition){return this.currentPosition=newPosition,this.canMoveLeft()?this.showButton(this.$leftButton):this.hideButton(this.$leftButton),this.canMoveRight()?this.showButton(this.$rightButton):this.hideButton(this.$rightButton)},FourPackCarouselView}(Backbone.View),RightRailView=function(super$){function RightRailView(){var instance$;instance$=this,this.setFixPoint=function(){return RightRailView.prototype.setFixPoint.apply(instance$,arguments)},this.shouldFix=function(){return RightRailView.prototype.shouldFix.apply(instance$,arguments)},this.atBottom=function(){return RightRailView.prototype.atBottom.apply(instance$,arguments)},this.floatView=function(){return RightRailView.prototype.floatView.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(RightRailView,super$),RightRailView.prototype.initialize=function(){return this.container=$(window),this.document=$(document),this.header=$(".header"),this.banner=$(".in-app-msg-banner"),this.bannerCloseBtn=$(".in-app-msg-banner .hide-link"),this.footer=$(".footer-i18n"),this.fixedTopMargin=50,this.fixPoint=0,this.setFixPoint(),this.floatView(),this.container.scroll(this.floatView),this.bannerCloseBtn.click(this.setFixPoint)},RightRailView.prototype.floatView=function(){return this.$el.removeClass("fixed top bottom"),this.shouldFix()?this.$el.addClass("fixed"):this.atBottom()?this.$el.addClass("bottom"):this.$el.addClass("top")},RightRailView.prototype.atBottom=function(){return this.container.scrollTop()+this.$el.outerHeight()+this.fixedTopMargin>this.document.height()-this.footer.outerHeight()},RightRailView.prototype.shouldFix=function(){return this.container.scrollTop()>this.fixPoint&&!this.atBottom()},RightRailView.prototype.setFixPoint=function(){return this.fixPoint=this.header.position().top+this.outerHeightWithMargin(this.header)+this.outerHeightWithMargin(this.banner)-this.fixedTopMargin},RightRailView.prototype.outerHeightWithMargin=function(element){return element.is(":visible")?element.outerHeight(!0):0},RightRailView}(Backbone.View),VideoWidgetView=function(super$){function VideoWidgetView(){super$.apply(this,arguments)}return extends$(VideoWidgetView,super$),VideoWidgetView.prototype.events={"click .image-container":"playVideo",mouseover:"fetchVideo"},VideoWidgetView.videoIsloaded=!1,VideoWidgetView.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this.video=this.$(".video-container"),this.previewImage=this.$(".image-container"),this.videoId=this.video.data("video-id"),this.videoIsloaded?void 0:this.loadVideoPlayer()},VideoWidgetView.prototype.fetchVideo=function(){return this.videoPlayer=OO.Player.create("ooyala-player",this.videoId)},VideoWidgetView.prototype.loadVideoPlayer=function(){var script;script=document.createElement("script"),script.type="text/javascript",script.src="http://player.ooyala.com/v3/4e60e82cdbc14def8b05623206f02388",script.readyState?script.onreadystatechange=function(){("loaded"===script.readyState||"complete"===script.readyState)&&(this.videoIsloaded=!0)}:script.onload=function(){this.videoIsloaded=!0},$("head").append(script)},VideoWidgetView.prototype.playVideo=function(){return this.previewImage.addClass("hidden"),this.videoPlayer.play()},VideoWidgetView}(Backbone.View),null!=window.WLS?window.WLS:window.WLS={},null!=window.WLS.Views?window.WLS.Views:window.WLS.Views={},window.WLS.Views.FourPackCarousel=FourPackCarouselView,window.WLS.Views.RightRail=RightRailView,window.WLS.Views.VideoWidget=VideoWidgetView,WLS.init=function(options){return null==options&&(options={}),_.defaults(options),$(".right-rail").each(function(index,el){return new WLS.Views.RightRail({el:el})}),$(".carousel-widget").each(function(index,el){return new WLS.Views.FourPackCarousel({el:el})}),$(".video-widget").each(function(index,el){return new WLS.Views.VideoWidget({el:el})})},$(function(){return WLS.init()})}.call(this),Groupon.PageTracking=new Modules.Page.Helpers.Tracking,$(document).ready(function(){var $personalize,appClass;return $("body").removeClass("no-js"),$('.primary-nav [data-bhw="NavAllDeals"]').addClass("active"),appClass=Groupon.isLocalPage?Modules.Local.Application:Modules.Browse.Application,Modules.Deals.paginationEvents=_.extend({},Backbone.Events),Modules.Browse.pageEvents=_.extend({},Backbone.Events),Groupon.browseApp=new appClass({isLeftBarVisible:!!Groupon.RefinementBar.isLeftBarVisible,isOnNoDealsPage:!!Groupon.onNoDealsPage}),Groupon.browseApp.startApp(),Groupon.enabledFeatures.personalizeWizardEnabled&&($personalize=$("#personalize_wizard_call_to_action"),$("header.header").before($personalize)),Modules.Browse.Views.BackToTop.render()}),$(window).load(function(){return Groupon.PageTracking.pageReady(),Modules.Browse.pageEvents.trigger("pageReady")});